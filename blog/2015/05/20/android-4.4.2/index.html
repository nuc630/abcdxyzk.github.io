
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>编译android4.4.2源码 - kk Blog —— 通用基础</title>

  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="kk Blog —— 通用基础" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/category.js" type="text/javascript"></script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">kk Blog —— 通用基础</a></h1>
  
    <h2>date [-d @int|str] [+%s|"+%F %T"]</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
<li>
<form action="/search" method="get">
    <input class="search" name="query" id="query" type="text" placeholder="search...">
    <input id="btnSubmit" value="search" type="submit">
</form>
<script type="text/javascript">
var query = GetRequest("query");
if (query != null) {
	document.getElementById("query").value = query;
}
</script>
</li>
  <li><a href="/atom.xml" rel="subscribe-rss">RSS</a></li>
  
</ul>
  
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/download">Download</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h2 class="entry-title">编译android4.4.2源码</h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-20T15:17:00+08:00'><span class='date'>2015-05-20</span> <span class='time'>15:17:00</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>android4.4.2和jdk下载 <a href="http://pan.baidu.com/share/home?uk=3691037096&amp;view=share#category/type=0">http://pan.baidu.com/share/home?uk=3691037096&amp;view=share#category/type=0</a></p>

<p><a href="http://www.cnblogs.com/zhx831/p/3550688.html">http://www.cnblogs.com/zhx831/p/3550688.html</a></p>

<p>这篇文章主要记录了我是如何搭建Android编译环境，以及搭建当中遇到的问题以及解决方法。搭建环境依照官网进行，整个搭建环境分为两步：<br/>
1. 安装JDK<br/>
2. 安装相对应的库以及软件</p>

<h4>1、安装JDK</h4>

<p>官网上给出的办法是使用apt进行jdk的安装</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo add-apt-repository "deb http://archive.canonical.com/ lucid partner"
</span><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get install sun-java6-jdk</span></code></pre></td></tr></table></div></figure>


<p>但是我在按照这个方法进行安装是apt提示无法找到jdk安装包。 在更换了好几个source后都无法下载jdk。因此只能考虑手动安装。</p>

<h5>1. 首先在Orecal官网下载JDK：</h5>

<p><a href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase6-419409.html">http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase6-419409.html</a></p>

<p>需要注意的是，现在官方网站上最新的版本的JDK7， 但是这个这个版本是不能用于Android的编译的，一定要去下载JDK6. 希望看到的朋友不要在走我的弯路。</p>

<h5>2. 创建jvm文件夹</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo mkdir /usr/lib/jvm</span></code></pre></td></tr></table></div></figure>


<h5>3. 安装JDK6</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo cp jdk-6u45-linux-x64.bin /usr/lib/jvm/
</span><span class='line'>sudo chmod +x jdk-6u45-linux-x64.bin
</span><span class='line'>sudo ./jdk-6u45-linux-x64.bin</span></code></pre></td></tr></table></div></figure>


<h5>4. 设置环境变量</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo mv jdk1.6.0_45/ jdk6
</span><span class='line'>export JAVA_HOME=/usr/lib/jvm/jdk6
</span><span class='line'>export JRE_HOME=${JAVA_HOME}/jre
</span><span class='line'>export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib
</span><span class='line'>export PATH=${JAVA_HOME}/bin:$PATH</span></code></pre></td></tr></table></div></figure>


<h5>5. 使能环境变量</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>source ~/.bashrc</span></code></pre></td></tr></table></div></figure>


<h5>6. 设置JDK6为系统默认JDK</h5>

<p>因为在ubuntu中默认JDK可能是OpenJDK,这里我们设置JDK6为我们默认的JDK</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/jdk6/bin/java 300
</span><span class='line'>sudo update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/jdk6/bin/javac 300
</span><span class='line'>sudo update-alternatives --install /usr/bin/javaws javaws /usr/lib/jvm/jdk6/bin/javaws 300
</span><span class='line'>sudo update-alternatives --install /usr/bin/jar jar /usr/lib/jvm/jdk6/bin/jar 300
</span><span class='line'>sudo update-alternatives --config java</span></code></pre></td></tr></table></div></figure>


<h5>7. 至此JDK就安装好了，现在就可以在shell中查看Java版本</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java -version</span></code></pre></td></tr></table></div></figure>


<p>如果编译还提示java错误，就把java路径加到PATH中</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PATH=$PATH:/usr/lib/jvm/jdk6/bin</span></code></pre></td></tr></table></div></figure>


<h4>2、安装相对应的库以及软件</h4>

<p>根据官网上的指示我们需要安装如下软件包和lib</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install git gnupg flex bison gperf build-essential \
</span><span class='line'>  zip curl libc6-dev libncurses5-dev:i386 x11proto-core-dev \
</span><span class='line'>  libx11-dev:i386 libreadline6-dev:i386 libgl1-mesa-glx:i386 \
</span><span class='line'>  libgl1-mesa-dev g++-multilib mingw32 tofrodos \
</span><span class='line'>  python-markdown libxml2-utils xsltproc zlib1g-dev:i386
</span><span class='line'>$ sudo ln -s /usr/lib/i386-linux-gnu/mesa/libGL.so.1 /usr/lib/i386-linux-gnu/libGL.so</span></code></pre></td></tr></table></div></figure>


<ul>
<li>我安装<code>libgl1-mesa-glx:i386</code>的时候提示要卸掉很多软件，就没装这个，也是能正常编译。</li>
</ul>


<p>但是在安装过程中遇到了如下错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Errors were encountered while processing:
</span><span class='line'>libc6-dev:i386
</span><span class='line'> 
</span><span class='line'>E: Sub-process /usr/bin/dpkg returned an error code (1)</span></code></pre></td></tr></table></div></figure>


<p>解决方法如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo apt-get install linux-libc-dev:i386
</span><span class='line'>$ sudo apt-get install libc6-dev:i386</span></code></pre></td></tr></table></div></figure>


<hr />

<p><a href="http://blog.csdn.net/yf210yf/article/details/9206269">http://blog.csdn.net/yf210yf/article/details/9206269</a></p>

<p><a href="http://www.cnblogs.com/qianxudetianxia/p/3681890.html">http://www.cnblogs.com/qianxudetianxia/p/3681890.html</a></p>

<h4>编译代码</h4>

<p>进入源码根目录,编译初始化,在终端中执行：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>source build/envsetup.sh</span></code></pre></td></tr></table></div></figure>


<p>选择编译目标：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lunch </span></code></pre></td></tr></table></div></figure>


<p>选择第一个吧，或者直接</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>lunch aosp_arm-eng</span></code></pre></td></tr></table></div></figure>


<p>开始编译</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make -j4</span></code></pre></td></tr></table></div></figure>


<p>3、5个小时左右吧</p>

<p>Android 完成编译的时候先执行  source build/envsetup.sh。  在这个shell 脚本中定义了 help,  croot, m, mm, mmm 等 function</p>

<h4>运行模拟器</h4>

<p>在终端中执行：emulator</p>

<p><img src="/images/android/2015-05-20.png" alt="" /></p>

<h5>修改和编译系统应用代码</h5>

<p>我们修改一下系统应用Mms的标题：</p>

<p><img src="/images/android/2015-05-21.png" alt="" /></p>

<p>使用mm命令编译：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>xxx@ubuntu:~/Data/android/packages/apps/Mms$ mm
</span><span class='line'>============================================
</span><span class='line'>PLATFORM_VERSION_CODENAME=REL
</span><span class='line'>PLATFORM_VERSION=4.4.3.2.1.000.000
</span><span class='line'>TARGET_PRODUCT=aosp_arm
</span><span class='line'>TARGET_BUILD_VARIANT=eng
</span><span class='line'>TARGET_BUILD_TYPE=release
</span><span class='line'>TARGET_BUILD_APPS=
</span><span class='line'>TARGET_ARCH=arm
</span><span class='line'>TARGET_2ND_ARCH=
</span><span class='line'>TARGET_ARCH_VARIANT=armv7-a
</span><span class='line'>TARGET_CPU_VARIANT=generic
</span><span class='line'>HOST_ARCH=x86
</span><span class='line'>HOST_OS=linux
</span><span class='line'>HOST_OS_EXTRA=Linux-3.13.0-24-generic-x86_64-with-Ubuntu-14.04-trusty
</span><span class='line'>HOST_BUILD_TYPE=release
</span><span class='line'>BUILD_ID=OPENMASTER
</span><span class='line'>OUT_DIR=out
</span><span class='line'>============================================
</span><span class='line'>make:进入目录'/home/xxx/Data/android'
</span><span class='line'>target R.java/Manifest.java: Mms (out/target/common/obj/APPS/Mms_intermediates/src/R.stamp)
</span><span class='line'>warning: string 'menu_insert_smiley' has no default translation.
</span><span class='line'>target Java: Mms (out/target/common/obj/APPS/Mms_intermediates/classes)
</span><span class='line'>注: 某些输入文件使用或覆盖了已过时的 API。
</span><span class='line'>注: 有关详细信息, 请使用 -Xlint:deprecation 重新编译。
</span><span class='line'>注: 某些输入文件使用了未经检查或不安全的操作。
</span><span class='line'>注: 有关详细信息, 请使用 -Xlint:unchecked 重新编译。
</span><span class='line'>Copying: out/target/common/obj/APPS/Mms_intermediates/classes-jarjar.jar
</span><span class='line'>Copying: out/target/common/obj/APPS/Mms_intermediates/emma_out/lib/classes-jarjar.jar
</span><span class='line'>Copying: out/target/common/obj/APPS/Mms_intermediates/classes.jar
</span><span class='line'>Proguard: out/target/common/obj/APPS/Mms_intermediates/proguard.classes.jar
</span><span class='line'>ProGuard, version 4.10
</span><span class='line'>Reading program jar [/home/xxx/Data/android/out/target/common/obj/APPS/Mms_intermediates/classes.jar]
</span><span class='line'>// ... ...
</span><span class='line'>target Dex: Mms
</span><span class='line'>Copying: out/target/common/obj/APPS/Mms_intermediates/classes.dex
</span><span class='line'>target Package: Mms (out/target/product/generic/obj/APPS/Mms_intermediates/package.apk)
</span><span class='line'>nothing matches overlay file ic_contact_picture.png, for flavor ,,,,,,,,,,,,mdpi,,,,,,,
</span><span class='line'>libpng warning: iCCP: known incorrect sRGB profile
</span><span class='line'>libpng warning: iCCP: known incorrect sRGB profile
</span><span class='line'>warning: string 'menu_insert_smiley' has no default translation.
</span><span class='line'>warning: string 'menu_insert_smiley' is missing 19 required localizations: az_AZ en_AU en_CA en_GB en_IN en_NZ en_SG en_US eo_EU hy_AM ka_GE km_KH lo_LA mn_MN ne_NP si_LK zh_CN zh_HK zh_TW
</span><span class='line'>dex2oatd I 21424 21424 art/dex2oat/dex2oat.cc:1082] dex2oat: out/host/linux-x86/bin/dex2oatd --runtime-arg -Xms64m --runtime-arg -Xmx64m --boot-image=out/target/product/generic/dex_bootjars/system/framework/boot.art --dex-file=out/target/product/generic/obj/APPS/Mms_intermediates/package.apk --dex-location=/system/priv-app/Mms.apk --oat-file=out/target/product/generic/obj/APPS/Mms_intermediates/package.odex --android-root=out/target/product/generic/system --instruction-set=arm --instruction-set-features=default
</span><span class='line'>dex2oatd I 21424 21424 art/dex2oat/dex2oat.cc:252] dex2oat took 1.189425041s (threads: 8)
</span><span class='line'>Notice file: packages/apps/Mms/NOTICE -- out/target/product/generic/obj/NOTICE_FILES/src//system/priv-app/Mms.apk.txt
</span><span class='line'>Install: out/target/product/generic/system/priv-app/Mms.apk
</span><span class='line'>Install: out/target/product/generic/system/priv-app/Mms.odex
</span><span class='line'>// ... ...
</span><span class='line'>Install: out/target/product/generic/data/app/MmsTests.apk
</span><span class='line'>Install: out/target/product/generic/data/app/MmsTests.odex
</span><span class='line'>make:离开目录“/home/xxx/Data/android”</span></code></pre></td></tr></table></div></figure>


<p>主要是生成了两个文件：<br/>
out/target/product/generic/system/priv-app/Mms.apk<br/>
out/target/product/generic/system/priv-app/Mms.odex</p>

<h5>安装到手机</h5>

<p>因为是系统应用，为了重启有效，使用push命令把两个文件push到模拟器中对应的位置：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// 注意现在一些核心的应用的位置由以前的system/app调整为了system/priv-app，不要push错了
</span><span class='line'>/*
</span><span class='line'>xxx@ubuntu:~/Data/android$ adb push out/target/product/generic/system/priv-app/Mms.odex /system/priv-app
</span><span class='line'>2893 KB/s (2085348 bytes in 0.703s)
</span><span class='line'>xxx@ubuntu:~/Data/android$ adb push out/target/product/generic/system/priv-app/Mms.apk /system/priv-app
</span><span class='line'>3315 KB/s (1785258 bytes in 0.525s)</span></code></pre></td></tr></table></div></figure>


<p>看模拟器的标题被替换了。类似了，你可以修改framework，替换内核</p>

<p>在  ~/.bashrc</p>

<p>添加环境变量：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export ANDROID_PRODUCT_OUT=~/code/android-4.2/out/target/product/generic
</span><span class='line'>export ANDROID_SWT=~/code/android-4.2/out/host/linux-x86/framework/</span></code></pre></td></tr></table></div></figure>


<h4>备注：</h4>

<p>执行emulator，出现如下错误：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>emulator: ERROR: You did not specify a virtual device name, and the system
</span><span class='line'>directory could not be found.
</span><span class='line'>
</span><span class='line'>If you are an Android SDK user, please use '@&lt;name&gt;' or '-avd &lt;name&gt;'
</span><span class='line'>to start a given virtual device (see -help-avd for details).
</span><span class='line'>Otherwise, follow the instructions in -help-disk-images to start the emulator</span></code></pre></td></tr></table></div></figure>


<p>解决：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>source build/envsetup.sh 
</span><span class='line'>lunch sdk-eng</span></code></pre></td></tr></table></div></figure>


<p>然后再执行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>emulator</span></code></pre></td></tr></table></div></figure>


<p>可以启动模拟器</p>

<hr />

<p><a href="http://senrsl.blogspot.com/2015/03/s4shv-e300lkernelrom.html">http://senrsl.blogspot.com/2015/03/s4shv-e300lkernelrom.html</a></p>

<h3>三星S4韩版SHV-E300L源码编译(内核Kernel+ROM)</h3>

<h4>编译ROM</h4>

<h5>①准备工作</h5>

<p>先看说明README_Platform.txt</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    How to build Module for Platform
</span><span class='line'>    - It is only for modules are needed to using Android build system.
</span><span class='line'>    - Please check its own install information under its folder for other module.
</span><span class='line'>    [Step to build]
</span><span class='line'>    1. Get android open source.
</span><span class='line'>        : version info - Android 4.4
</span><span class='line'>        ( Download site : http://source.android.com )
</span><span class='line'>    2. Copy module that you want to build - to original android open source
</span><span class='line'>       If same module exist in android open source, you should replace it. (no overwrite)
</span><span class='line'>        # It is possible to build all modules at once.
</span><span class='line'>    3. You should add module name to 'PRODUCT_PACKAGES' in 'build\target\product\core.mk' as following case.
</span><span class='line'>        case 1) e2fsprog : should add 'e2fsck' to PRODUCT_PACKAGES
</span><span class='line'>        case 2) blkid : should add 'libkeyutils' to PRODUCT_PACKAGES
</span><span class='line'>        case 3) libhyphenation : should add 'libkeyutils' to PRODUCT_PACKAGES
</span><span class='line'>        case 4) KeyUtils : should add 'libkeyutils' to PRODUCT_PACKAGES
</span><span class='line'>        case 5) libexifa : should add 'libexifa' to PRODUCT_PACKAGES
</span><span class='line'>        case 6) libjpega : should add 'libjpega' to PRODUCT_PACKAGES
</span><span class='line'>        ex.) [build\target\product\core.mk] - add all module name for case 1 ~ 5 at once
</span><span class='line'>            PRODUCT_PACKAGES += \
</span><span class='line'>                e2fsck \
</span><span class='line'>                blkid \
</span><span class='line'>                libhyphenation \
</span><span class='line'>                libkeyutils \
</span><span class='line'>                libexifa \
</span><span class='line'>                libjpega \
</span><span class='line'>                ebtables
</span><span class='line'>    4. excute build command
</span><span class='line'>        ./build_platform.sh
</span><span class='line'>    Note :
</span><span class='line'>    to build SBrowser (vendor/samsung/packages/apps/SBrowser),
</span><span class='line'>    please refer to Buildme.txt at the folder mentioned above.</span></code></pre></td></tr></table></div></figure>


<p>意思就是说分4部走，后面加了个注释。</p>

<p>分别是下载4.4的源码，把包里的要编译的模块拷进去(替换,非覆盖),增加要编译的模块到core.mk进行注册,执行编译脚本。</p>

<p>查看当前源码版本</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>senrsl@senrsl-ubuntu:~$ cd android/source/WORKING_DIRECTORY/
</span><span class='line'>senrsl@senrsl-ubuntu:~/android/source/WORKING_DIRECTORY$ repo branches
</span><span class='line'>*  android-4.4.2_r2          | in all projects
</span><span class='line'>    master                    | in:
</span><span class='line'>                                      abi/cpp
</span><span class='line'>                                      ....</span></code></pre></td></tr></table></div></figure>


<p>所有的版本号里没有叫4.4的，只有4.4.*的。。。。</p>

<p>好吧，就用这个。</p>

<h5>②替换模块</h5>

<p>1)external目录,把这些目录剪出来</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    senrsl@senrsl-ubuntu:~/android/source/test/三星替换 /external$ ll
</span><span class='line'>    总用量 40
</span><span class='line'>    drwxrwxr-x 10 senrsl senrsl 4096  3月 30 14:53 ./
</span><span class='line'>    drwxrwxr-x  4 senrsl senrsl 4096  3月 30 15:02 ../
</span><span class='line'>    drwxrwxr-x 17 senrsl senrsl 4096  3月 20 13:35 chromium/
</span><span class='line'>    drwxrwxr-x  9 senrsl senrsl 4096  3月 20 13:36 dnsmasq/
</span><span class='line'>    drwxrwxr-x 19 senrsl senrsl 4096  3月 20 13:36 e2fsprogs/
</span><span class='line'>    drwxrwxr-x  3 senrsl senrsl 4096  3月 20 13:36 gcc-demangle/
</span><span class='line'>    drwxrwxr-x  4 senrsl senrsl 4096  3月 20 13:36 hyphenation/
</span><span class='line'>    drwxrwxr-x 15 senrsl senrsl 4096  3月 20 13:36 iproute2/
</span><span class='line'>    drwxrwxr-x 11 senrsl senrsl 4096  3月 20 13:36 iptables/
</span><span class='line'>    drwxrwxr-x  4 senrsl senrsl 4096  3月 20 13:36 junit/</span></code></pre></td></tr></table></div></figure>


<p>把这些目录放进去</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    senrsl@senrsl-ubuntu:~$ cd android/source/SHV-E300L_KK_Opensource/Platform/external/
</span><span class='line'>    senrsl@senrsl-ubuntu:~/android/source/SHV-E300L_KK_Opensource/Platform/external$ ll
</span><span class='line'>    总用量 44
</span><span class='line'>    drwxrwxr-x 11 senrsl senrsl 4096 10月 14 09:23 ./
</span><span class='line'>    drwxrwxr-x  5 senrsl senrsl 4096  3月 30 13:10 ../
</span><span class='line'>    drwxrwxr-x 17 senrsl senrsl 4096 10月  8 12:16 chromium/
</span><span class='line'>    drwxrwxr-x  9 senrsl senrsl 4096 10月  8 09:07 dnsmasq/
</span><span class='line'>    drwxrwxr-x 18 senrsl senrsl 4096 10月  8 09:07 e2fsprogs/
</span><span class='line'>    drwxrwxr-x  2 senrsl senrsl 4096 10月  8 09:07 gcc-demangle/
</span><span class='line'>    drwxrwxr-x  3 senrsl senrsl 4096 10月  8 09:07 hyphenation/
</span><span class='line'>    drwxrwxr-x 14 senrsl senrsl 4096 10月  8 09:07 iproute2/
</span><span class='line'>    drwxrwxr-x 10 senrsl senrsl 4096 10月  8 09:07 iptables/
</span><span class='line'>    drwxrwxr-x  3 senrsl senrsl 4096 10月  8 09:07 junit/
</span><span class='line'>    drwxrwxr-x 10 senrsl senrsl 4096 10月  8 12:23 webkit/</span></code></pre></td></tr></table></div></figure>


<p>2)vendor目录，把vendor/samsung放进去</p>

<p>3)build目录，把这俩文件剪出来，把Platform里的放进去</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    senrsl@senrsl-ubuntu:~/android/source/SHV-E300L_KK_Opensource/Platform/build$ tree
</span><span class='line'>    .
</span><span class='line'>    └── target
</span><span class='line'>        ├── board
</span><span class='line'>        │   └── generic
</span><span class='line'>        │       └── BoardConfig.mk
</span><span class='line'>        └── product
</span><span class='line'>            └── core.mk
</span><span class='line'>    4 directories, 2 files</span></code></pre></td></tr></table></div></figure>


<h5>③执行编译</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    senrsl@senrsl-ubuntu:~/android/source/WORKING_DIRECTORY$ ./build_platform.sh</span></code></pre></td></tr></table></div></figure>


<p>报错</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    Export includes file: frameworks/opt/emoji/Android.mk -- out/target/product/generic/obj/SHARED_LIBRARIES/libemoji_intermediates/export_includes
</span><span class='line'>    Export includes file: external/harfbuzz/Android.mk -- out/target/product/generic/obj/SHARED_LIBRARIES/libharfbuzz_intermediates/export_includes
</span><span class='line'>    Export includes file: external/webkit/Android.mk -- out/target/product/generic/obj/STATIC_LIBRARIES/libwebcore_intermediates/export_includes
</span><span class='line'>    Export includes file: external/libxml2/Android.mk -- out/target/product/generic/obj/STATIC_LIBRARIES/libxml2_intermediates/export_includes
</span><span class='line'>    Export includes file: external/libxslt/Android.mk -- out/target/product/generic/obj/STATIC_LIBRARIES/libxslt_intermediates/export_includes
</span><span class='line'>    Export includes file: external/hyphenation/Android.mk -- out/target/product/generic/obj/STATIC_LIBRARIES/libhyphenation_intermediates/export_includes
</span><span class='line'>    Import includes file: out/target/product/generic/obj/SHARED_LIBRARIES/libemoji_intermediates/import_includes
</span><span class='line'>    Import includes file: out/target/product/generic/obj/SHARED_LIBRARIES/libharfbuzz_intermediates/import_includes
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/html/DocTypeStrings.gperf
</span><span class='line'>    Generating HTMLEntityTable.cpp
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/platform/ColorData.gperf
</span><span class='line'>    WebCore Yacc: libwebcore &lt;= external/webkit/Source/WebCore/css/CSSGrammar.y
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    WebCore Yacc: libwebcore &lt;= external/webkit/Source/WebCore/xml/XPathGrammar.y
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/dom/make_names.pl
</span><span class='line'>    Can't locate Switch.pm in @INC (you may need to install the Switch module) (@INC contains: /etc/perl /usr/local/lib/perl/5.18.2 /usr/local/share/perl/5.18.2 /usr/lib/perl5 /usr/share/perl5 /usr/lib/perl/5.18 /usr/share/perl/5.18 /usr/local/lib/site_perl .) at external/webkit/Source/WebCore/make-hash-tools.pl line 23.
</span><span class='line'>    BEGIN failed--compilation aborted at external/webkit/Source/WebCore/make-hash-tools.pl line 23.
</span><span class='line'>    Can't locate Switch.pm in @INC (you may need to install the Switch module) (@INC contains: /etc/perl /usr/local/lib/perl/5.18.2 /usr/local/share/perl/5.18.2 /usr/lib/perl5 /usr/share/perl5 /usr/lib/perl/5.18 /usr/share/perl/5.18 /usr/local/lib/site_perl .) at external/webkit/Source/WebCore/make-hash-tools.pl line 23.
</span><span class='line'>    BEGIN failed--compilation aborted at external/webkit/Source/WebCore/make-hash-tools.pl line 23.
</span><span class='line'>    make: *** [out/target/product/generic/obj/STATIC_LIBRARIES/libwebcore_intermediates/Source/WebCore/html/DocTypeStrings.cpp] 错误 2
</span><span class='line'>    make: *** 正在等待未完成的任务....
</span><span class='line'>    make: *** [out/target/product/generic/obj/STATIC_LIBRARIES/libwebcore_intermediates/Source/WebCore/platform/ColorData.cpp] 错误 2
</span><span class='line'>    target Generated: libwebcore &lt;= external/webkit/Source/WebCore/html/parser/HTMLEntityNames.in
</span><span class='line'>    senrsl@senrsl-ubuntu:~/android/source/WORKING_DIRECTORY$ ./build_platform.sh</span></code></pre></td></tr></table></div></figure>


<p>在core.mk里把    libwebcore \删掉，再build，报错</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansKhmerUI-Bold.ttf
</span><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansKhmerUI-Regular.ttf
</span><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansLao-Bold.ttf
</span><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansLao-Regular.ttf
</span><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansLaoUI-Bold.ttf
</span><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansLaoUI-Regular.ttf
</span><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansMalayalam-Bold.ttf
</span><span class='line'>    collect2: error: ld returned 1 exit status
</span><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansMalayalam-Regular.ttf
</span><span class='line'>    make: *** [out/target/product/generic/obj/EXECUTABLES/dnsmasq_intermediates/LINKED/dnsmasq] 错误 1
</span><span class='line'>    make: *** 正在等待未完成的任务....
</span><span class='line'>    Install: out/target/product/generic/system/fonts/NotoSansMalayalamUI-Bold.ttf
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:339: error: undefined reference to 'ext2fs_test_bit64'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:390: error: undefined reference to 'ext2fs_test_bit64'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:186: error: undefined reference to 'ext2fs_test_bit64'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:281: error: undefined reference to 'ext2fs_mem_is_zero'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:178: error: undefined reference to 'ext2fs_clear_bit64'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:170: error: undefined reference to 'ext2fs_set_bit64'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:141: error: undefined reference to 'ext2fs_clear_bit64'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/gen_bitmap64.c:735: error: undefined reference to 'ext2fs_get_bitmap_granularity'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/gen_bitmap64.c:790: error: undefined reference to 'ext2fs_find_first_zero_generic_bitmap'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/mmp.c:57: error: undefined reference to 'ext2fs_get_dio_alignment'
</span><span class='line'>    external/e2fsprogs/lib/ext2fs/mmp.c:213: error: undefined reference to 'ext2fs_alloc_block2'
</span><span class='line'>    collect2: error: ld returned 1 exit status
</span><span class='line'>    make: *** [out/target/product/generic/obj/SHARED_LIBRARIES/libext2fs_intermediates/LINKED/libext2fs.so] 错误 1
</span><span class='line'>    senrsl@senrsl-ubuntu:~/android/source/WORKING_DIRECTORY$</span></code></pre></td></tr></table></div></figure>


<p>再把 libexifa \删掉，报错</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/blkmap64_ba.o: In function `ba_find_first_zero':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:339: undefined reference to `ext2fs_test_bit64'
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:390: undefined reference to `ext2fs_test_bit64'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/blkmap64_ba.o: In function `ba_test_bmap':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:186: undefined reference to `ext2fs_test_bit64'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/blkmap64_ba.o: In function `ba_test_clear_bmap_extent':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:281: undefined reference to `ext2fs_mem_is_zero'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/blkmap64_ba.o: In function `ba_unmark_bmap':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:178: undefined reference to `ext2fs_clear_bit64'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/blkmap64_ba.o: In function `ba_mark_bmap':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:170: undefined reference to `ext2fs_set_bit64'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/blkmap64_ba.o: In function `ba_resize_bmap':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/blkmap64_ba.c:141: undefined reference to `ext2fs_clear_bit64'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/gen_bitmap64.o: In function `ext2fs_convert_subcluster_bitmap':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/gen_bitmap64.c:735: undefined reference to `ext2fs_get_bitmap_granularity'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/gen_bitmap64.o: In function `ext2fs_find_first_zero_generic_bmap':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/gen_bitmap64.c:790: undefined reference to `ext2fs_find_first_zero_generic_bitmap'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/mmp.o: In function `ext2fs_mmp_read':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/mmp.c:57: undefined reference to `ext2fs_get_dio_alignment'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/mmp.o: In function `ext2fs_mmp_init':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/mmp.c:213: undefined reference to `ext2fs_alloc_block2'
</span><span class='line'>    collect2: ld returned 1 exit status
</span><span class='line'>    make: *** [out/host/linux-x86/obj/lib/libext2fs_host.so] 错误 1
</span><span class='line'>    make: *** 正在等待未完成的任务....
</span><span class='line'>    1 warning generated.
</span><span class='line'>    external/openssl/ssl/s2_clnt.c:1027:38: warning: unused parameter 'type' [-Wunused-parameter]
</span><span class='line'>    int ssl2_set_certificate(SSL *s, int type, int len, const unsigned char *data)
</span><span class='line'>                                         ^
</span><span class='line'>    1 warning generated.
</span><span class='line'>    external/openssl/ssl/s2_lib.c:385:38: warning: unused parameter 'larg' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctrl(SSL *s, int cmd, long larg, void *parg)
</span><span class='line'>                                         ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:385:50: warning: unused parameter 'parg' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctrl(SSL *s, int cmd, long larg, void *parg)
</span><span class='line'>                                                     ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:400:30: warning: unused parameter 's' [-Wunused-parameter]
</span><span class='line'>    long ssl2_callback_ctrl(SSL *s, int cmd, void (*fp)(void))
</span><span class='line'>                                 ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:400:37: warning: unused parameter 'cmd' [-Wunused-parameter]
</span><span class='line'>    long ssl2_callback_ctrl(SSL *s, int cmd, void (*fp)(void))
</span><span class='line'>                                        ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:400:49: warning: unused parameter 'fp' [-Wunused-parameter]
</span><span class='line'>    long ssl2_callback_ctrl(SSL *s, int cmd, void (*fp)(void))
</span><span class='line'>                                                    ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:405:29: warning: unused parameter 'ctx' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctx_ctrl(SSL_CTX *ctx, int cmd, long larg, void *parg)
</span><span class='line'>                                ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:405:38: warning: unused parameter 'cmd' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctx_ctrl(SSL_CTX *ctx, int cmd, long larg, void *parg)
</span><span class='line'>                                         ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:405:48: warning: unused parameter 'larg' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctx_ctrl(SSL_CTX *ctx, int cmd, long larg, void *parg)
</span><span class='line'>                                                   ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:405:60: warning: unused parameter 'parg' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctx_ctrl(SSL_CTX *ctx, int cmd, long larg, void *parg)
</span><span class='line'>                                                               ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:410:38: warning: unused parameter 'ctx' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctx_callback_ctrl(SSL_CTX *ctx, int cmd, void (*fp)(void))
</span><span class='line'>                                         ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:410:47: warning: unused parameter 'cmd' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctx_callback_ctrl(SSL_CTX *ctx, int cmd, void (*fp)(void))
</span><span class='line'>                                                  ^
</span><span class='line'>    external/openssl/ssl/s2_lib.c:410:59: warning: unused parameter 'fp' [-Wunused-parameter]
</span><span class='line'>    long ssl2_ctx_callback_ctrl(SSL_CTX *ctx, int cmd, void (*fp)(void))
</span><span class='line'>                                                              ^
</span><span class='line'>    12 warnings generated.
</span><span class='line'>    1 warning generated.
</span><span class='line'>    make: *** wait: 没有子进程。 停止。
</span><span class='line'>    senrsl@senrsl-ubuntu:~/android/source/WORKING_DIRECTORY$</span></code></pre></td></tr></table></div></figure>


<p>然后把之前的core.mk第二部分替换成README里的，报错</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/mmp.c:57: undefined reference to `ext2fs_get_dio_alignment'
</span><span class='line'>    out/host/linux-x86/obj/SHARED_LIBRARIES/libext2fs_host_intermediates/mmp.o: In function `ext2fs_mmp_init':
</span><span class='line'>    /home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/mmp.c:213: undefined reference to `ext2fs_alloc_block2'
</span><span class='line'>    collect2: ld returned 1 exit status
</span><span class='line'>    make: *** [out/host/linux-x86/obj/lib/libext2fs_host.so] 错误 1
</span><span class='line'>    make: *** 正在等待未完成的任务....
</span><span class='line'>    Processing target/product/generic/dex_bootjars/system/framework/core.jar
</span><span class='line'>    Done!</span></code></pre></td></tr></table></div></figure>


<p>然后把core.mk里第二部分全都删掉，报的错还是上面那个。</p>

<p>恢复下core.mk重来，</p>

<p>报1：报错external/webkit/Source/WebCore/make-hash-tools.pl line 23.，core.mk砍掉 libwebcore \ 代码砍掉external/webkit.</p>

<p>报2：/home/senrsl/android/source/WORKING_DIRECTORY/external/e2fsprogs/lib/ext2fs/mmp.c:213: undefined reference to `ext2fs_alloc_block2'，external/e2fsprogs 代码换回原版。</p>

<p>报3：/home/senrsl/android/source/WORKING_DIRECTORY/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.7/bin/../lib/gcc/arm-linux-androideabi/4.7/../../../../arm-linux-androideabi/bin/ld: error: out/target/product/generic/obj/EXECUTABLES/dnsmasq_intermediates/dhcp-common.o: multiple definition of &lsquo;option_string&rsquo;
/home/senrsl/android/source/WORKING_DIRECTORY/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.7/bin/../lib/gcc/arm-linux-androideabi/4.7/../../../../arm-linux-androideabi/bin/ld: out/target/product/generic/obj/EXECUTABLES/dnsmasq_intermediates/option.o: previous definition here，external/dnsmasq换回原版。</p>

<p>然后编译</p>

<p>这样竟编译成功</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    Creating filesystem with parameters:
</span><span class='line'>        Size: 576716800
</span><span class='line'>        Block size: 4096
</span><span class='line'>        Blocks per group: 32768
</span><span class='line'>        Inodes per group: 7040
</span><span class='line'>        Inode size: 256
</span><span class='line'>        Journal blocks: 2200
</span><span class='line'>        Label:
</span><span class='line'>        Blocks: 140800
</span><span class='line'>        Block groups: 5
</span><span class='line'>        Reserved block group size: 39
</span><span class='line'>    Created filesystem with 892/35200 inodes and 65272/140800 blocks
</span><span class='line'>    + '[' 0 -ne 0 ']'
</span><span class='line'>    Install system fs image: out/target/product/generic/system.img
</span><span class='line'>    out/target/product/generic/system.img+ maxsize=588791808 blocksize=2112 total=576716800 reserve=5947392</span></code></pre></td></tr></table></div></figure>


<p>镜像文件输出到了/home/senrsl/android/source/WORKING_DIRECTORY/out/target /product/generic</p>

<p>4)封包</p>

<p>查看下官方提供的E300LKLUFNE4_E300LLGTFNE4_E300LKLUFNC1_HOME.tar</p>

<p>依次罗列了这几个img.</p>

<p>尝试封装</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    senrsl@senrsl-ubuntu:~/android/source/WORKING_DIRECTORY/out/target/product/generic$ tar cvf p.tar cache.img ramdisk.img system.img userdata.img
</span><span class='line'>    cache.img
</span><span class='line'>    ramdisk.img
</span><span class='line'>    system.img
</span><span class='line'>    userdata.img</span></code></pre></td></tr></table></div></figure>


<p>然后重启系统去烧。</p>

<p>//TODO 未成功，无法烧入</p>

<hr />

<h4>I9507V 的external/e2fsprogs，external/dnsmasq换回原版，就能编译成功，没试过烧进真机。</h4>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">kk</span></span>

      




<time class='entry-date' datetime='2015-05-20T15:17:00+08:00'><span class='date'>2015-05-20</span> <span class='time'>15:17:00</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/cats/android/'>android</a>, <a class='category' href='/blog/cats/android~base/'>base</a>
  
</span>


    </p>
    
      
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/05/15/kernel-net-ipv6/" title="Previous Post: ipv6初始化和处理流程分析">&laquo; ipv6初始化和处理流程分析</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/05/21/kernel-base-chardev/" title="Next Post: 字符设备驱动程序">字符设备驱动程序 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>
<aside class="sidebar" id='load_sidebar'>
</aside>
<script type="text/javascript">
  $('#load_sidebar').load('/sidebar.html');
</script>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - kk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <a title="Top" href="#" id="scroll2top" style="position: fixed; height: 50px; bottom: 30px; right: 25px; cursor: pointer; z-index: 9999; display: block; opacity: 1;"><img src="/images/scrollup.png"></a>
  <script src="/javascripts/scroll2top.js"></script>
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253604690'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1253604690' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  





</body>
</html>
