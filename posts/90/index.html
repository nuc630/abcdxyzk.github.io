
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>kk Blog —— 通用基础</title>

  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="kk Blog —— 通用基础" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/category.js" type="text/javascript"></script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">kk Blog —— 通用基础</a></h1>
  
    <h2>cp -rf * .</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
<li>
<form action="/search" method="get">
    <input class="search" name="query" id="query" type="text" placeholder="search...">
    <input id="btnSubmit" value="search" type="submit">
</form>
<script type="text/javascript">
var query = GetRequest("query");
if (query != null) {
	document.getElementById("query").value = query;
}
</script>
</li>
  <li><a href="/atom.xml" rel="subscribe-rss">RSS</a></li>
  
</ul>
  
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/download">Download</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2011/11/29/tools-ptrace-i/">Playing with ptrace, Part I — 玩转ptrace(一)</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-11-29T19:20:00+08:00'><span class='date'>2011-11-29</span> <span class='time'>19:20:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.kgdb.info/gdb/playing_with_ptrace_part_i/">原文</a><br/>
版权所有 © 转载时必须以链接形式注明作者和原始出处！</p>

<p> Playing with ptrace, Part I<br/>
by Pradeep Padala <code>p_padala@yahoo.com</code> <a href="http://www.cise.ufl.edu/~ppadala  ">http://www.cise.ufl.edu/~ppadala  </a>
Created 2002-11-01 02:00</p>

<p>翻译: Magic.D E-mail: adamgic@163.com<br/>
译者序：</p>

<p>在开发Hust Online Judge的过程中，查阅了不少资料，关于调试器技术的资料在网上是很少，即便是UNIX编程巨著《UNIX环境高级编程》中，相关内容也不多，直到我在 <a href="http://www.linuxjournal.com">http://www.linuxjournal.com</a> 上找到这篇文章，如获至宝，特翻译之，作为鄙人翻译技术文档的第一次尝试，必定会有不少蹩脚之处，各位就将就一下吧，欢迎大力拍砖。</p>

<p>你想过怎么实现对系统调用的拦截吗？你尝试过通过改变系统调用的参数来愚弄你的系统kernel吗？你想过调试器是如何使运行中的进程暂停并且控制它吗？</p>

<p>你可能会开始考虑怎么使用复杂的kernel编程来达到目的，那么，你错了。实际上Linux提供了一种优雅的机制来完成这些：ptrace系统函数。 ptrace提供了一种使父进程得以监视和控制其它进程的方式，它还能够改变子进程中的寄存器和内核映像，因而可以实现断点调试和系统调用的跟踪。</p>

<p>使用ptrace，你可以在用户层拦截和修改系统调用(sys call)</p>

<p>在这篇文章中，我们将学习如何拦截一个系统调用，然后修改它的参数。在本文的第二部分我们将学习更先进的技术：设置断点，插入代码到一个正在运行的程序中；我们将潜入到机器内部，偷窥和纂改进程的寄存器和数据段。</p>

<h4>基本知识</h4>

<p>操作系统提供了一种标准的服务来让程序员实现对底层硬件和服务的控制（比如文件系统），叫做系统调用(system calls)。当一个程序需要作系统调用的时候，它将相关参数放进系统调用相关的寄存器，然后调用软中断0×80，这个中断就像一个让程序得以接触到内核模式的窗口，程序将参数和系统调用号交给内核，内核来完成系统调用的执行。</p>

<p>在i386体系中(本文中所有的代码都是面向i386体系)，系统调用号将放入%eax,它的参数则依次放入%ebx, %ecx, %edx, %esi 和 %edi。 比如，在以下的调用</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Write(2, “Hello”, 5)</span></code></pre></td></tr></table></div></figure>


<p>的汇编形式大概是这样的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>movl $4, %eax
</span><span class='line'>movl $2, %ebx
</span><span class='line'>movl $hello, %ecx
</span><span class='line'>movl $5, %edx
</span><span class='line'>int $0×80</span></code></pre></td></tr></table></div></figure>


<p>这里的$hello指向的是标准字符串”Hello”。</p>

<p>那么，ptrace会在什么时候出现呢？在执行系统调用之前，内核会先检查当前进程是否处于被“跟踪”(traced)的状态。如果是的话，内核暂停当前进程并将控制权交给跟踪进程，使跟踪进程得以察看或者修改被跟踪进程的寄存器。</p>

<p>让我们来看一个例子，演示这个跟踪程序的过程</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;sys/ptrace.h&gt;
</span><span class='line'>#include &lt;sys/types.h&gt;
</span><span class='line'>#include &lt;sys/wait.h&gt;
</span><span class='line'>#include &lt;unistd.h&gt;
</span><span class='line'>#include &lt;linux/user.h&gt; /* For constants
</span><span class='line'>&#9;&#9;&#9;   ORIG_EAX etc */
</span><span class='line'>int main()
</span><span class='line'>{
</span><span class='line'>&#9;pid_t child;
</span><span class='line'>&#9;long orig_eax;
</span><span class='line'>&#9;child = fork();
</span><span class='line'>&#9;if(child ==0){
</span><span class='line'>&#9;&#9;ptrace(PTRACE_TRACEME,0, NULL, NULL);
</span><span class='line'>&#9;&#9;execl("/bin/ls","ls", NULL);
</span><span class='line'>&#9;} else {
</span><span class='line'>&#9;&#9;wait(NULL);
</span><span class='line'>&#9;&#9;orig_eax = ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;  child,4* ORIG_EAX,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;  NULL);
</span><span class='line'>&#9;&#9;printf("The child made a "
</span><span class='line'>&#9;&#9;&#9;"system call %ld\n", orig_eax);
</span><span class='line'>&#9;&#9;ptrace(PTRACE_CONT, child, NULL, NULL);
</span><span class='line'>&#9;}
</span><span class='line'>&#9;return0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>运行这个程序，将会在输出ls命令的结果的同时，输出:
The child made a system call 11</p>

<p>说明：11是execve的系统调用号，这是该程序调用的第一个系统调用。<br/>
想知道系统调用号的详细内容，察看 /usr/include/asm/unistd.h。</p>

<p>在以上的示例中，父进程fork出了一个子进程，然后跟踪它。在调用exec函数之前，子进程用PTRACE_TRACEME作为第一个参数调用了 ptrace函数，它告诉内核：让别人跟踪我吧！然后，在子进程调用了execve()之后，它将控制权交还给父进程。当时父进程正使用wait()函数来等待来自内核的通知，现在它得到了通知，于是它可以开始察看子进程都作了些什么，比如看看寄存器的值之类。</p>

<p>出现系统调用之后，内核会将eax中的值（此时存的是系统调用号）保存起来，我们可以使用PTRACE_PEEKUSER作为ptrace的第一个参数来读到这个值。<br/>
我们察看完系统调用的信息后，可以使用PTRACE_CONT作为ptrace的第一个参数，调用ptrace使子进程继续系统调用的过程。<br/>
ptrace函数的参数<br/>
Ptrace有四个参数</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>long ptrace(enum __ptrace_request request,
</span><span class='line'>&#9;pid_t pid,
</span><span class='line'>&#9;void *addr,
</span><span class='line'>&#9;void *data);</span></code></pre></td></tr></table></div></figure>


<p>第一个参数决定了ptrace的行为与其它参数的使用方法，可取的值有:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>PTRACE_ME
</span><span class='line'>PTRACE_PEEKTEXT
</span><span class='line'>PTRACE_PEEKDATA
</span><span class='line'>PTRACE_PEEKUSER
</span><span class='line'>PTRACE_POKETEXT
</span><span class='line'>PTRACE_POKEDATA
</span><span class='line'>PTRACE_POKEUSER
</span><span class='line'>PTRACE_GETREGS
</span><span class='line'>PTRACE_GETFPREGS,
</span><span class='line'>PTRACE_SETREGS
</span><span class='line'>PTRACE_SETFPREGS
</span><span class='line'>PTRACE_CONT
</span><span class='line'>PTRACE_SYSCALL,
</span><span class='line'>PTRACE_SINGLESTEP
</span><span class='line'>PTRACE_DETACH</span></code></pre></td></tr></table></div></figure>


<p>在下文中将对这些常量的用法进行说明。<br/>
读取系统调用的参数</p>

<p>通过将PTRACE_PEEKUSER作为ptrace 的第一个参数进行调用，可以取得与子进程相关的寄存器值。</p>

<p>先看下面这个例子</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;sys/ptrace.h&gt;
</span><span class='line'>#include &lt;sys/types.h&gt;
</span><span class='line'>#include &lt;sys/wait.h&gt;
</span><span class='line'>#include &lt;unistd.h&gt;
</span><span class='line'>#include &lt;linux/user.h&gt;
</span><span class='line'>#include &lt;sys/syscall.h&gt;   /* For SYS_write etc */
</span><span class='line'>int main()
</span><span class='line'>{
</span><span class='line'>&#9;pid_t child;
</span><span class='line'>&#9;long orig_eax, eax;
</span><span class='line'>&#9;long params[3];
</span><span class='line'>&#9;int status;
</span><span class='line'>&#9;int insyscall =0;
</span><span class='line'>&#9;child = fork();
</span><span class='line'>&#9;if(child ==0){
</span><span class='line'>&#9;&#9;ptrace(PTRACE_TRACEME,0, NULL, NULL);
</span><span class='line'>&#9;&#9;execl("/bin/ls","ls", NULL);
</span><span class='line'>&#9;} else {
</span><span class='line'>&#9;&#9;while(1) {
</span><span class='line'>&#9;&#9;&#9;wait(&status);
</span><span class='line'>&#9;&#9;&#9;if(WIFEXITED(status))
</span><span class='line'>&#9;&#9;&#9;break;
</span><span class='line'>&#9;          orig_eax = ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;child,4* ORIG_EAX, NULL);
</span><span class='line'>&#9;&#9;&#9;if(orig_eax == SYS_write) {
</span><span class='line'>&#9;&#9;&#9;&#9;if(insyscall == 0) {
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;/* Syscall entry */
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;insyscall =1;
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;params[0]= ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;child,4* EBX,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;params[1]= ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;child,4* ECX,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;params[2]= ptrace(PTRACE_PEEKUSER,
</span><span class='line'>                          child,4* EDX,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;printf("Write called with "
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;"%ld, %ld, %ld\n",
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;params[0], params[1],
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;params[2]);
</span><span class='line'>&#9;&#9;&#9;&#9;} else {/* Syscall exit */
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;eax = ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;child,4* EAX, NULL);
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;printf("Write returned "
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;"with %ld\n", eax);
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;&#9;insyscall =0;
</span><span class='line'>&#9;&#9;&#9;&#9;}
</span><span class='line'>&#9;&#9;&#9;}
</span><span class='line'>&#9;&#9;&#9;ptrace(PTRACE_SYSCALL,
</span><span class='line'>&#9;&#9;&#9;&#9;child, NULL, NULL);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;}
</span><span class='line'>&#9;return0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>这个程序的输出是这样的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ppadala@linux:~/ptrace &gt; ls
</span><span class='line'>a.out        dummy.s      ptrace.txt
</span><span class='line'>libgpm.html  registers.c  syscallparams.c
</span><span class='line'>dummy        ptrace.html  simple.c
</span><span class='line'>ppadala@linux:~/ptrace &gt; ./a.out
</span><span class='line'>Write called with 1,1075154944,48
</span><span class='line'>a.out        dummy.s      ptrace.txt
</span><span class='line'>Write returned with 48
</span><span class='line'>Write called with 1,1075154944,59
</span><span class='line'>libgpm.html  registers.c  syscallparams.c
</span><span class='line'>Write returned with 59
</span><span class='line'>Write called with 1,1075154944,30
</span><span class='line'>dummy        ptrace.html  simple.c
</span><span class='line'>Write returned with 30</span></code></pre></td></tr></table></div></figure>


<p>以上的例子中我们跟踪了write系统调用，而ls命令的执行将产生三个write系统调用。使用PTRACE_SYSCALL作为ptrace的第一个参数，使内核在子进程做出系统调用或者准备退出的时候暂停它。这种行为与使用PTRACE_CONT，然后在下一个系统调用/进程退出时暂停它是等价的。</p>

<p>在前一个例子中，我们用PTRACE_PEEKUSER来察看write系统调用的参数。系统调用的返回值会被放入%eax。</p>

<p>wait函数使用status变量来检查子进程是否已退出。它是用来判断子进程是被ptrace暂停掉还是已经运行结束并退出。有一组宏可以通过status的值来判断进程的状态，比如WIFEXITED等，详情可以察看wait(2) man。
读取寄存器的值</p>

<p>如果你想在系统调用或者进程终止的时候读取它的寄存器，使用前面那个例子的方法是可以的，但是这是笨拙的方法。使用PRACE_GETREGS作为ptrace的第一个参数来调用，可以只需一次函数调用就取得所有的相关寄存器值。
获得寄存器值得例子如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;sys/ptrace.h&gt;
</span><span class='line'>#include &lt;sys/types.h&gt;
</span><span class='line'>#include &lt;sys/wait.h&gt;
</span><span class='line'>#include &lt;unistd.h&gt;
</span><span class='line'>#include &lt;linux/user.h&gt;
</span><span class='line'>#include &lt;sys/syscall.h&gt;
</span><span class='line'>int main()
</span><span class='line'>{
</span><span class='line'>&#9;pid_t child;
</span><span class='line'>&#9;long orig_eax, eax;
</span><span class='line'>&#9;long params[3];
</span><span class='line'>&#9;int status;
</span><span class='line'>&#9;int insyscall =0;
</span><span class='line'>&#9;struct user_regs_struct regs;
</span><span class='line'>&#9;child = fork();
</span><span class='line'>&#9;if(child == 0) {
</span><span class='line'>&#9;&#9;ptrace(PTRACE_TRACEME,0, NULL, NULL);
</span><span class='line'>&#9;&#9;execl("/bin/ls","ls", NULL);
</span><span class='line'>&#9;} else {
</span><span class='line'>&#9;&#9;while(1) {
</span><span class='line'>&#9;&#9;&#9;wait(&status);
</span><span class='line'>&#9;&#9;&#9;if(WIFEXITED(status))
</span><span class='line'>&#9;&#9;&#9;break;
</span><span class='line'>&#9;&#9;&#9;orig_eax = ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;child,4* ORIG_EAX,
</span><span class='line'>&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;if(orig_eax == SYS_write) {
</span><span class='line'>&#9;&#9;&#9;&#9;if(insyscall == 0) {
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;/* Syscall entry */
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;insyscall =1;
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;ptrace(PTRACE_GETREGS, child,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;NULL,&regs);
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;printf("Write called with "
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;"%ld, %ld, %ld\n",
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;regs.ebx, regs.ecx,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;regs.edx);
</span><span class='line'>&#9;&#9;&#9;&#9;} else { /* Syscall exit */
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;eax = ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;child,4* EAX,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;printf("Write returned "
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;"with %ld\n", eax);
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;&#9;insyscall =0;
</span><span class='line'>&#9;&#9;&#9;&#9;}
</span><span class='line'>&#9;&#9;&#9;}
</span><span class='line'>&#9;&#9;&#9;ptrace(PTRACE_SYSCALL, child,
</span><span class='line'>&#9;&#9;&#9;&#9;NULL, NULL);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;}
</span><span class='line'>&#9;return0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>这段代码与前面的例子是比较相似的，不同的是它使用了PTRACE_GETREGS。 其中的user_regs_struct结构是在中定义的。<br/>
来点好玩的</p>

<p>现在该做点有意思的事情了，我们将要把传给write系统调用的字符串给反转。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;sys/ptrace.h&gt;
</span><span class='line'>#include &lt;sys/types.h&gt;
</span><span class='line'>#include &lt;sys/wait.h&gt;
</span><span class='line'>#include &lt;unistd.h&gt;
</span><span class='line'>#include &lt;linux/user.h&gt;
</span><span class='line'>#include &lt;sys/syscall.h&gt;
</span><span class='line'>constint long_size =sizeof(long);
</span><span class='line'>void reverse(char*str)
</span><span class='line'>{
</span><span class='line'>&#9;int i, j;
</span><span class='line'>&#9;char temp;
</span><span class='line'>&#9;for(i =0, j = strlen(str)-2;
</span><span class='line'>&#9;&#9;i &lt;= j;++i,--j){
</span><span class='line'>&#9;&#9;temp = str[i];
</span><span class='line'>&#9;&#9;str[i]= str[j];
</span><span class='line'>&#9;&#9;str[j]= temp;
</span><span class='line'>&#9;}
</span><span class='line'>}
</span><span class='line'>void getdata(pid_t child,long addr, char*str,int len)
</span><span class='line'>{
</span><span class='line'>&#9;char*laddr;
</span><span class='line'>&#9;int i, j;
</span><span class='line'>&#9;union u {
</span><span class='line'>&#9;&#9;long val;
</span><span class='line'>&#9;&#9;char chars[long_size];
</span><span class='line'>&#9;} data;
</span><span class='line'>&#9;i =0;
</span><span class='line'>&#9;j = len / long_size;
</span><span class='line'>&#9;laddr = str;
</span><span class='line'>&#9;while(i &lt; j) {
</span><span class='line'>&#9;&#9;data.val= ptrace(PTRACE_PEEKDATA,
</span><span class='line'>&#9;&#9;&#9;child, addr + i *4,
</span><span class='line'>&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;memcpy(laddr, data.chars, long_size);
</span><span class='line'>&#9;&#9;++i;
</span><span class='line'>&#9;&#9;laddr += long_size;
</span><span class='line'>&#9;}
</span><span class='line'>&#9;j = len % long_size;
</span><span class='line'>&#9;if(j != 0) {
</span><span class='line'>&#9;&#9;data.val= ptrace(PTRACE_PEEKDATA,
</span><span class='line'>&#9;&#9;&#9;child, addr + i *4,
</span><span class='line'>&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;memcpy(laddr, data.chars, j);
</span><span class='line'>&#9;}
</span><span class='line'>&#9;str[len]='\0';
</span><span class='line'>}
</span><span class='line'>void putdata(pid_t child,long addr, char*str,int len)
</span><span class='line'>{
</span><span class='line'>&#9;char*laddr;
</span><span class='line'>&#9;int i, j;
</span><span class='line'>&#9;union u {
</span><span class='line'>&#9;&#9;long val;
</span><span class='line'>&#9;&#9;char chars[long_size];
</span><span class='line'>&#9;} data;
</span><span class='line'>&#9;i =0;
</span><span class='line'>&#9;j = len / long_size;
</span><span class='line'>&#9;laddr = str;
</span><span class='line'>&#9;while(i &lt; j) {
</span><span class='line'>&#9;&#9;memcpy(data.chars, laddr, long_size);
</span><span class='line'>&#9;&#9;ptrace(PTRACE_POKEDATA, child,
</span><span class='line'>&#9;&#9;&#9;addr + i *4, data.val);
</span><span class='line'>&#9;&#9;&#9;++i;
</span><span class='line'>&#9;&#9;laddr += long_size;
</span><span class='line'>&#9;}
</span><span class='line'>&#9;j = len % long_size;
</span><span class='line'>&#9;if(j != 0) {
</span><span class='line'>&#9;&#9;memcpy(data.chars, laddr, j);
</span><span class='line'>&#9;&#9;ptrace(PTRACE_POKEDATA, child,
</span><span class='line'>&#9;&#9;addr + i *4, data.val);
</span><span class='line'>&#9;}
</span><span class='line'>}
</span><span class='line'>int main()
</span><span class='line'>{
</span><span class='line'>&#9;pid_t child;
</span><span class='line'>&#9;child = fork();
</span><span class='line'>&#9;if(child ==0){
</span><span class='line'>&#9;&#9;ptrace(PTRACE_TRACEME,0, NULL, NULL);
</span><span class='line'>&#9;&#9;execl("/bin/ls","ls", NULL);
</span><span class='line'>&#9;} else {
</span><span class='line'>&#9;&#9;long orig_eax;
</span><span class='line'>&#9;&#9;long params[3];
</span><span class='line'>&#9;&#9;int status;
</span><span class='line'>&#9;&#9;char*str,*laddr;
</span><span class='line'>&#9;&#9;int toggle =0;
</span><span class='line'>&#9;&#9;while(1) {
</span><span class='line'>&#9;&#9;&#9;wait(&status);
</span><span class='line'>&#9;&#9;&#9;if(WIFEXITED(status))
</span><span class='line'>&#9;&#9;&#9;break;
</span><span class='line'>&#9;&#9;&#9;orig_eax = ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;child,4* ORIG_EAX,
</span><span class='line'>&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;if(orig_eax == SYS_write){
</span><span class='line'>&#9;&#9;&#9;&#9;if(toggle ==0){
</span><span class='line'>&#9;&#9;&#9;&#9;toggle =1;
</span><span class='line'>&#9;&#9;&#9;&#9;params[0]= ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;child,4* EBX,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;&#9;params[1]= ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;child,4* ECX,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;&#9;params[2]= ptrace(PTRACE_PEEKUSER,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;child,4* EDX,
</span><span class='line'>&#9;&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;&#9;str =(char*)calloc((params[2]+1) * sizeof(char));
</span><span class='line'>&#9;&#9;&#9;&#9;getdata(child, params[1], str, params[2]);
</span><span class='line'>&#9;&#9;&#9;&#9;reverse(str);
</span><span class='line'>&#9;&#9;&#9;&#9;putdata(child, params[1], str, params[2]);
</span><span class='line'>&#9;&#9;&#9;} else {
</span><span class='line'>&#9;&#9;&#9;&#9;toggle =0;
</span><span class='line'>&#9;&#9;&#9;}
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;&#9;ptrace(PTRACE_SYSCALL, child, NULL, NULL);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;}
</span><span class='line'>&#9;return0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>输出是这样的：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ppadala@linux:~/ptrace &gt; ls
</span><span class='line'>a.out dummy.s ptrace.txt
</span><span class='line'>libgpm.html registers.c syscallparams.c
</span><span class='line'>dummy ptrace.html simple.c
</span><span class='line'>ppadala@linux:~/ptrace &gt; ./a.out
</span><span class='line'>txt.ecartp s.ymmud tuo.a
</span><span class='line'>c.sretsiger lmth.mpgbil c.llacys_egnahc
</span><span class='line'>c.elpmis lmth.ecartp ymmud</span></code></pre></td></tr></table></div></figure>


<p>这个例子中涵盖了前面讨论过的所有知识点，当然还有些新的内容。这里我们用PTRACE_POKEDATA作为第一个参数，以此来改变子进程中的变量值。它以与PTRACE_PEEKDATA相似的方式工作，当然，它不只是偷窥变量的值了，它可以修改它们。</p>

<h4>单步</h4>

<p>ptrace 提供了对子进程进行单步的功能。 ptrace(PTRACE_SINGLESTEP, …) 会使内核在子进程的每一条指令执行前先将其阻塞，然后将控制权交给父进程。下面的例子可以查出子进程当前将要执行的指令。为了便于理解，我用汇编写了这个受控程序，而不是让你为c的库函数到底会作那些系统调用而头痛。</p>

<p>以下是被控程序的代码 dummy1.s，使用gcc –o dummy1 dummy1.s来编译</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.data
</span><span class='line'>hello:
</span><span class='line'>&#9;.string"hello world\n"
</span><span class='line'>.globl main
</span><span class='line'>main:
</span><span class='line'>&#9;movl $4,%eax
</span><span class='line'>&#9;movl $2,%ebx
</span><span class='line'>&#9;movl $hello,%ecx
</span><span class='line'>&#9;movl $12,%edx
</span><span class='line'>int $0x80
</span><span class='line'>&#9;movl $1,%eax
</span><span class='line'>&#9;xorl %ebx,%ebx
</span><span class='line'>int $0x80
</span><span class='line'>&#9;ret</span></code></pre></td></tr></table></div></figure>


<p>以下的程序则用来完成单步</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;sys/ptrace.h&gt;
</span><span class='line'>#include &lt;sys/types.h&gt;
</span><span class='line'>#include &lt;sys/wait.h&gt;
</span><span class='line'>#include &lt;unistd.h&gt;
</span><span class='line'>#include &lt;linux/user.h&gt;
</span><span class='line'>#include &lt;sys/syscall.h&gt;
</span><span class='line'>int main()
</span><span class='line'>{
</span><span class='line'>&#9;pid_t child;
</span><span class='line'>&#9;const int long_size =sizeof(long);
</span><span class='line'>&#9;child = fork();
</span><span class='line'>&#9;if(child ==0){
</span><span class='line'>&#9;&#9;ptrace(PTRACE_TRACEME,0, NULL, NULL);
</span><span class='line'>&#9;&#9;execl("./dummy1","dummy1", NULL);
</span><span class='line'>&#9;} else {
</span><span class='line'>&#9;&#9;int status;
</span><span class='line'>&#9;&#9;union u {
</span><span class='line'>&#9;&#9;long val;
</span><span class='line'>&#9;&#9;char chars[long_size];
</span><span class='line'>&#9;} data;
</span><span class='line'>&#9;struct user_regs_struct regs;
</span><span class='line'>&#9;int start =0;
</span><span class='line'>&#9;long ins;
</span><span class='line'>&#9;while(1) {
</span><span class='line'>&#9;&#9;wait(&status);
</span><span class='line'>&#9;&#9;if(WIFEXITED(status))
</span><span class='line'>&#9;&#9;break;
</span><span class='line'>&#9;&#9;ptrace(PTRACE_GETREGS, child, NULL,&regs);
</span><span class='line'>&#9;&#9;if(start ==1){
</span><span class='line'>&#9;&#9;&#9;ins = ptrace(PTRACE_PEEKTEXT,
</span><span class='line'>&#9;&#9;&#9;&#9;child, regs.eip,
</span><span class='line'>&#9;&#9;&#9;&#9;NULL);
</span><span class='line'>&#9;&#9;&#9;printf("EIP: %lx Instruction executed: %lx ",
</span><span class='line'>&#9;&#9;&#9;&#9;regs.eip, ins);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;&#9;if(regs.orig_eax== SYS_write){
</span><span class='line'>&#9;&#9;&#9;start =1;
</span><span class='line'>&#9;&#9;&#9;ptrace(PTRACE_SINGLESTEP, child, NULL, NULL);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;&#9;else
</span><span class='line'>&#9;&#9;&#9;ptrace(PTRACE_SYSCALL, child, NULL, NULL);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;}
</span><span class='line'>&#9;return0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>程序的输出是这样的：<br/>
你可能需要察看Intel的用户手册来了解这些指令代码的意思。<br/>
更复杂的单步，比如设置断点，则需要很仔细的设计和更复杂的代码才可以实现。</p>

<p>在第二部分，我们将会看到如何在程序中加入断点，以及将代码插入到已经在运行的程序中</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2011/11/29/tools-ptrace/">linux ptrace函数</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-11-29T19:05:00+08:00'><span class='date'>2011-11-29</span> <span class='time'>19:05:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;sys/ptrace.h&gt;
</span><span class='line'>int ptrace(int request, int pid, int addr, int data);</span></code></pre></td></tr></table></div></figure>


<h5>描述</h5>

<p>Ptrace提供了一种父进程可以控制子进程运行，并可以检查和改变它的核心image。它主要用于实现断点调试。一个被跟踪的进程运行中，直到发生一个信号。则进程被中止，并且通知其父进程。在进程中止的状态下，进程的内存空间可以被读写。父进程还可以使子进程继续执行，并选择是否是否忽略引起中止的信号。</p>

</div>
  
  
    <footer>
      <a rel="full-article" target="_blank" href="/blog/2011/11/29/tools-ptrace/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2011/08/31/assembly-base-3/">AT&T 汇编</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-08-31T13:06:00+08:00'><span class='date'>2011-08-31</span> <span class='time'>13:06:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>AT&amp;T 汇编</p>

<h4>1.Register Reference</h4>

<p>引用寄存器要在寄存器号前加百分号%,如“movl %eax, %ebx”。<br/>
80386 有如下寄存器:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[1] 8 个 32-bit 寄存器 %eax,%ebx,%ecx,%edx,%edi,%esi,%ebp,%esp;
</span><span class='line'>( 8 个 16-bit 寄存器,它们事实上是上面 8 个 32-bit 寄存器的低 16 位:%ax,%bx,
</span><span class='line'>%cx,%dx,%di,%si,%bp,%sp;
</span><span class='line'>8 个 8-bit 寄存器:%ah,%al,%bh,%bl,%ch,%cl,%dh,%dl。它们事实上
</span><span class='line'>是寄存器%ax,%bx,%cx,%dx 的高 8 位和低 8 位;)
</span><span class='line'>[2] 6 个段寄存器:%cs(code),%ds(data),%ss(stack), %es,%fs,%gs;
</span><span class='line'>[3] 3 个控制寄存器:%cr0,%cr2,%cr3;
</span><span class='line'>[4] 6 个 debug 寄存器:%db0,%db1,%db2,%db3,%db6,%db7;
</span><span class='line'>[5] 2 个测试寄存器:%tr6,%tr7;
</span><span class='line'>[6] 8 个浮点寄存器栈:%st(0),%st(1),%st(2),%st(3),%st(4),%st(5),%st(6),%st(7)。</span></code></pre></td></tr></table></div></figure>


<h4>2. Operator Sequence</h4>

<p>操作数排列是从源(左)到目的(右),如“movl %eax(源), %ebx(目的)”</p>

<h4>3. Immediately Operator</h4>

<p>使用立即数,要在数前面加符号$, 如“movl $0x04, %ebx”<br/>
或者:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>para = 0x04
</span><span class='line'>movl $para, %ebx</span></code></pre></td></tr></table></div></figure>


<p>指令执行的结果是将立即数 0x04 装入寄存器 ebx。</p>

<h4>4. Symbol Constant</h4>

<p>符号常数直接引用 如</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>value: .long 0x12a3f2de
</span><span class='line'>movl value , %ebx</span></code></pre></td></tr></table></div></figure>


<p>指令执行的结果是将常数 0x12a3f2de 装入寄存器 ebx。<br/>
引用符号地址在符号前加符号$, 如“movl $value, % ebx”则是将符号 value 的地址装入寄存器 ebx。</p>

<h4>5. Length of Operator</h4>

<p>操作数的长度用加在指令后的符号表示 b(byte, 8-bit), w(word, 16-bits), l(long,32-bits) ,如“movb %al, %bl” ,“movw
%ax, %bx”,“movl %eax, %ebx ”。<br/>
如 果没有指定操作数长度的话,编译器将按照目标操作数的长度来设置。比如指令“mov %ax, %bx”,由于目标操作数 bx 的长度为
word , 那 么 编 译 器 将 把 此 指 令 等 同 于 “ movw %ax,%bx” 。 同 样 道 理 , 指 令 “ mov $4, %ebx” 等 同 于 指 令 “ movl $4,
%ebx”,“push %al”等同于“pushb %al”。对于没有指定操作数长度,但编译器又无法猜测的指令,编译器将会报错,比如指令
“push $4”。</p>

<h4>6. Sign and Zero Extension</h4>

<p>绝大多数面向 80386 的 AT&amp;T 汇编指令与 Intel 格式的汇编指令都是相同的,但符号扩展指令和零扩展指令有不同格式。符号扩展指令
和零扩展指令需要指定源操作数长度和目的操作数长度,即使在某些指令中这些操作数是隐含的。</p>

<p>在 AT&amp;T 语法中,符号扩展和零扩展指令的格式为,基本部分"movs"和"movz"(对应 Intel 语法的 movsx 和 movzx),后面跟
上源操作数长度和目的操作数长度。 movsbl 意味着 movs (from)byte (to)long;movbw 意味着 movs (from)byte
(to)word;movswl 意味着 movs (from)word (to)long。对于 movz 指令也一样。比如指令“movsbl %al,%edx”意味着将
al 寄存器的内容进行符号扩展后放置到 edx 寄存器中。</p>

<p>其它的 Intel 格式的符号扩展指令还有:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cbw -- sign-extend byte in %al to word in %ax;
</span><span class='line'>cwde -- sign-extend word in %ax to long in %eax;
</span><span class='line'>cwd -- sign-extend word in %ax to long in %dx:%ax;
</span><span class='line'>cdq -- sign-extend dword in %eax to quad in %edx:%eax;</span></code></pre></td></tr></table></div></figure>


<p>对应的 AT&amp;T 语法的指令为 cbtw,cwtl,cwtd,cltd。</p>

<h4>7. Call and Jump</h4>

<p>段内调用和跳转指令为 &ldquo;call&rdquo; , &ldquo;ret&rdquo; 和 &ldquo;jmp&rdquo;,段间调用和跳转指令为 &ldquo;lcall&rdquo; , &ldquo;lret&rdquo; 和 &ldquo;ljmp&rdquo; 。段间调用和跳转指令的格式为<br/>
“lcall/ljmp $SECTION, $OFFSET”,而段间返回指令则为“lret $STACK-ADJUST”。</p>

<h4>8. Prefix</h4>

<p>操作码前缀被用在下列的情况:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[1]字符串重复操作指令(rep,repne);
</span><span class='line'>[2]指定被操作的段(cs,ds,ss,es,fs,gs);
</span><span class='line'>[3]进行总线加锁(lock);
</span><span class='line'>[4]指定地址和操作的大小(data16,addr16);</span></code></pre></td></tr></table></div></figure>


<p>在 AT&amp;T 汇编语法中,操作码前缀通常被单独放在一行,后面不跟任何操作数。例如,对于重复 scas 指令,其写法为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>repne
</span><span class='line'>scas</span></code></pre></td></tr></table></div></figure>


<p>上述操作码前缀的意义和用法如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[1]指定被操作的段前缀为 cs,ds,ss,es,fs,和 gs。在 AT&T 语法中,只需要按照
</span><span class='line'>section:memory-operand 的格式就指定了相应的段前缀。比如:
</span><span class='line'>lcall %cs:realmode_swtch
</span><span class='line'>[2]操作数/地址大小前缀是“data16”和"addr16",它们被用来在 32-bit 操作数/地址代码中指定 16-bit 的操作数/地址。
</span><span class='line'>[3]总线加锁前缀“lock”,它是为了在多处理器环境中,保证在当前指令执行期间禁止一切中断。这个前缀仅仅对 ADD, ADC, AND,
</span><span class='line'>BTC, BTR, BTS, CMPXCHG,DEC,
</span><span class='line'>INC, NEG, NOT, OR, SBB, SUB, XOR, XADD,XCHG 指令有效,如果将 Lock 前
</span><span class='line'>缀用在其它指令之前,将会引起异常。
</span><span class='line'>[4]字符串重复操作前缀"rep","repe","repne"用来让字符串操作重复“%ecx”次。</span></code></pre></td></tr></table></div></figure>


<h4>9. Memory Reference</h4>

<p>Intel 语法的间接内存引用的格式为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>section:[base+index*scale+displacement]</span></code></pre></td></tr></table></div></figure>


<p>而在 AT&amp;T 语法中对应的形式为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>section:displacement(base,index,scale)</span></code></pre></td></tr></table></div></figure>


<p>其中,base 和 index 是任意的 32-bit base 和 index 寄存器。scale 可以取值 1,2,4,8。如果不指定 scale 值,则默认值为 1。
section 可以指定任意的段寄存器作为段前缀,默认的段寄存器在不同的情况下不一样。如果在指令中指定了默认的段前缀,则编译器在
目标代码中不会产生此段前缀代码。</p>

<p>下面是一些例子:<br/>
-4(%ebp):base=%ebp,displacement=-4,section 没有指定,由于 base=%ebp,所以默认的 section=%ss,index,scale
没有指定,则 index 为 0。<br/>
foo(,%eax,4):index=%eax,scale=4,displacement=foo。其它域没有指定。这里默认的 section=%ds。<br/>
foo(,1):这个表达式引用的是指针 foo 指向的地址所存放的值。注意这个表达式中没有 base 和 index,并且只有一个逗号,这是一种
异常语法,但却合法。<br/>
%gs:foo:这个表达式引用的是放置于%gs 段里变量 foo 的值。<br/>
如果 call 和 jump 操作在操作数前指定前缀“<em>”,则表示是一个绝对地址调用/跳转,也就是说 jmp/call 指令指定的是一个绝对地址。<br/>
如果没有指定"</em>&ldquo;,则操作数是一个相对地址。<br/>
任何指令如果其操作数是一个内存操作, 则指令必须指定它的操作尺寸<br/>
(byte,word,long),也就是说必须带有指令后缀(b,w,l)。<br/>
Linux 工作在保护模式下,用的是 32 位线性地址,所以在计算地址时不用考虑段基址和偏移量,而是采用如下的地<br/>
址计算方法:<br/>
disp + base + index * scale<br/>
下面是一些内存操作数的例子:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>AT&T 格式
</span><span class='line'>movl -4(%ebp), %eax
</span><span class='line'>movl array(, %eax, 4), %eax
</span><span class='line'>movw array(%ebx, %eax, 4), %cx
</span><span class='line'>movb $4, %fs:(%eax)</span></code></pre></td></tr></table></div></figure>


<p>其中下面这些省略了浮点数及 IA-32 如 SSE FPU 等特殊的指令集部分, 我觉得重要的是学习
linux 汇编的语法及编译原理和程序控制流程, 具体的指令细节就不那么重要了。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2011/08/27/assembly-base-2/">LINUX汇编</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-08-27T22:39:00+08:00'><span class='date'>2011-08-27</span> <span class='time'>22:39:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>一, IA-32 硬件特性</h3>

<h4>寄存器:</h4>

<h5>1, 通用寄存器, 用于存放正在处理的数据</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>EAX 用于操作数和结果数的累加器
</span><span class='line'>EBX 指向数据内存断中的数据的指针
</span><span class='line'>ECX 字符串和循环操作的计数器
</span><span class='line'>EDX IO指针
</span><span class='line'>EDI 用于字符串操作的目标的数据指针
</span><span class='line'>ESI 用于字符串操作的源的数据指针
</span><span class='line'>ESP 堆栈指针
</span><span class='line'>EBP 堆栈数据指针</span></code></pre></td></tr></table></div></figure>


<p>其中寄存器EAX, EBX, ECX, EDX又可以通过16位和8位寄存器名称引用
如EAX, AX 引用EAX低16位, AL 引用EAX低8位, AH 引用AL之后的高8位</p>

<h5>2, 段寄存器:</h5>

<p>IA-32平台允许使用3中内存模型: 平坦内存模式 分段内存模式 实地址模式</p>

<p>平坦内存: 把全部的系统内存表示为连续的地址空间， 通过线性地址的特定地址访问内存位置.</p>

<p>分段内存: 把系统内存划分为独立的段组, 通过位于寄存器中的指针进行引用. 每个段用于包含特定类型的数据。 一个段用于包含指令码, 另一个段包含数据元素, 第三个段包含数据堆栈。段中的内存位置是通过逻辑地址引用的, 逻辑地址是由段地址加上偏移量构成， 处理器把逻辑地址转换为相应的线性地址以便访问。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>段寄存器：
</span><span class='line'>CS 代码段
</span><span class='line'>DS 数据段
</span><span class='line'>SS 堆栈段
</span><span class='line'>ES 附加段指针
</span><span class='line'>FS 附加段指针
</span><span class='line'>GS 附加段指针</span></code></pre></td></tr></table></div></figure>


<p>每个段寄存器都是16位的， 包含指向内存特定段起始位置的指针，程序不能显示加载或改变CS寄存器, DS, ES, FS, GS都用于指向数据段, 通过4个独立的段, 程序可以分隔数据元素， 确保他们不会重叠， 程序必须加载带有段的正确指针值的数据段寄存器， 并且使用偏移值引用各个内存的位置。SS段寄存器用于指向堆栈段, 堆栈包含传递给函数和过程的数据值。</p>

<p>实地址: 如果实地址模式, 所有段寄存器都指向线性0地址， 并且都不会被程序改动，所有的指令码 数据元素 堆栈元素 都是通过他们的线性地址直接访问的。</p>

<h5>3， 指令指针寄存器</h5>

<p>是EIP寄存器, 它跟踪要执行程序的下一条指令代码, 应用程序不能修改指令指针本身，不能指定内存地址把它拖放EIP寄存器中，相反必须通过一般的跳转指令来改变预存取缓存的下一条指令。</p>

<p>在平坦内存模型中， 指令指针包含下一条指令码的线性地址, 在分段模型中指令指针包含逻辑地址指针， 通过CS寄存器的内存引用。</p>

<h5>4, 控制寄存器</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CRO 控制操作模式 和 处理器当前状态的系统标志
</span><span class='line'>CR1 当前没有使用
</span><span class='line'>CR2 内存页面错误信息
</span><span class='line'>CR3 内存页面目录信息
</span><span class='line'>CR4 支持处理器特性和说明处理器特性能力的标志</span></code></pre></td></tr></table></div></figure>


<p>不能直接访问控制寄存器, 但是能把控制寄存器中的值传递给通用寄存器，如果必须改动控制寄存器的标志， 可以改动通用寄存器的值， 然后把内容传递给控制寄存器。</p>

<h4>标志:</h4>

<p>IA-32使用单一的寄存器来包含一组状态控制和系统标志, EFLAGS寄存器包含32位标志信息</p>

<h5>1, 状态标志</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>标志 位 说明
</span><span class='line'>CF 0 进位标志, 如果无符号数的数学操作产生最高有效位的进位或者借位, 此时值为1
</span><span class='line'>PF 2 奇偶校验标志, 用于表明数学操作的结果寄存器中的是否包含错误数据
</span><span class='line'>AF 4 辅助进位标志, 用于二进制编码的10进制(BCD)的数学操作中， 如果用于运算的
</span><span class='line'>寄存器的第三位发生进位或借位， 该值为1
</span><span class='line'>ZF 6 0标志, 如果操作为0， 则该值为1
</span><span class='line'>SF 7 符号标志, 设置为结果的最高有效位, 这一位是符号位表明结果是正值还是负值
</span><span class='line'>OF 11 溢出标志</span></code></pre></td></tr></table></div></figure>


<h5>2, 控制标志</h5>

<p>当前只定义了一个控制标志DF即方向标志, 用于控制处理器处理字符串的方式
如果设置为1, 字符串指令自动递减内存地址以便到达字符串中的下一字节。
反之。</p>

<h5>3, 系统标志</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>标志 位 说明
</span><span class='line'>TF 8 陷阱标志, 设置为1时启用单步模式, 在单步模式下处理器每次只执行一条命令。
</span><span class='line'>IF 9 中断使能标志, 控制处理器如响应从外部源接收到的信号。
</span><span class='line'>IOPL 12和13 IO特权级别标志, 表明当前正在运行任务的IO特权级别, 它定义IO地址空间的
</span><span class='line'>特权访问级别, 该值必须小于或者等于访问I/O地址空间的级别; 否则任何访问
</span><span class='line'>IO空间的请求都会被拒绝！
</span><span class='line'>NT 14 嵌套任务标志控制当前运行的任务是否连接到前一个任务, 它用于连接被中断
</span><span class='line'>和被调用的任务.
</span><span class='line'>RF 16 恢复标志用于控制在调试模式中如何响应异常。
</span><span class='line'>VM 17 虚拟8086模式, 表明处理器在虚拟8086模式中而不是保护模式或者实模式。
</span><span class='line'>AC 18 对准检查标志, 用于启用内存引用的对准检查
</span><span class='line'>VIF 19 虚拟中断标志, 当处理器在虚拟模式中操作时, 该标志起IF标志的作用.
</span><span class='line'>VIP 20 虚拟中断挂起标志, 在虚拟模式操作时用于表示一个中断正在被挂起。
</span><span class='line'>ID 21 表示CPU是否支持cpuid指令, 如果处理器能够设置或者清零这个标志, 表示
</span><span class='line'>处理器支持该指令。</span></code></pre></td></tr></table></div></figure>


<h3>二，GNU汇编工具系列</h3>

<h4>1, 二进制工具系列</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>addr2line 把地址转换成文件名或者行号
</span><span class='line'>ar 创建 修改或者展开文件存档
</span><span class='line'>as 把汇编语言代码汇编成目标代码
</span><span class='line'>c++filt 还原c++符号的过滤器
</span><span class='line'>gprof 显示程序简档信息的程序
</span><span class='line'>ld 把目标代码文件转换成可执行文件的转换器
</span><span class='line'>nm 列出目标文件中的符号
</span><span class='line'>objcopy 复制或翻译目标文件
</span><span class='line'>objdump 显示来自目标文件的信息
</span><span class='line'>ranlib 生成存档文件内容的索引
</span><span class='line'>readelf 按照elf格式显示目标文件信息
</span><span class='line'>size 列出目标文件或者存档文件的段长度
</span><span class='line'>strings 显示目标文件中可打印字符串
</span><span class='line'>strip 丢弃符号
</span><span class='line'>windres 编译Microsoft Windows资源文件</span></code></pre></td></tr></table></div></figure>


<h4>2, GNU编译器</h4>

<p>gcc</p>

<h4>3, GNU调试程序</h4>

<p>gdb</p>

<h3>三, GNU汇编语言结构</h3>

<p>主要包括三个常用的段：
data 数据段 声明带有初始值的元素<br/>
bss 数据段 声明使用0或者null初始化的元素<br/>
text 正文段 包含的指令, 每个汇编程序都必须包含此段</p>

<p>使用.section 指令定义段, 如:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.section .data
</span><span class='line'>.section .bss
</span><span class='line'>.section .text</span></code></pre></td></tr></table></div></figure>


<h4>起始点:</h4>

<p>gnu汇编器使用<em>start标签表示默认的起始点, 此外如果想要汇编内部的标签能够被外部程序访问,
需要使用.globl 指令, 如:.globl </em>start</p>

<p>使用通用库函数时可以使用:<br/>
ld -dynamic-linker /lib/ld-linux.so.2</p>

<h3>四, 数据传递</h3>

<h4>1, 数据段</h4>

<p>使用.data声明数据段, 这个段中声明的任何数据元素都保留在内存中并可以被汇编程序的指令读取,
此外还可以使用.rodata声明只读的数据段, 在声明一个数据元素时, 需要使用标签和命令:</p>

<p>标签:用做引用数据元素所使用的标记， 它和c语言的变量很相似, 它对于处理器是没有意义的, 它
只是用做汇编器试图访问内存位置时用做引用指针的一个位置。</p>

<p>指令:这个名字指示汇编器为通过标签引用的数据元素保留特定数量的内存， 声明命令之后必须给出
一个或多个默认值。</p>

<p>声明指令:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.ascii 文本字符串
</span><span class='line'>.asciz 以空字符结尾的字符串
</span><span class='line'>.byte 字节值
</span><span class='line'>.double 双精度浮点值
</span><span class='line'>.float 单精度浮点值
</span><span class='line'>.int 32位整数
</span><span class='line'>.long 32位整数, 和int相同
</span><span class='line'>.octa 16字节整数
</span><span class='line'>.quad 8字节整数
</span><span class='line'>.short 16位整数
</span><span class='line'>.single 单精度浮点数(和float相同)
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>例子:
</span><span class='line'>output:
</span><span class='line'>.ascii "hello world."
</span><span class='line'>
</span><span class='line'>pi:
</span><span class='line'>.float 2.14
</span><span class='line'>
</span><span class='line'>声明可以在一行中定义多个值, 如:
</span><span class='line'>ages:
</span><span class='line'>.int 20, 10, 30, 40</span></code></pre></td></tr></table></div></figure>


<p>定义静态符号:<br/>
使用.equ命令把常量值定义为可以在文本段中使用的符号，如:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.section .data
</span><span class='line'>.equ LINUX_SYS_CALL, 0x80
</span><span class='line'>.section .text
</span><span class='line'>movl $LINUX_SYS_CALL, %eax</span></code></pre></td></tr></table></div></figure>


<h4>2, bss段</h4>

<p>和data段不同, 无需声明特定的数据类型, 只需声明为所需目的保留的原始内存部分即可。
GNU汇编器使用以下两个命令声明内存区域:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.comm 声明为未初始化的通用内存区域
</span><span class='line'>.lcomm 声明为未初始化的本地内存区域</span></code></pre></td></tr></table></div></figure>


<p>两种声明很相似， 但.lcomm是为不会从本地汇编代码之外进行访问的数据保留的， 格式为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.comm/.lcomm symbol, length</span></code></pre></td></tr></table></div></figure>


<p>例子:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.section .bss
</span><span class='line'>.lcomm buffer, 1000</span></code></pre></td></tr></table></div></figure>


<p>该语句把1000字节的内存地址赋予标签buffer, 在声明本地通用内存区域的程序之外的函数是
不能访问他们的.(不能在.globl命令中使用他们)</p>

<p>在bss段声明的好处是, 数据不包含在可执行文件中。在数据段中定义数据时, 它必须被包含在
可执行程序中, 因为必须使用特定值初始化它。 因为不使用数据初始化bss段中声明的数据区域,
所以内存区域被保留在运行时使用, 并且不必包含在最终的程序中</p>

<h4>3， 传送数据</h4>

<p>move 指令: 格式 movex 源操作数, 目的操作数。 其中x为要传送数据的长度, 取值有:
l 用于32位的长字节<br/>
w 用于16位的字<br/>
b 用于8位的字节值</p>

<p>立即数前面要加一个$符号, 寄存器前面要加%符号。<br/>
8个通用的寄存器是用于保存数据的最常用的寄存器, 这些寄存器的内容可以传递
给其他的任何可用的寄存器。 和通用寄存器不同, 专用寄存器(控制, 调试, 段)
的内容只能传送给通用寄存器, 或者接收从通用寄存器传过来的内容。</p>

<p>在对标签进行引用时:
例：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.section .data
</span><span class='line'>value:
</span><span class='line'>.int 100
</span><span class='line'>_start:
</span><span class='line'>movl value, %eax
</span><span class='line'>movl $value, %eax
</span><span class='line'>movl %ebx, (%edi)
</span><span class='line'>movl %ebx, 4(%edi)</span></code></pre></td></tr></table></div></figure>


<p>其中:<br/>
movl value, %eax 只是把标签value当前引用的内存值传递给eax<br/>
movl $value, %eax 把标签value当前引用的内存地址指针传递给eax<br/>
movl %ebx, (%edi) 如果edi外面没有括号那么这个指令只是把ebx中的<br/>
值加载到edi中, 如果有了括号就表示把ebx中的内容<br/>
传送给edi中包含的内存位置。<br/>
movl %ebx, 4（%edi) 表示把edi中的值放在edi指向的位置之后的4字节内存位置中<br/>
movl %ebx, -4(%edi) 表示把edi中的值放在edi指向的位置之前的4字节内存位置中</p>

<p>cmove 指令(条件转移): cmovex 源操作数, 目的操作数. x的取值为:<br/>
无符号数:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a/nbe 大于/不小于或者等于
</span><span class='line'>ae/nb 大于或者等于/不小于
</span><span class='line'>nc 无进位
</span><span class='line'>b/nae 小于/不大于等于
</span><span class='line'>c 进位
</span><span class='line'>be/na 小于或等于/不大于
</span><span class='line'>e/z 等于/零
</span><span class='line'>ne/nz 不等于/不为零
</span><span class='line'>p/pe 奇偶校验/偶校验
</span><span class='line'>np/po 非奇偶校验/奇校验</span></code></pre></td></tr></table></div></figure>


<p>有符号数:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ge/nl 大于或者等于/不小于
</span><span class='line'>l/nge 小于/不大于或者等于
</span><span class='line'>le/ng 小于或者等于/不大于
</span><span class='line'>o 溢出
</span><span class='line'>no 未溢出
</span><span class='line'>s 带符号（负)
</span><span class='line'>ns 无符号(非负)</span></code></pre></td></tr></table></div></figure>


<p>交换数据: xchg 在两个寄存器之间或者寄存器和内存间交换值。如:<br/>
xchg 操作数, 操作数, 要求两个操作数必须长度相同且不能同时都是内存位置<br/>
其中寄存器可以是32，16，8位的</p>

<p>bswap 反转一个32位寄存器的字节顺序<br/>
如: bswap %ebx</p>

<p>xadd 交换两个值 并把两个值只和存储在目标操作数中<br/>
如: xadd 源操作数,目标操作数<br/>
其中源操作数必须是寄存器, 目标操作数可以是内存位置也可以是寄存器<br/>
其中寄存器可以是32，16，8位的</p>

<p>cmpxchg<br/>
cmpxchg source, destination<br/>
其中source必须是寄存器, destination可以是内存或者寄存器, 用来比较
两者的值, 如果相等，就把源操作数的值加载到目标操作数中, 如果不等就把
目标操作数加载到源操作数中，其中寄存器可以是32，16，8位的, 其中源操作
数是EAX,AX或者AL寄存器中的值</p>

<p>cmpxchg8b 同cmpxchg， 但是它处理8字节值， 同时它只有一个操作数<br/>
cmpxchg8b destination<br/>
其中destination引用一个内存位置, 其中的8字节值会与EDX和EAX寄存器中
包含的值(EDX高位寄存器, EAX低位寄存器)进行比较, 如果目标值和EDX:EAX
对中的值相等, 就把EDX:EAX对中的64位值传递给内存位置, 如果不匹配就把
内存地址中的值加载到EDX:EAX对中</p>

<h4>4, 堆栈</h4>

<p>ESP 寄存器保存了当前堆栈的起始位置, 当一个数据压入栈时， 它就会自动递减,反之其自动递增<br/>
压入堆栈操作:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pushx source, x取值为:
</span><span class='line'>l 32位长字
</span><span class='line'>w 16位字</span></code></pre></td></tr></table></div></figure>


<p>*出堆栈操作:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>popx source</span></code></pre></td></tr></table></div></figure>


<p>其中source必须是16或32位寄存器或者内存位置, 当pop最后一个元素时ESP值应该和以前的相等</p>

<h4>5，压入和*出所有寄存器</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pusha/popa 压入或者*出所有16位通用寄存器
</span><span class='line'>pushad/popad 压入或者*出所有32位通用寄存器
</span><span class='line'>pushf/popf 压入或者*出EFLAGS寄存器的低16位
</span><span class='line'>pushfd/popfd 压入或者*出EFLAGS寄存器的全部32位</span></code></pre></td></tr></table></div></figure>


<h4>6，数据地址对齐</h4>

<p>gas 汇编器支持.align 命令， 它用于在特定的内存边界对准定义的数据元素， 在数据段中.align命令紧贴在数据定义的前面</p>

<h3>五，控制流程</h3>

<h4>无条件跳转:</h4>

<h5>1, 跳转</h5>

<p>jmp location 其中location为要跳转到的内存地址, 在汇编中为定义的标签</p>

<h5>2，调用</h5>

<p>调用指令分为两个部分:<br/>
1, 调用call address 跳转到指定位置<br/>
2, 返回指令ret, 它没有参数紧跟在call指令后面的位置</p>

<p>执行call指令时，它把EIP的值放到堆栈中， 然后修改EIP以指向被调用的函数地址， 当被调用函数完成后， 它从堆栈获取过去的EIP的值， 并把控制权返还给原始程序。</p>

<h5>3，中断</h5>

<p>由硬件设备生成中断。 程序生成软件中断
当一个程序产生中断调用时, 发出调用的程序暂停, 被调用的程序接替它运行, 指令指针被转移到被调用的函数地址， 当调用完成时使用中断返回指令可以返回调原始程序。</p>

<h4>条件跳转：</h4>

<p>条件跳转按照EFLAGS中的值来判断是否该跳转, 格式为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jxx address, 其中xx是1－3个字符的条件代码, 取值如下:
</span><span class='line'>a 大于时跳转
</span><span class='line'>ae 大于等于
</span><span class='line'>b 小于
</span><span class='line'>be 小于等于
</span><span class='line'>c 进位
</span><span class='line'>cxz 如果CX寄存器为0
</span><span class='line'>ecxz 如果ECS寄存器为0
</span><span class='line'>e 相等
</span><span class='line'>na 不大于
</span><span class='line'>nae 不大于或者等于
</span><span class='line'>nb 不小于
</span><span class='line'>nbe 不小于或等于
</span><span class='line'>nc 无进位
</span><span class='line'>ne 不等于
</span><span class='line'>g 大于(有符号)
</span><span class='line'>ge 大于等于(有符号)
</span><span class='line'>l 小于(有符号)
</span><span class='line'>le 小于等于(有符号)
</span><span class='line'>ng 不大于(有符号)
</span><span class='line'>nge 不大于等于(有符号)
</span><span class='line'>nl 不小于
</span><span class='line'>nle 不小于等于
</span><span class='line'>no 不溢出
</span><span class='line'>np 不奇偶校验
</span><span class='line'>ns 无符号
</span><span class='line'>nz 非零
</span><span class='line'>o 溢出
</span><span class='line'>p 奇偶校验
</span><span class='line'>pe 如果偶校验
</span><span class='line'>po 如果奇校验
</span><span class='line'>s 如果带符号
</span><span class='line'>z 如果为零</span></code></pre></td></tr></table></div></figure>


<p>条件跳转不支持分段内存模型下的远跳转， 如果在该模式下进行程序设计必须使用程序逻辑确定条件是否存在, 然后实现无条件跳转, 跳转前必须设置EFLAGS寄存器</p>

<p>比较:<br/>
cmp operend1, operend2</p>

<p>进位标志修改指令:<br/>
CLC 清空进位标志(设置为0)<br/>
CMC 对进位标志求反(把它改变为相反的值)<br/>
STC 设置进位标志(设置为1)</p>

<p>循环:<br/>
loop 循环直到ECX寄存器为0<br/>
loope/loopz 循环直到ecx寄存器为0 或者没有设置ZF标志<br/>
loopne/loopnz 循环直到ecx为0或者设置了ZF标志</p>

<p>指令格式为: loopxx address 注意循环指令只支持8位偏移地址</p>

<h3>六，数字</h3>

<p>IA-32平台中存储超过一字节的数都被存储为小尾数的形式但是把数字传递给寄存器时, 寄存器里面保存是按照大尾数的形式存储</p>

<p>把无符号数转换成位数更大的值时， 必须确保所有的高位部分都被设置为零</p>

<p>把有符号数转换成位数更大的数时:<br/>
intel 提供了movsx指令它允许扩展带符号数并保留符号, 它与movzx相似, 但是它假设要传送的字节是带符号数形式</p>

<h4>浮点数:</h4>

<p>fld 指令用于把浮点数字传送入和传送出FPU寄存器, 格式:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>fld source</span></code></pre></td></tr></table></div></figure>


<p>其中source可以为32 64或者80位整数值</p>

<p>IA-32使用FLD指令用于把存储在内存中的单精度和双精度浮点值FPU寄存器堆栈中， 为了区分这两种长度GNU汇编器使用FLDS加载单精度浮点数, FLDL加载双精度浮点数</p>

<p>类似FST用于获取FPU寄存器堆栈中顶部的值, 并且把这个值放到内存位置中, 对于单精度使用FSTS, 对于双精度使用FSTL</p>

<h3>七，基本数学运算</h3>

<h5>1, 加法</h5>

<p>ADD source, destination 把两个整数相加<br/>
其中source可以是立即数内存或者寄存器, destination可以是内存或者寄存器, 但是两者不能同时都是内存位置</p>

<p>ADC 和ADD相似进行加法运算, 但是它把前一个ADD指令的产生进位标志的值包含在其中, 在处理位数大于32(如64)位的整数时, 该指令非常有用</p>

<h5>2, 减法</h5>

<p>SUB source, destination 把两个整数相减
NEG 它生成值的补码<br/>
SBB 指令, 和加法操作一样, 可以使用进位情况帮助执行大的无符号数值的减法运算. SBB在多字节减法操作中利用<br/>
进位和溢出标志实现跨数据边界的的借位特性</p>

<h5>3，递增和递减</h5>

<p>dec destination 递减<br/>
inc destination 递增<br/>
其中dec和inc指令都不会影响进位标志, 所以递增或递减计数器的值都不会影响程序中涉及进位标志的其他任何运算</p>

<h5>4, 乘法</h5>

<p>mul source 进行无符号数相乘
它使用隐含的目标操作数, 目标位置总是使用eax的某种形式, 这取决与源操作数的长度， 因此根据源操作数的长度,
目标操作数必须放在AL, AX, EAX中。 此外由于乘法可能产生很大的值, 目标位置必须是源操作数的两倍位置, 源为
8时, 应该是16, 源为16时, 应该为32, 但是当源为16位时intel为了向下兼容, 目标操作数不是存放在eax中, 而
是分别存放在DX:AX中, 结果高位存储在DX中, 地位存储在AX中。对于32位的源, 目标操作数存储在EDX:EAX中, 其中
EDX存储的是高32位, EAX存储的是低32位</p>

<p>imul source 进行有符号数乘法运算, 其中的目标操作数和mul的一样</p>

<p>imul source, destination 也可以执行有符号乘法运算, 但是此时可以把目标放在指定的位置, 使用这种格式的缺陷
在与乘法的操作结果被限制为单一目标寄存器的长度.</p>

<p>imul multiplier, source, destination
其中multiplier是一个立即数, 这种方式允许一个值与给定的源操作数进行快速的乘法运算, 然后把结果存储在通用
寄存器中</p>

<h5>5, 除法</h5>

<p>div divisor 执行无符号数除法运算
除数的最大值取决与被除数的长度, 对于16位被除数 ,除数只能为8位, 32或64位同上
被除数 被除数长度 商 余数<br/>
AX 16位 AL AH<br/>
DX:AX 32位 AX DX<br/>
EDX:EAX 64位 EAX EDX</p>

<p>idiv divisor 执行有符号数的除法运算, 方式和div一样</p>

<h5>6, 移位</h5>

<p>左移位:<br/>
sal 向左移位<br/>
sal destination 把destination向左移动1位<br/>
sal %cl, destination 把destination的值向左移动CL寄存器中指定的位数<br/>
sal shifter, destination 把destination的值向左移动shifter值指定的位数<br/>
向左移位可以对带符号数和无符号数执行向左移位的操作, 移位造成的空位用零填充, 移位造成的超过数据长度的任何位
都被存放在进位标志中, 然后在下一次移位操作中被丢弃</p>

<p>右移位:<br/>
shr向右移位<br/>
sar向右移位<br/>
SHR指令清空移位造成的空位, 所以它只能对无符号数进行移位操作<br/>
SAR指令根据整数的符号位, 要么清空, 要么设置移位造成的空位, 对于负数, 空位被设置为1</p>

<p>循环移位:<br/>
和移位指令类似, 只不过溢出的位被存放回值的另一端, 而不是丢弃<br/>
ROL 向左循环移位<br/>
ROR 向右循环移位<br/>
RCL 向左循环移位, 并且包含进位标志<br/>
RCR 向右循环移位, 并且包含进位标志</p>

<h5>7, 逻辑运算</h5>

<p>AND OR XOR<br/>
这些指令使用相同的格式:<br/>
and source, destination<br/>
其中source可以是8位 16 位或者32位的立即值 寄存器或内存中的值, destination可以是8位 16 位或者
32位寄存器或内存中的值, 不能同时使用内存值作为源和目标。 布尔逻辑功能对源和目标执行按位操作。
也就是说使用指定的逻辑功能按照顺序对数据的元素的每个位进行单独比较。</p>

<p>NOT指令使用单一操作数, 它即是源值也是目标结果的位置
清空寄存器的最高效方式是使用OR指令对寄存器和它本身进行异或操作.当和本身进行XOR操作时, 每个设置为
1的位就变为0， 每个设置为0的位也变位0。</p>

<p>位测试可以使用以上的逻辑运算指令, 但这些指令会修改destination的值, 因此intel提供了test指令, 它不
会修改目标值而是设置相应的标志</p>

<h3>八，字符串处理</h3>

<h5>1, 传送字符串</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>movs 有三种格式
</span><span class='line'>movsb 传送单一字节
</span><span class='line'>movsw 传送一个字
</span><span class='line'>movsl 传送双字</span></code></pre></td></tr></table></div></figure>


<p>movs指令使用隐含的源和目的操作数， 隐含的源操作数是ESI， 隐含的目的操作数是EDI， 有两种方式加载内存地址到
ESI和EDI， 第一种是使用标签间接寻址 movl $output, %ESI, 第二种是使用lea指令, lea指令加载对象的地址到指定
的目的操作数如lea output, %esi, 每次执行movs指令后， 数据传送后ESI和EDI寄存器会自动改变，为另一次传送做
准备, ESI和EDI可能随着标志DF的不同自动递增或者自动递减， 如果DF标志为0则movs指令后ESI和EDI会递增, 反之会
递减， 为了设置DF标志, 可以使用一下指令:<br/>
CLD 将DF标志清零<br/>
STD 设置DF标志</p>

<h5>2，rep前缀</h5>

<p>REP 指令的特殊之处在与它不执行什么操作, 这条指令用于按照特定次数重复执行字符串指令, 有ECX寄存器控制,
但不需要额外的loop指令, 如rep movsl<br/>
rep的其他格式:<br/>
repe 等于时重复<br/>
repne 不等于时重复<br/>
repnz 不为零时重复<br/>
repz 为零时重复</p>

<h5>3, 存储和加载字符串</h5>

<p>LODS 加载字符串, ESI为源, 当一次执行完lods时会递增或递减ESI寄存器， 然后把字符串值存放到EAX中</p>

<p>STOS 使用lods把字符串值加载到EAX后， 可以使用它把EAX中的值存储到内存中去:
stos使用EDI作为目的操作数, 执行stos指令后, 会根据DF的值自动递增或者递减EDI中的值</p>

<h5>4, 比较字符串</h5>

<p>cmps 和其他的操作字符串的指令一样, 隐含的源和目标操作数都为ESI和EDI, 每次执行时都会根据DF的值把
ESI和EDI递增或者递减, cmps指令从目标字符串中减去源字符串, 执行后会设置EFLAGS寄存器的状态.</p>

<h5>5，扫描字符串</h5>

<p>scas 把EDI作为目标, 它把EDI中的字符串和EAX中的字符串进行比较 ,然后根据DF的值递增或者递减EDI</p>

<h3>九，使用函数</h3>

<p>GNU汇编语言定义函数的语法:<br/>
.type 标签(也就是函数名), @function<br/>
ret 返回到调用处</p>

<h3>十，linux系统调用</h3>

<p>linux系统调用的中断向量为0x80</p>

<p>1, 系统调用标识存放在%eax中<br/>
2, 系统调用输入值:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>EBX 第一个参数
</span><span class='line'>ECX 第二个参数
</span><span class='line'>EDX 第三个参数
</span><span class='line'>ESI 第四个参数
</span><span class='line'>EDI 第五个参数</span></code></pre></td></tr></table></div></figure>


<p>需要输入超过6个输入参数的系统调用, EBX指针用于保存指向输入参数内存位置的指针, 输入参数按照连续的的顺序
存储, 系统调用的返回值存放在EAX中</p>

<h3>十一，汇编语言的高级功能</h3>

<h4>1，gnu内联汇编的语法:</h4>

<p><code>asm</code>或<code>__asm__</code>(&ldquo;汇编代码&rdquo;);
指令必须包含在引号里
如果包含的指令超过一行 必须使用新行分隔符分隔</p>

<p>使用c全局变量, 不能在内联汇编中使用局部变量, 注意在汇编语言代码中值被用做内存位置, 而不是立即数值</p>

<p>如果不希望优化内联汇编, 则可以volatile修饰符如:<code>__asm__ volatile</code>（"code");</p>

<h4>2，GCC内联汇编的扩展语法</h4>

<p><code>__asm__("assembly code":output locations:input operands:changed registers);</code>
第一部分是汇编代码
第二部分是输出位置, 包含内联汇编代码的输出值的寄存器和内存位置列表
第三部分是输入操作数，包含内联汇编代码输入值的寄存器和内存位置的列表
第四部分是改动的寄存器， 内联汇编改变的任何其他寄存器的列表
这几个部分可以不全有, 但是没有的还必须使用:分隔</p>

<h5>1, 指定输入值和输出值， 输入值和输出值的列表格式为:</h5>

<p>&ldquo;constraint&rdquo;(variable), 其中variable是程序中声明的c变量, 在扩展asm格式中， 局部和全局变量都可以使用,
使用constrant（约束)定义把变量存放到哪(输入)或从哪里传送变量(输出)
约束使用单一的字符, 如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>约束 描述
</span><span class='line'>a 使用%eax, %ax, %al寄存器
</span><span class='line'>b 使用%ebx, %bx, %bl寄存器
</span><span class='line'>c 使用%ecx, %cx, %cl寄存器
</span><span class='line'>d 使用%edx, %dx, %dl寄存器
</span><span class='line'>S 使用%esi, %si寄存器
</span><span class='line'>D 使用%edi, %di寄存器
</span><span class='line'>r 使用任何可用的通用寄存器
</span><span class='line'>q 使用%eax, %ebx, %ecx,%edx之一
</span><span class='line'>A 对于64位值使用%eax, %edx寄存器
</span><span class='line'>f 使用浮点寄存器
</span><span class='line'>t 使用第一个(顶部)的浮点寄存器
</span><span class='line'>u 使用第二个浮点寄存器
</span><span class='line'>m 使用变量的内存位置
</span><span class='line'>o 使用偏移内存位置
</span><span class='line'>V 只使用直接内存位置
</span><span class='line'>i 使用立即整数值
</span><span class='line'>n 使用值已知的立即整数值
</span><span class='line'>g 使用任何可用的寄存器和内存位置</span></code></pre></td></tr></table></div></figure>


<p>除了这些约束之外, 输出值还包含一个约束修饰符:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>输出修饰符 描述
</span><span class='line'>+ 可以读取和写入操作数
</span><span class='line'>= 只能写入操作数
</span><span class='line'>% 如果有必要操作数可以和下一个操作数切换
</span><span class='line'>& 在内联函数完成之前, 可以删除和重新使用操作数</span></code></pre></td></tr></table></div></figure>


<p>如:<br/>
<code>__asm__("assembly code": "=a"(result):"d"(data1),"c"(data2));</code>
把c变量data1存放在edx寄存器中, 把c变量data2存放到ecx寄存器中, 内联汇编的结果
将存放在eax寄存器中, 然后传送给变量result</p>

<p>在扩展的asm语句块中如果要使用寄存器必须使用两个百分号符号</p>

<p>不一定总要在内联汇编代码中指定输出值, 一些汇编指令假定输入值包含输出值, 如movs指令</p>

<h5>其他扩展内联汇编知识:</h5>

<h6>1, 使用占位符</h6>

<p>输入值存放在内联汇编段中声明的特定寄存器中, 并且在汇编指令中专门使用这些寄存器.
虽然这种方式能够很好的处理只有几个输入值的情况, 但对于需要很多输入值的情况, 这
中方式显的有点繁琐. 为了帮助解决这个问题, 扩展asm格式提供了占位符, 可以在内联
汇编代码中使用它引用输入和输出值.</p>

<p>占位符是前面加上百分号的数字, 按照内联汇编中列出的每个输入和输出值在列表中的位置,
每个值被赋予从0开始的地方. 然后就可以在汇编代码中引用占位符来表示值。</p>

<p>如果内联汇编代码中的输入和输出值共享程序中相同的c变量, 则可以指定使用占位符作为
约束值, 如:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>__asm__("imull %1, %0"
</span><span class='line'>: "=r"(data2)
</span><span class='line'>: "r"(data1), "0"(data2));</span></code></pre></td></tr></table></div></figure>


<p>如输入输出值**享相同的变量data2， 而在输入变量中则可以使用标记0作为输入参数的约束</p>

<h6>2, 替换占位符</h6>

<p>如果处理很多输入和输出值, 数字型的占位符很快就会变的很混乱, 为了使条理清晰 ,GNU汇编
器(从版本3.1开始)允许声明替换的名称作为占位符.替换的名称在声明输入值和输出值的段中
定义, 格式如下:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>%[name]"constraint"(variable)
</span><span class='line'>定义的值name成为内联汇编代码中变量的新的占位符号标识, 如下面的例子:
</span><span class='line'>__asm__("imull %[value1], %[value2]"
</span><span class='line'>: [value2] "=r"(data2)
</span><span class='line'>: [value1] "r"(data1), "0"(data2));</span></code></pre></td></tr></table></div></figure>


<h6>3, 改动寄存器列表</h6>

<p>编译器假设输入值和输出值使用的寄存器会被改动, 并且相应的作出处理。程序员不需要在改动的
寄存器列表中包含这些值, 如果这样做了, 就会产生错误消息. 注意改动的寄存器列表中的寄存器
使用完整的寄存器名称, 而不像输入和输出寄存器定义的那样仅仅是单一字母。 在寄存器名称前面
使用百分号符号是可选的。</p>

<p>改动寄存器列表的正确使用方法是, 如果内联汇编代码使用了没有被初始化地声明为输入或者输出
值的其他任何寄存器 , 则要通知编译器。编译器必须知道这些寄存器, 以避免使用他们。如:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int main(void) {
</span><span class='line'>int data1 = 10;
</span><span class='line'>int result = 20;
</span><span class='line'>
</span><span class='line'>__asm__("movl %1, %%eax\n\t"
</span><span class='line'>"addl %%eax, %0"
</span><span class='line'>: "=r"(result)
</span><span class='line'>: "r"(data1), "0"(result)
</span><span class='line'>: "%eax");
</span><span class='line'>printf("The result is %d\n", result);
</span><span class='line'>return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h6>4, 使用内存位置</h6>

<p>虽然在内联汇编代码中使用寄存器比较快, 但是也可以直接使用c变量的内存位置。 约束m用于引用输入值
和输出值中的内存位置。 记住, 对于要求使用寄存器的汇编指令, 仍然必须使用寄存器, 所以不得不定义
保存数据的中间寄存器。如:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int main(void) {
</span><span class='line'>int dividentd = 20;
</span><span class='line'>int divisor = 5;
</span><span class='line'>int result;
</span><span class='line'>
</span><span class='line'>__asm__("divb %2\n\t"
</span><span class='line'>"movl %%eax, %0"
</span><span class='line'>: "=m"(result)
</span><span class='line'>: "a"(dividend), "m"(divisor));
</span><span class='line'>printf("The result is %d\n", result);
</span><span class='line'>return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h6>5, 处理跳转</h6>

<p>内联汇编语言代码也可以包含定义其中位置的标签。 可以实现一般的汇编条件分支和无条件分支， 如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int main(void) {
</span><span class='line'>int a = 10;
</span><span class='line'>int b = 20;
</span><span class='line'>int result;
</span><span class='line'>
</span><span class='line'>__asm__("cmp %1, %2\n\t"
</span><span class='line'>"jge greater\n\t"
</span><span class='line'>"movl %1, %0\n\t"
</span><span class='line'>"jmp end\n"
</span><span class='line'>"greater:\n\t"
</span><span class='line'>"movl %2, %0\n"
</span><span class='line'>"end:"
</span><span class='line'>:"=r"(result)
</span><span class='line'>:"r"(a), "r"(b));
</span><span class='line'>printf("The larger value is %d\n", result);
</span><span class='line'>return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>在内联汇编代码中使用标签时有两个限制。 第一个限制是只能跳转到相同的asm段内的标签，
不能从－个asm段跳转到另一个asm段中的标签。第二个限制更加复杂一点。 以上程序使用
标签greater和end。 但是, 这样有个潜在的问题, 查看汇编后的代码清单， 可以发现内联
汇编标签也被编码到了最终汇编后的代码中。 这意味着如果在c代码中还有另一个asm段, 就
不能再次使用相同的标签, 否则会因为标签重复使用而导致错误消息。还有如果试图整合使用
c关键字(比如函数名称或者全局变量)的标签也会导致错误。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2011/08/27/assembly-base/">Linux 汇编基础</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2011-08-27T16:07:00+08:00'><span class='date'>2011-08-27</span> <span class='time'>16:07:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>绝顶好书<a href="/download/assembly/Professional_Assembly_Language.pdf">Professional_Assembly_Language</a></p>

<h4>一、简介</h4>

<p>作为最基本的编程语言之一，汇编语言虽然应用的范围不算很广，但重要性却勿庸置疑，因为它能够完成许多其它语言所无法完成的功能。就拿 Linux 内核来讲，虽然绝大部分代码是用 C 语言编写的，但仍然不可避免地在某些关键地方使用了汇编代码，其中主要是在 Linux 的启动部分。由于这部分代码与硬件的关系非常密切，即使是 C 语言也会有些力不从心，而汇编语言则能够很好扬长避短，最大限度地发挥硬件的性能。</p>

<p>大多数情况下 Linux 程序员不需要使用汇编语言，因为即便是硬件驱动这样的底层程序在 Linux 操作系统中也可以用完全用 C 语言来实现，再加上 GCC 这一优秀的编译器目前已经能够对最终生成的代码进行很好的优化，的确有足够的理由让我们可以暂时将汇编语言抛在一边了。但实现情况是 Linux 程序员有时还是需要使用汇编，或者不得不使用汇编，理由很简单：精简、高效和 libc 无关性。假设要移植 Linux 到某一特定的嵌入式硬件环境下，首先必然面临如何减少系统大小、提高执行效率等问题，此时或许只有汇编语言能帮上忙了。</p>

<p>汇编语言直接同计算机的底层软件甚至硬件进行交互，它具有如下一些优点：
能够直接访问与硬件相关的存储器或 I/O 端口； 能够不受编译器的限制，对生成的二进制代码进行完全的控制； 能够对关键代码进行更准确的控制，避免因线程共同访问或者硬件设备共享引起的死锁； 能够根据特定的应用对代码做最佳的优化，提高运行速度； 能够最大限度地发挥硬件的功能。</p>

<p>同时还应该认识到，汇编语言是一种层次非常低的语言，它仅仅高于直接手工编写二进制的机器指令码，因此不可避免地存在一些缺点：
编写的代码非常难懂，不好维护； 很容易产生 bug，难于调试； 只能针对特定的体系结构和处理器进行优化； 开发效率很低，时间长且单调。</p>

<p>Linux 下用汇编语言编写的代码具有两种不同的形式。第一种是完全的汇编代码，指的是整个程序全部用汇编语言编写。尽管是完全的汇编代码，Linux 平台下的汇编工具也吸收了 C 语言的长处，使得程序员可以使用 #include、#ifdef 等预处理指令，并能够通过宏定义来简化代码。第二种是内嵌的汇编代码，指的是可以嵌入到C语言程序中的汇编代码片段。虽然 ANSI 的 C 语言标准中没有关于内嵌汇编代码的相应规定，但各种实际使用的 C 编译器都做了这方面的扩充，这其中当然就包括 Linux 平台下的 GCC。</p>

</div>
  
  
    <footer>
      <a rel="full-article" target="_blank" href="/blog/2011/08/27/assembly-base/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/91">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/89">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
<h1>Categories</h1>
<head>
</head>
<body>
<div id="menu">
<ul>
<li class='catclass'><a href='/blog/cats/language/'>language</a><a href='##' onmousedown=showDiv('language') id='aexp_language'><span class='exp_style' id='exp_language'>[+]</span></a><span class='right_span'>(40)</span></li>
<div id='language' class='catsub'><li><a href='/blog/cats/language~c/?opendiv=language'>c</a><a href='##' onmousedown=showDiv('language~c') id='aexp_language~c'><span class='exp_style' id='exp_language~c'>[+]</span></a><span class='right_span'>23</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~c')) document.getElementById('aexp_language~c').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~java/?opendiv=language'>java</a><a href='##' onmousedown=showDiv('language~java') id='aexp_language~java'><span class='exp_style' id='exp_language~java'>[+]</span></a><span class='right_span'>11</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~java')) document.getElementById('aexp_language~java').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~web/?opendiv=language'>web</a><a href='##' onmousedown=showDiv('language~web') id='aexp_language~web'><span class='exp_style' id='exp_language~web'>[+]</span></a><span class='right_span'>6</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('language')) document.getElementById('aexp_language').style.visibility = 'hidden';
if (!document.getElementById('language~web')) document.getElementById('aexp_language~web').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/compiler/'>compiler</a><a href='##' onmousedown=showDiv('compiler') id='aexp_compiler'><span class='exp_style' id='exp_compiler'>[+]</span></a><span class='right_span'>(14)</span></li>
<div id='compiler' class='catsub'><li><a href='/blog/cats/compiler~base/?opendiv=compiler'>base</a><a href='##' onmousedown=showDiv('compiler~base') id='aexp_compiler~base'><span class='exp_style' id='exp_compiler~base'>[+]</span></a><span class='right_span'>10</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler~base')) document.getElementById('aexp_compiler~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/compiler~make/?opendiv=compiler'>make</a><a href='##' onmousedown=showDiv('compiler~make') id='aexp_compiler~make'><span class='exp_style' id='exp_compiler~make'>[+]</span></a><span class='right_span'>4</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler')) document.getElementById('aexp_compiler').style.visibility = 'hidden';
if (!document.getElementById('compiler~make')) document.getElementById('aexp_compiler~make').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/assembly/'>assembly</a><a href='##' onmousedown=showDiv('assembly') id='aexp_assembly'><span class='exp_style' id='exp_assembly'>[+]</span></a><span class='right_span'>(15)</span></li>
<div id='assembly' class='catsub'><li><a href='/blog/cats/assembly~arm/?opendiv=assembly'>arm</a><a href='##' onmousedown=showDiv('assembly~arm') id='aexp_assembly~arm'><span class='exp_style' id='exp_assembly~arm'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('assembly~arm')) document.getElementById('aexp_assembly~arm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/assembly~base/?opendiv=assembly'>base</a><a href='##' onmousedown=showDiv('assembly~base') id='aexp_assembly~base'><span class='exp_style' id='exp_assembly~base'>[+]</span></a><span class='right_span'>13</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('assembly')) document.getElementById('aexp_assembly').style.visibility = 'hidden';
if (!document.getElementById('assembly~base')) document.getElementById('aexp_assembly~base').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/tools/'>tools</a><a href='##' onmousedown=showDiv('tools') id='aexp_tools'><span class='exp_style' id='exp_tools'>[+]</span></a><span class='right_span'>(56)</span></li>
<div id='tools' class='catsub'><li><a href='/blog/cats/tools~base/?opendiv=tools'>base</a><a href='##' onmousedown=showDiv('tools~base') id='aexp_tools~base'><span class='exp_style' id='exp_tools~base'>[+]</span></a><span class='right_span'>14</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~base')) document.getElementById('aexp_tools~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~ci/?opendiv=tools'>ci</a><a href='##' onmousedown=showDiv('tools~ci') id='aexp_tools~ci'><span class='exp_style' id='exp_tools~ci'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~ci')) document.getElementById('aexp_tools~ci').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~command/?opendiv=tools'>command</a><a href='##' onmousedown=showDiv('tools~command') id='aexp_tools~command'><span class='exp_style' id='exp_tools~command'>[+]</span></a><span class='right_span'>14</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~command')) document.getElementById('aexp_tools~command').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~git/?opendiv=tools'>git</a><a href='##' onmousedown=showDiv('tools~git') id='aexp_tools~git'><span class='exp_style' id='exp_tools~git'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~git')) document.getElementById('aexp_tools~git').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~graphviz,-codeviz/?opendiv=tools'>graphviz、codeviz</a><a href='##' onmousedown=showDiv('tools~graphviz、codeviz') id='aexp_tools~graphviz、codeviz'><span class='exp_style' id='exp_tools~graphviz、codeviz'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~graphviz、codeviz')) document.getElementById('aexp_tools~graphviz、codeviz').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~haproxy/?opendiv=tools'>haproxy</a><a href='##' onmousedown=showDiv('tools~haproxy') id='aexp_tools~haproxy'><span class='exp_style' id='exp_tools~haproxy'>[+]</span></a><span class='right_span'>9</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~haproxy')) document.getElementById('aexp_tools~haproxy').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~mysql/?opendiv=tools'>mysql</a><a href='##' onmousedown=showDiv('tools~mysql') id='aexp_tools~mysql'><span class='exp_style' id='exp_tools~mysql'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~mysql')) document.getElementById('aexp_tools~mysql').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~ssh/?opendiv=tools'>ssh</a><a href='##' onmousedown=showDiv('tools~ssh') id='aexp_tools~ssh'><span class='exp_style' id='exp_tools~ssh'>[+]</span></a><span class='right_span'>3</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('tools')) document.getElementById('aexp_tools').style.visibility = 'hidden';
if (!document.getElementById('tools~ssh')) document.getElementById('aexp_tools~ssh').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/system/'>system</a><a href='##' onmousedown=showDiv('system') id='aexp_system'><span class='exp_style' id='exp_system'>[+]</span></a><span class='right_span'>(54)</span></li>
<div id='system' class='catsub'><li><a href='/blog/cats/system~base/?opendiv=system'>base</a><a href='##' onmousedown=showDiv('system~base') id='aexp_system~base'><span class='exp_style' id='exp_system~base'>[+]</span></a><span class='right_span'>17</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~base')) document.getElementById('aexp_system~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~centos/?opendiv=system'>centos</a><a href='##' onmousedown=showDiv('system~centos') id='aexp_system~centos'><span class='exp_style' id='exp_system~centos'>[+]</span></a><span class='right_span'>8</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~centos')) document.getElementById('aexp_system~centos').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~cgroup/?opendiv=system'>cgroup</a><a href='##' onmousedown=showDiv('system~cgroup') id='aexp_system~cgroup'><span class='exp_style' id='exp_system~cgroup'>[+]</span></a><span class='right_span'>11</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~cgroup')) document.getElementById('aexp_system~cgroup').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~kvm/?opendiv=system'>kvm</a><a href='##' onmousedown=showDiv('system~kvm') id='aexp_system~kvm'><span class='exp_style' id='exp_system~kvm'>[+]</span></a><span class='right_span'>7</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~kvm')) document.getElementById('aexp_system~kvm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~namespace/?opendiv=system'>namespace</a><a href='##' onmousedown=showDiv('system~namespace') id='aexp_system~namespace'><span class='exp_style' id='exp_system~namespace'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~namespace')) document.getElementById('aexp_system~namespace').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~ubuntu/?opendiv=system'>ubuntu</a><a href='##' onmousedown=showDiv('system~ubuntu') id='aexp_system~ubuntu'><span class='exp_style' id='exp_system~ubuntu'>[+]</span></a><span class='right_span'>9</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('system')) document.getElementById('aexp_system').style.visibility = 'hidden';
if (!document.getElementById('system~ubuntu')) document.getElementById('aexp_system~ubuntu').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/kernel/'>kernel</a><a href='##' onmousedown=showDiv('kernel') id='aexp_kernel'><span class='exp_style' id='exp_kernel'>[+]</span></a><span class='right_span'>(164)</span></li>
<div id='kernel' class='catsub'><li><a href='/blog/cats/kernel~base/?opendiv=kernel'>base</a><a href='##' onmousedown=showDiv('kernel~base') id='aexp_kernel~base'><span class='exp_style' id='exp_kernel~base'>[+]</span></a><span class='right_span'>19</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~base')) document.getElementById('aexp_kernel~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~fs/?opendiv=kernel'>fs</a><a href='##' onmousedown=showDiv('kernel~fs') id='aexp_kernel~fs'><span class='exp_style' id='exp_kernel~fs'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~fs')) document.getElementById('aexp_kernel~fs').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~irq/?opendiv=kernel'>irq</a><a href='##' onmousedown=showDiv('kernel~irq') id='aexp_kernel~irq'><span class='exp_style' id='exp_kernel~irq'>[+]</span></a><span class='right_span'>11</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~irq')) document.getElementById('aexp_kernel~irq').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~kexec/?opendiv=kernel'>kexec</a><a href='##' onmousedown=showDiv('kernel~kexec') id='aexp_kernel~kexec'><span class='exp_style' id='exp_kernel~kexec'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~kexec')) document.getElementById('aexp_kernel~kexec').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~mm/?opendiv=kernel'>mm</a><a href='##' onmousedown=showDiv('kernel~mm') id='aexp_kernel~mm'><span class='exp_style' id='exp_kernel~mm'>[+]</span></a><span class='right_span'>33</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~mm')) document.getElementById('aexp_kernel~mm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~net/?opendiv=kernel'>net</a><a href='##' onmousedown=showDiv('kernel~net') id='aexp_kernel~net'><span class='exp_style' id='exp_kernel~net'>[+]</span></a><span class='right_span'>80</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~net')) document.getElementById('aexp_kernel~net').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~sched/?opendiv=kernel'>sched</a><a href='##' onmousedown=showDiv('kernel~sched') id='aexp_kernel~sched'><span class='exp_style' id='exp_kernel~sched'>[+]</span></a><span class='right_span'>19</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel')) document.getElementById('aexp_kernel').style.visibility = 'hidden';
if (!document.getElementById('kernel~sched')) document.getElementById('aexp_kernel~sched').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/android/'>android</a><a href='##' onmousedown=showDiv('android') id='aexp_android'><span class='exp_style' id='exp_android'>[+]</span></a><span class='right_span'>(22)</span></li>
<div id='android' class='catsub'><li><a href='/blog/cats/android~base/?opendiv=android'>base</a><a href='##' onmousedown=showDiv('android~base') id='aexp_android~base'><span class='exp_style' id='exp_android~base'>[+]</span></a><span class='right_span'>13</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~base')) document.getElementById('aexp_android~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~i9507v/?opendiv=android'>i9507v</a><a href='##' onmousedown=showDiv('android~i9507v') id='aexp_android~i9507v'><span class='exp_style' id='exp_android~i9507v'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~i9507v')) document.getElementById('aexp_android~i9507v').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~me722/?opendiv=android'>me722</a><a href='##' onmousedown=showDiv('android~me722') id='aexp_android~me722'><span class='exp_style' id='exp_android~me722'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~me722')) document.getElementById('aexp_android~me722').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~nx403a/?opendiv=android'>nx403a</a><a href='##' onmousedown=showDiv('android~nx403a') id='aexp_android~nx403a'><span class='exp_style' id='exp_android~nx403a'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~nx403a')) document.getElementById('aexp_android~nx403a').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~s5830/?opendiv=android'>s5830</a><a href='##' onmousedown=showDiv('android~s5830') id='aexp_android~s5830'><span class='exp_style' id='exp_android~s5830'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('android')) document.getElementById('aexp_android').style.visibility = 'hidden';
if (!document.getElementById('android~s5830')) document.getElementById('aexp_android~s5830').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/debug/'>debug</a><a href='##' onmousedown=showDiv('debug') id='aexp_debug'><span class='exp_style' id='exp_debug'>[+]</span></a><span class='right_span'>(76)</span></li>
<div id='debug' class='catsub'><li><a href='/blog/cats/debug~base/?opendiv=debug'>base</a><a href='##' onmousedown=showDiv('debug~base') id='aexp_debug~base'><span class='exp_style' id='exp_debug~base'>[+]</span></a><span class='right_span'>19</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~base')) document.getElementById('aexp_debug~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~dwarf/?opendiv=debug'>dwarf</a><a href='##' onmousedown=showDiv('debug~dwarf') id='aexp_debug~dwarf'><span class='exp_style' id='exp_debug~dwarf'>[+]</span></a><span class='right_span'>5</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~dwarf')) document.getElementById('aexp_debug~dwarf').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~gdb/?opendiv=debug'>gdb</a><a href='##' onmousedown=showDiv('debug~gdb') id='aexp_debug~gdb'><span class='exp_style' id='exp_debug~gdb'>[+]</span></a><span class='right_span'>9</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~gdb')) document.getElementById('aexp_debug~gdb').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kdump,-crash/?opendiv=debug'>kdump、crash</a><a href='##' onmousedown=showDiv('debug~kdump、crash') id='aexp_debug~kdump、crash'><span class='exp_style' id='exp_debug~kdump、crash'>[+]</span></a><span class='right_span'>10</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kdump、crash')) document.getElementById('aexp_debug~kdump、crash').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kgdb/?opendiv=debug'>kgdb</a><a href='##' onmousedown=showDiv('debug~kgdb') id='aexp_debug~kgdb'><span class='exp_style' id='exp_debug~kgdb'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kgdb')) document.getElementById('aexp_debug~kgdb').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kprobe/?opendiv=debug'>kprobe</a><a href='##' onmousedown=showDiv('debug~kprobe') id='aexp_debug~kprobe'><span class='exp_style' id='exp_debug~kprobe'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kprobe')) document.getElementById('aexp_debug~kprobe').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~ksplice/?opendiv=debug'>ksplice</a><a href='##' onmousedown=showDiv('debug~ksplice') id='aexp_debug~ksplice'><span class='exp_style' id='exp_debug~ksplice'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~ksplice')) document.getElementById('aexp_debug~ksplice').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~mark/?opendiv=debug'>mark</a><a href='##' onmousedown=showDiv('debug~mark') id='aexp_debug~mark'><span class='exp_style' id='exp_debug~mark'>[+]</span></a><span class='right_span'>17</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~mark')) document.getElementById('aexp_debug~mark').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~perf/?opendiv=debug'>perf</a><a href='##' onmousedown=showDiv('debug~perf') id='aexp_debug~perf'><span class='exp_style' id='exp_debug~perf'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~perf')) document.getElementById('aexp_debug~perf').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~systemtap/?opendiv=debug'>systemtap</a><a href='##' onmousedown=showDiv('debug~systemtap') id='aexp_debug~systemtap'><span class='exp_style' id='exp_debug~systemtap'>[+]</span></a><span class='right_span'>5</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('debug')) document.getElementById('aexp_debug').style.visibility = 'hidden';
if (!document.getElementById('debug~systemtap')) document.getElementById('aexp_debug~systemtap').style.visibility = 'hidden';
</script>
<li><div style="background:#DDD; height:0.3em;"></div></li><li class='catclass'><a href='/blog/cats/algorithm/'>algorithm</a><a href='##' onmousedown=showDiv('algorithm') id='aexp_algorithm'><span class='exp_style' id='exp_algorithm'>[+]</span></a><span class='right_span'>(27)</span></li>
<div id='algorithm' class='catsub'><li><a href='/blog/cats/algorithm~base/?opendiv=algorithm'>base</a><a href='##' onmousedown=showDiv('algorithm~base') id='aexp_algorithm~base'><span class='exp_style' id='exp_algorithm~base'>[+]</span></a><span class='right_span'>20</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~base')) document.getElementById('aexp_algorithm~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~dp/?opendiv=algorithm'>dp</a><a href='##' onmousedown=showDiv('algorithm~dp') id='aexp_algorithm~dp'><span class='exp_style' id='exp_algorithm~dp'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~dp')) document.getElementById('aexp_algorithm~dp').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~ds/?opendiv=algorithm'>ds</a><a href='##' onmousedown=showDiv('algorithm~ds') id='aexp_algorithm~ds'><span class='exp_style' id='exp_algorithm~ds'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~ds')) document.getElementById('aexp_algorithm~ds').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~tc/?opendiv=algorithm'>tc</a><a href='##' onmousedown=showDiv('algorithm~tc') id='aexp_algorithm~tc'><span class='exp_style' id='exp_algorithm~tc'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm')) document.getElementById('aexp_algorithm').style.visibility = 'hidden';
if (!document.getElementById('algorithm~tc')) document.getElementById('aexp_algorithm~tc').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/blog/'>blog</a><a href='##' onmousedown=showDiv('blog') id='aexp_blog'><span class='exp_style' id='exp_blog'>[+]</span></a><span class='right_span'>(11)</span></li>
<div id='blog' class='catsub'><li><a href='/blog/cats/blog~hello/?opendiv=blog'>hello</a><a href='##' onmousedown=showDiv('blog~hello') id='aexp_blog~hello'><span class='exp_style' id='exp_blog~hello'>[+]</span></a><span class='right_span'>1</span></li>
<div id='blog~hello' class='catsub2'><li><a href='/blog/cats/blog~hello~hi/?opendiv=blog~hello'>hi</a><span class='right_span'>1</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~hello')) document.getElementById('aexp_blog~hello').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~jekyll/?opendiv=blog'>jekyll</a><a href='##' onmousedown=showDiv('blog~jekyll') id='aexp_blog~jekyll'><span class='exp_style' id='exp_blog~jekyll'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~jekyll')) document.getElementById('aexp_blog~jekyll').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~markdown/?opendiv=blog'>markdown</a><a href='##' onmousedown=showDiv('blog~markdown') id='aexp_blog~markdown'><span class='exp_style' id='exp_blog~markdown'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~markdown')) document.getElementById('aexp_blog~markdown').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~octopress/?opendiv=blog'>octopress</a><a href='##' onmousedown=showDiv('blog~octopress') id='aexp_blog~octopress'><span class='exp_style' id='exp_blog~octopress'>[+]</span></a><span class='right_span'>5</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~octopress')) document.getElementById('aexp_blog~octopress').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~ruby/?opendiv=blog'>ruby</a><a href='##' onmousedown=showDiv('blog~ruby') id='aexp_blog~ruby'><span class='exp_style' id='exp_blog~ruby'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('blog')) document.getElementById('aexp_blog').style.visibility = 'hidden';
if (!document.getElementById('blog~ruby')) document.getElementById('aexp_blog~ruby').style.visibility = 'hidden';
</script>

</ul>
</div>
</body>
</html>
</section>

<section>
<h1>Date Categories</h1>
<head>
</head>
<body>
<div id="menu">
<ul>
<li class='catclass'><a href='/blog/cats/2016/'>2016</a><a href='##' onmousedown=showDiv('2016')><span class='exp_style' id='exp_2016'>[+]</span></a><span class='right_span'>(21)</span></li>
<div id='2016' class='catsub'><li><a href='/blog/cats/2016~08/?opendiv=2016'>2016-08</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2016~05/?opendiv=2016'>2016-05</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2016~03/?opendiv=2016'>2016-03</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2016~02/?opendiv=2016'>2016-02</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2016~01/?opendiv=2016'>2016-01</a><span class='right_span'>6</span></li>
</div><li class='catclass'><a href='/blog/cats/2015/'>2015</a><a href='##' onmousedown=showDiv('2015')><span class='exp_style' id='exp_2015'>[+]</span></a><span class='right_span'>(207)</span></li>
<div id='2015' class='catsub'><li><a href='/blog/cats/2015~12/?opendiv=2015'>2015-12</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2015~11/?opendiv=2015'>2015-11</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2015~10/?opendiv=2015'>2015-10</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2015~09/?opendiv=2015'>2015-09</a><span class='right_span'>18</span></li>
<li><a href='/blog/cats/2015~08/?opendiv=2015'>2015-08</a><span class='right_span'>25</span></li>
<li><a href='/blog/cats/2015~07/?opendiv=2015'>2015-07</a><span class='right_span'>31</span></li>
<li><a href='/blog/cats/2015~06/?opendiv=2015'>2015-06</a><span class='right_span'>24</span></li>
<li><a href='/blog/cats/2015~05/?opendiv=2015'>2015-05</a><span class='right_span'>22</span></li>
<li><a href='/blog/cats/2015~04/?opendiv=2015'>2015-04</a><span class='right_span'>23</span></li>
<li><a href='/blog/cats/2015~03/?opendiv=2015'>2015-03</a><span class='right_span'>19</span></li>
<li><a href='/blog/cats/2015~02/?opendiv=2015'>2015-02</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2015~01/?opendiv=2015'>2015-01</a><span class='right_span'>19</span></li>
</div><li class='catclass'><a href='/blog/cats/2014/'>2014</a><a href='##' onmousedown=showDiv('2014')><span class='exp_style' id='exp_2014'>[+]</span></a><span class='right_span'>(112)</span></li>
<div id='2014' class='catsub'><li><a href='/blog/cats/2014~12/?opendiv=2014'>2014-12</a><span class='right_span'>21</span></li>
<li><a href='/blog/cats/2014~11/?opendiv=2014'>2014-11</a><span class='right_span'>19</span></li>
<li><a href='/blog/cats/2014~10/?opendiv=2014'>2014-10</a><span class='right_span'>13</span></li>
<li><a href='/blog/cats/2014~09/?opendiv=2014'>2014-09</a><span class='right_span'>7</span></li>
<li><a href='/blog/cats/2014~08/?opendiv=2014'>2014-08</a><span class='right_span'>15</span></li>
<li><a href='/blog/cats/2014~07/?opendiv=2014'>2014-07</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2014~06/?opendiv=2014'>2014-06</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2014~05/?opendiv=2014'>2014-05</a><span class='right_span'>7</span></li>
<li><a href='/blog/cats/2014~04/?opendiv=2014'>2014-04</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2014~03/?opendiv=2014'>2014-03</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2014~02/?opendiv=2014'>2014-02</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2014~01/?opendiv=2014'>2014-01</a><span class='right_span'>2</span></li>
</div><li class='catclass'><a href='/blog/cats/2013/'>2013</a><a href='##' onmousedown=showDiv('2013')><span class='exp_style' id='exp_2013'>[+]</span></a><span class='right_span'>(60)</span></li>
<div id='2013' class='catsub'><li><a href='/blog/cats/2013~12/?opendiv=2013'>2013-12</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~11/?opendiv=2013'>2013-11</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~10/?opendiv=2013'>2013-10</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~09/?opendiv=2013'>2013-09</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~08/?opendiv=2013'>2013-08</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~07/?opendiv=2013'>2013-07</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2013~06/?opendiv=2013'>2013-06</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2013~05/?opendiv=2013'>2013-05</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~03/?opendiv=2013'>2013-03</a><span class='right_span'>6</span></li>
<li><a href='/blog/cats/2013~02/?opendiv=2013'>2013-02</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2013~01/?opendiv=2013'>2013-01</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2012/'>2012</a><a href='##' onmousedown=showDiv('2012')><span class='exp_style' id='exp_2012'>[+]</span></a><span class='right_span'>(35)</span></li>
<div id='2012' class='catsub'><li><a href='/blog/cats/2012~12/?opendiv=2012'>2012-12</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2012~11/?opendiv=2012'>2012-11</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2012~10/?opendiv=2012'>2012-10</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2012~08/?opendiv=2012'>2012-08</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2012~05/?opendiv=2012'>2012-05</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2012~04/?opendiv=2012'>2012-04</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2012~03/?opendiv=2012'>2012-03</a><span class='right_span'>6</span></li>
<li><a href='/blog/cats/2012~02/?opendiv=2012'>2012-02</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2012~01/?opendiv=2012'>2012-01</a><span class='right_span'>2</span></li>
</div><li class='catclass'><a href='/blog/cats/2011/'>2011</a><a href='##' onmousedown=showDiv('2011')><span class='exp_style' id='exp_2011'>[+]</span></a><span class='right_span'>(35)</span></li>
<div id='2011' class='catsub'><li><a href='/blog/cats/2011~12/?opendiv=2011'>2011-12</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2011~11/?opendiv=2011'>2011-11</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2011~08/?opendiv=2011'>2011-08</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2011~07/?opendiv=2011'>2011-07</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2011~06/?opendiv=2011'>2011-06</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~05/?opendiv=2011'>2011-05</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~04/?opendiv=2011'>2011-04</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~03/?opendiv=2011'>2011-03</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2011~02/?opendiv=2011'>2011-02</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2011~01/?opendiv=2011'>2011-01</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2010/'>2010</a><a href='##' onmousedown=showDiv('2010')><span class='exp_style' id='exp_2010'>[+]</span></a><span class='right_span'>(1)</span></li>
<div id='2010' class='catsub'><li><a href='/blog/cats/2010~07/?opendiv=2010'>2010-07</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2009/'>2009</a><a href='##' onmousedown=showDiv('2009')><span class='exp_style' id='exp_2009'>[+]</span></a><span class='right_span'>(8)</span></li>
<div id='2009' class='catsub'><li><a href='/blog/cats/2009~12/?opendiv=2009'>2009-12</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2009~10/?opendiv=2009'>2009-10</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2009~09/?opendiv=2009'>2009-09</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2009~07/?opendiv=2009'>2009-07</a><span class='right_span'>1</span></li>
</div>
</ul>
</div>
</body>
</html>
</section>

<section>
<h1>Tags</h1>
<ul class="tag-cloud">
<a style="font-size: 134%" href="/tags/gdb/">gdb(7)</a>
<a style="font-size: 100%" href="/tags/hello/">hello(1)</a>
<a style="font-size: 150%" href="/tags/koj/">koj(18)</a>
<a style="font-size: 112%" href="/tags/nvidia/">nvidia(2)</a>
<a style="font-size: 100%" href="/tags/patch/">patch(1)</a>
<a style="font-size: 100%" href="/tags/reg-exp/">reg_exp(1)</a>

</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/31/command-pssh_pscp/">pssh、pscp命令</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/21/kernel-irq-bh/">linux 中断下半部</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/11/debug-gdb-thread/">gdb线程</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/29/debug-ksplice-detail/">理解Ksplice执行过程</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/03/29/debug-ksplice-base/">内核热补丁技术揭秘</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub</h1>
  
  <a href="https://github.com/abcdxyzk">abcdxyzk on GitHub</a>
  
</section>

<section>
<h1>Links</h1>
<ul>
	<li>
		<a href=http://hi.baidu.com/abcdxyzk target=_blank>My blog</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/zhangskd target=_blank>zhangsk</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/justlinux2010 target=_blank>justlinux2010</a>
	</li>
	<li>
		<a href=http://simohayha.iteye.com/ target=_blank>simohayha</a>
	</li>
	<li>
		<a href=http://linux.chinaunix.net/techdoc/net/ target=_blank>技术文档</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/cybertan target=_blank>cybertan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/newnewman80 target=_blank>newnewman80</a>
	</li>
	<li>
		<a href=http://www.cppblog.com/fwxjj/ target=_blank>fwxjj</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/ustc_dylan target=_blank>ustc_dylan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/nkguohao target=_blank>nkguohao</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/yusiguyuan target=_blank>yusiguyuan</a>
	</li>
	<li>
		<a href=http://www.oenhan.com/ target=_blank>oenhan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/bullbat target=_blank>bullbat</a>
	</li>
	<li>
		<a href=http://www.wowotech.net/ target=_blank>wowotech</a>
	</li>
	<li>
		<a href=http://www.lenky.info/ target=_blank>lenky</a>
	</li>
	<li>
		<a href=http://smilejay.com/ target=_blank>smilejay</a>
	</li>
	<li>
		<a href=http://blog.chinaunix.net/uid/10167808.html target=_blank>godbach</a>
	</li>
</ul>
</section>

  
<section id="comment_sidebar">
<h1>Recent Comments</h1>

<script type="text/javascript" src="http://abcdxyzk.disqus.com/recent_comments_widget.js?num_items=5&hide_avatars=0&avatar_size=32&excerpt_length=20"></script><a href="http://disqus.com/">Powered by Disqus</a>

</section>


</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - kk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <a title="Top" href="#" id="scroll2top" style="position: fixed; height: 50px; bottom: 30px; right: 25px; cursor: pointer; z-index: 9999; display: block; opacity: 1;"><img src="/images/scrollup.png"></a>
  <script src="/javascripts/scroll2top.js"></script>
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253604690'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1253604690' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'abcdxyzk';
      
</script>





</body>
</html>
