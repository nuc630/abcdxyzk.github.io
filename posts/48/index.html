
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>kk Blog —— 通用基础</title>

  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="kk Blog —— 通用基础" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/category.js" type="text/javascript"></script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">kk Blog —— 通用基础</a></h1>
  
    <h2>cp -rf * .</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
<li>
<form action="/search" method="get">
    <input class="search" name="query" id="query" type="text" placeholder="search...">
    <input id="btnSubmit" value="search" type="submit">
</form>
<script type="text/javascript">
var query = GetRequest("query");
if (query != null) {
	document.getElementById("query").value = query;
}
</script>
</li>
  <li><a href="/atom.xml" rel="subscribe-rss">RSS</a></li>
  
</ul>
  
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/download">Download</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/12/04/debug-source-debug/">How source debuggers work?</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-04T09:51:00+08:00'><span class='date'>2013-12-04</span> <span class='time'>09:51:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://blog.techveda.org/howsourcedebuggerswork/">http://blog.techveda.org/howsourcedebuggerswork/</a></p>

<p>Application binaries are a result of compile and build operations performed on a single or a set of source files. Program Source files contain functions, data variables of various types (local, global, register, static), and abstract data objects, all written and neatly indented with nested control structures as per high level programming language syntax (C/C++).  Compilers translate code in each source file into machine instructions (1’s and 0’s) as per target processors Instruction set Architecture and bury that code into object files. Further, Linkers integrate compiled object files with other pre-compiled objects files (libraries, runtime binaries) to create end application binary image called executable.</p>

<p>Source debuggers are tools used to trace execution of an application executable binary. Most amazing feature of a source debugger is its ability to list source code of the program being debugged; it can show the line or expression in the source code that resulted in a particular machine code instruction of a running program loaded in memory. This helps the programmer to analyze a program’s behavior in the high-level terms like source-level flow control constructs, procedure calls, named variables, etc,  instead of machine instructions and memory locations. Source-level debugging also makes it possible to step through execution a line at a time and set source-level breakpoints. (If you do not have any prior hands on experience with source debuggers I suggest you to look at this before continuing with following.)</p>

<p>lets explore how source debuggers like gnu gdb work ? So how does a debugger know where to stop when you ask it to break at the entry to some function? How does it manage to find what to show you when you ask it for the value of a variable? The answer is – debug information.  All modern compilers are designed to generate Debug information together with the machine code of the source file. It is a representation of the relationship between the executable program and the original source code. This information is encoded as per  a pre-defined format and stored alongside the machine code. Many such formats were invented over the years for different platforms and executable files (aim of this article isn’t to survey the history of these formats, but rather to show how they work). Gnu compiler and ELF executable on Linux/ UNIX platforms use DWARF, which is widely used today as default debugging information format.</p>

<p>Word of Advice : Does an Application/ Kernel programmer need to know Dwarf?</p>

<p>Obvious answer to this question is a big NO.  It is purely subject matter for developers involved in implementation of a Debugger tool. A normal Application developer using debugger tools would never need to learn or dig into binary files for debug information. This in no way adds any edge to your debugging skills nor adds any new skills into your armory. However, if you are a developer using debuggers for years and curious about how debuggers work read this document for an outline into debug information.  If you are a beginner to systems programming or fresher’s learning programming I would  suggest  not to waste your time as you can safely ignore this.</p>

<p>ELF -DWARF sections</p>

<p>Gnu compiler generates debug information which is organized into various sections of the ELF object file. Let’s use the following source file for compiling and observing DWARF sections</p>

<p>root@techveda:~# vim sample.c</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'>#include &lt;stdlib.h&gt;
</span><span class='line'> 
</span><span class='line'>int add(int x, int y)
</span><span class='line'>{
</span><span class='line'>    return x + y;
</span><span class='line'>}
</span><span class='line'>int main()
</span><span class='line'>{
</span><span class='line'>    int a = 10, b = 20;
</span><span class='line'>    int result;
</span><span class='line'>    int (*fp) (int, int);
</span><span class='line'> 
</span><span class='line'>    fp = add;
</span><span class='line'>    result = (*fp) (a, b);
</span><span class='line'>    printf(" %dn", result);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>root@techveda:~# gcc -c -g sample.c -o sample.o
</span><span class='line'>root@techveda:~# objdump -h sample.o | more
</span><span class='line'>
</span><span class='line'>sample.o:     file format elf32-i386
</span><span class='line'> 
</span><span class='line'>Sections:
</span><span class='line'>Idx Name          Size      VMA       LMA       File off  Algn
</span><span class='line'>  0 .text         0000005f  00000000  00000000  00000034  2**2
</span><span class='line'>              CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE
</span><span class='line'>  1 .data         00000000  00000000  00000000  00000094  2**2
</span><span class='line'>              CONTENTS, ALLOC, LOAD, DATA
</span><span class='line'>  2 .bss          00000000  00000000  00000000  00000094  2**2
</span><span class='line'>              ALLOC
</span><span class='line'>  3 .debug_abbrev 000000a2  00000000  00000000  00000094  2**0
</span><span class='line'>              CONTENTS, READONLY, DEBUGGING
</span><span class='line'>  4 .debug_info   00000114  00000000  00000000  00000136  2**0
</span><span class='line'>              CONTENTS, RELOC, READONLY, DEBUGGING
</span><span class='line'>  5 .debug_line   00000040  00000000  00000000  0000024a  2**0
</span><span class='line'>              CONTENTS, RELOC, READONLY, DEBUGGING
</span><span class='line'>  6 .rodata       00000005  00000000  00000000  0000028a  2**0
</span><span class='line'>              CONTENTS, ALLOC, LOAD, READONLY, DATA
</span><span class='line'>  7 .debug_loc    00000070  00000000  00000000  0000028f  2**0
</span><span class='line'>              CONTENTS, READONLY, DEBUGGING
</span><span class='line'>  8 .debug_pubnames 00000023  00000000  00000000  000002ff  2**0
</span><span class='line'>              CONTENTS, RELOC, READONLY, DEBUGGING
</span><span class='line'>  9 .debug_pubtypes 00000012  00000000  00000000  00000322  2**0
</span><span class='line'>              CONTENTS, RELOC, READONLY, DEBUGGING
</span><span class='line'> 10 .debug_aranges 00000020  00000000  00000000  00000334  2**0
</span><span class='line'>              CONTENTS, RELOC, READONLY, DEBUGGING
</span><span class='line'> 11 .debug_str    000000b0  00000000  00000000  00000354  2**0
</span><span class='line'>              CONTENTS, READONLY, DEBUGGING
</span><span class='line'> 12 .comment      0000002b  00000000  00000000  00000404  2**0
</span><span class='line'>              CONTENTS, READONLY
</span><span class='line'> 13 .note.GNU-stack 00000000  00000000  00000000  0000042f  2**0
</span><span class='line'>              CONTENTS, READONLY
</span><span class='line'> 14 .debug_frame  00000054  00000000  00000000  00000430  2**2
</span><span class='line'>              CONTENTS, RELOC, READONLY, DEBUGGING</span></code></pre></td></tr></table></div></figure>


<p>All of the sections with naming debug_xxx are debugging information sections.  Information in these sections is interpreted by source debugger like gdb.  Each debug_ section holds specific information like</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>.debug_info               core DWARF data containing DIEs
</span><span class='line'>.debug_line               Line Number Program
</span><span class='line'>.debug_frame              Call Frame Information
</span><span class='line'>.debug_macinfo            lookup table for global objects and functions
</span><span class='line'>.debug_pubnames           lookup table for global objects and functions
</span><span class='line'>.debug_pubtypes           lookup table for global types
</span><span class='line'>.debug_loc                Macro descriptions
</span><span class='line'>.debug_abbrev             Abbreviations used in the .debug_info section
</span><span class='line'>.debug_aranges            mapping between memory address and compilation
</span><span class='line'>.debug_ranges             Address ranges referenced by DIEs
</span><span class='line'>.debug_str                String table used by .debug_info</span></code></pre></td></tr></table></div></figure>


<p>Debugging Information Entry (DIE)</p>

<p>Dwarf format organizes debug data in all of the above sections using special objects (program descriptive entities) called Debugging Information Entry (DIE).  Each DIE has a tag filed whose value specifies its type, and a set of attributes. DIEs are interlinked via sibling and child links, and values of attributes can point at other DIEs. Now let’s dig into ELF file to view how a DIE looks like. We will begin our exploration with .debug_info section of the ELF file since core DIE’s are listed in it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@techveda:~# objdump --dwarf=info . /sample
</span><span class='line'>
</span><span class='line'>Above operation shows long list of DIE’s. Let’s limit ourselves to relevant information
</span><span class='line'>
</span><span class='line'>./sample:     file format elf32-i386
</span><span class='line'> 
</span><span class='line'>Contents of the .debug_info section:
</span><span class='line'> 
</span><span class='line'>  Compilation Unit @ offset 0x0:
</span><span class='line'>   Length:        0x110 (32-bit)
</span><span class='line'>   Version:       2
</span><span class='line'>   Abbrev Offset: 0
</span><span class='line'>   Pointer Size:  4
</span><span class='line'> &lt;0&gt;&lt;b&gt;: Abbrev Number: 1 (DW_TAG_compile_unit)
</span><span class='line'>    &lt; c&gt;   DW_AT_producer    : (indirect string, offset: 0xe): GNU C 4.5.2   
</span><span class='line'>    &lt;10&gt;   DW_AT_language    : 1  (ANSI C)
</span><span class='line'>    &lt;11&gt;   DW_AT_name        : (indirect string, offset: 0x44): sample.c 
</span><span class='line'>    &lt;15&gt;   DW_AT_comp_dir    : (indirect string, offset: 0x71): /root
</span><span class='line'>    &lt;19&gt;   DW_AT_low_pc      : 0x80483c4 
</span><span class='line'>    &lt;1d&gt;   DW_AT_high_pc     : 0x8048423 
</span><span class='line'>    &lt;21&gt;   DW_AT_stmt_list   : 0x0</span></code></pre></td></tr></table></div></figure>


<p>Each source file in the application is referred in dwarf terminology as a “compilation unit”.   Dwarf data for each compilation unit (source file) starts with a compilation unit DIE. Above dump shows the first DIE’s and tag value “DW_TAG_compile_unit “.  This DIE provides general information about compilation unit like source file name (DW_AT_name   : (indirect string, offset: 0×44): sample.c),  high level programming language used to write source file(DW_AT_language    : 1    (ANSI C))  ,   directory of the source file(DW_AT_comp_dir    : (indirect string, offset: 0×71): /root) ,  compiler and producer of dwarf data(  DW_AT_producer    : (indirect string, offset: 0xe): GNU C 4.5.2) , start virtual address of the compilation unit  (DW_AT_low_pc      : 0x80483c4), end virtual address of the unit (DW_AT_high_pc     : 0×8048423).</p>

<p>Compilation Unit DIE is the parent for all the other DIE’s that describe elements of source file. Generally, the list of DIE’s that follow will describe data types, followed by global data, then the functions that make up the source file. The DIEs for variables and functions are in the same order in which they appear in the source file.</p>

<p>How does debugger locate Function Information ?</p>

<p> While using source debuggers we often instruct debugger to insert or place break point at some function, expecting the debugger to pause program execution at functions. To be able to perform this task, debugger must have some mapping between a function name in the high-level code and the address in the machine code where the instructions for this function begin. For this mapping information debuggers rely on DIE’s that describes specified function. DIE’s describing functions in a compilation unit are assigned tag value “DW_TAG_subprogram” subprogram as per dwarf terminology is a function.</p>

<p>In our sample application source we have two functions (main, add), dwarf should generate a “DW_TAG_subprogram” DIE’s for each function, these DIE attributes would define function mapping information that debugger needs for resolving machine code addresses with function name.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Each “DW_TAG_subprogam” DIE contains
</span><span class='line'>
</span><span class='line'>    function scope
</span><span class='line'>    function name
</span><span class='line'>    source file or compilation unit in which function is located
</span><span class='line'>     line no in the source file where the function starts
</span><span class='line'>    Functions return type
</span><span class='line'>    Start address of the fucntion
</span><span class='line'>    End address of the function
</span><span class='line'>    Frame information of the function.</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@techveda:~# objdump --dwarf=info ./sample | grep "DW_TAG_subprogram"
</span><span class='line'> &lt;1&gt;&lt;72&gt;: Abbrev Number: 4 (DW_TAG_subprogram)
</span><span class='line'> &lt;1&gt;&lt;a8&gt;: Abbrev Number: 6 (DW_TAG_subprogram)
</span><span class='line'> 
</span><span class='line'>&lt;1&gt;&lt;72&gt;: Abbrev Number: 4 (DW_TAG_subprogram)
</span><span class='line'>    &lt;73&gt;   DW_AT_external    : 1 
</span><span class='line'>    &lt;74&gt;   DW_AT_name        : add   
</span><span class='line'>    &lt;78&gt;   DW_AT_decl_file   : 1 
</span><span class='line'>    &lt;79&gt;   DW_AT_decl_line   : 4 
</span><span class='line'>    &lt;7a&gt;   DW_AT_prototyped  : 1 
</span><span class='line'>    &lt;7b&gt;   DW_AT_type        : &lt;0x4f&gt;  
</span><span class='line'>    &lt;7f&gt;   DW_AT_low_pc      : 0x80483c4 
</span><span class='line'>    &lt;83&gt;   DW_AT_high_pc     : 0x80483d1 
</span><span class='line'>    &lt;87&gt;   DW_AT_frame_base  : 0x0    (location list)
</span><span class='line'>    &lt;8b&gt;   DW_AT_sibling     : &lt;0xa8&gt;  
</span><span class='line'> 
</span><span class='line'>&lt;1&gt;&lt;a8&gt;: Abbrev Number: 6 (DW_TAG_subprogram)
</span><span class='line'>    &lt;a9&gt;   DW_AT_external    : 1 
</span><span class='line'>    &lt;aa&gt;   DW_AT_name        : (indirect string, offset: 0x1a): main 
</span><span class='line'>    &lt;ae&gt;   DW_AT_decl_file   : 1 
</span><span class='line'>    &lt;af&gt;   DW_AT_decl_line   : 8 
</span><span class='line'>    &lt;b0&gt;   DW_AT_type        : &lt;0x4f&gt;  
</span><span class='line'>    &lt;b4&gt;   DW_AT_low_pc      : 0x80483d2 
</span><span class='line'>    &lt;b8&gt;   DW_AT_high_pc     : 0x8048423 
</span><span class='line'>    &lt;bc&gt;   DW_AT_frame_base  : 0x38   (location list)
</span><span class='line'>    &lt;c0&gt;   DW_AT_sibling     : &lt;0xf8&gt;</span></code></pre></td></tr></table></div></figure>


<p>We now have accessed DIE description of function’s main and add.  Let’s analyze attribute information of add fucntions DIE.</p>

<p>Function scope:    DW_AT_external    : 1 (scope external)</p>

<p>Function name:     DW_AT_name        : add</p>

<p>Source file or compilation unit in which function is located:  DW_AT_decl_file   : 1 (indicates 1st compilation unit which is sample.c)</p>

<p>line no in the source file where the function starts:  DW_AT_decl_line   : 4 ( indicates line no 4 in source file)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1#include &lt;stdio.h&gt;
</span><span class='line'>2#include &lt;stdlib.h&gt;
</span><span class='line'>3 
</span><span class='line'>4int add(int x, int y)
</span><span class='line'>5{
</span><span class='line'>6        return x + y;
</span><span class='line'>7}
</span><span class='line'>8int main()
</span><span class='line'>9{
</span><span class='line'>10        int a = 10, b = 20;
</span><span class='line'>11        int result;
</span><span class='line'>12        int (*fp) (int, int);
</span><span class='line'>13 
</span><span class='line'>14        fp = add;
</span><span class='line'>15        result = (*fp) (a, b);
</span><span class='line'>16        printf(" %dn", result);
</span><span class='line'>17}</span></code></pre></td></tr></table></div></figure>


<p>Function’s source line no matched with DIE description of line no. let’s continue with rest of the attribute values</p>

<p>Functions return type:  DW_AT_type        : <0x4f></p>

<p>As we have already understood that values of attributes can point to other DIE , here is an example of it.  Value   DW_AT_type     : <0x4f> indicates that return type description is stored in other DIE at offset 0x4f.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;4f&gt;: Abbrev Number: 3 (DW_TAG_base_type)
</span><span class='line'>    &lt;50&gt;   DW_AT_byte_size   : 4 
</span><span class='line'>    &lt;51&gt;   DW_AT_encoding    : 5  (signed)
</span><span class='line'>    &lt;52&gt;   DW_AT_name        : int</span></code></pre></td></tr></table></div></figure>


<p>This DIE describes data type and composition of return type of the function add, as per DIE attribute values return type is signed int  of size 4 bytes.</p>

<p>Start address of the function : DW_AT_low_pc   : 0x80483c4</p>

<p>End address of the function: DW_AT_high_pc     : 0x80483d1</p>

<p>Above values indicate start and end virtual address of the machine instructions of add function, we can verify that with binary dump of the function</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>080483c4 &lt;add&gt;:
</span><span class='line'> 80483c4:   55                      push   %ebp
</span><span class='line'> 80483c5:   89 e5                   mov    %esp,%ebp
</span><span class='line'> 80483c7:   8b 45 0c                mov    0xc(%ebp),%eax
</span><span class='line'> 80483ca:   8b 55 08                mov    0x8(%ebp),%edx
</span><span class='line'> 80483cd:   8d 04 02                lea    (%edx,%eax,1),%eax
</span><span class='line'> 80483d0:   5d                      pop    %ebp
</span><span class='line'> 80483d1:   c3                      ret</span></code></pre></td></tr></table></div></figure>


<p>How does debugger find program data (variables…) Information?</p>

<p>When the program hits assigned break point in a function, debugger pauses the program execution, at this time we can instruct debugger to show or print values of variables, by using debugger commands like print or display followed by variable name (ex: print a) How does debugger know where to find memory location of the variable ? Variables can be located in global storage, on the stack, and even in registers.The debugging information has to be able to reflect all these variations, and indeed DWARF does. As an example let’s take a look at complete DIE information set for main function.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;1&gt;&lt;a8&gt;: Abbrev Number: 6 (DW_TAG_subprogram)
</span><span class='line'>    &lt;a9&gt;   DW_AT_external    : 1 
</span><span class='line'>    &lt;aa&gt;   DW_AT_name        : (indirect string, offset: 0x1a): main 
</span><span class='line'>    &lt;ae&gt;   DW_AT_decl_file   : 1 
</span><span class='line'>    &lt;af&gt;   DW_AT_decl_line   : 8 
</span><span class='line'>    &lt;b0&gt;   DW_AT_type        : &lt;0x4f&gt;  
</span><span class='line'>    &lt;b4&gt;   DW_AT_low_pc      : 0x80483d2 
</span><span class='line'>    &lt;b8&gt;   DW_AT_high_pc     : 0x8048423 
</span><span class='line'>    &lt;bc&gt;   DW_AT_frame_base  : 0x38   (location list)
</span><span class='line'>    &lt;c0&gt;   DW_AT_sibling     : &lt;0xf8&gt;  
</span><span class='line'> &lt;2&gt;&lt;c4&gt;: Abbrev Number: 7 (DW_TAG_variable)
</span><span class='line'>    &lt;c5&gt;   DW_AT_name        : a 
</span><span class='line'>    &lt;c7&gt;   DW_AT_decl_file   : 1 
</span><span class='line'>    &lt;c8&gt;   DW_AT_decl_line   : 10
</span><span class='line'>    &lt;c9&gt;   DW_AT_type        : &lt;0x4f&gt;  
</span><span class='line'>    &lt;cd&gt;   DW_AT_location    : 2 byte block: 74 1c    (DW_OP_breg4 (esp): 28)
</span><span class='line'> &lt;2&gt;&lt;d0&gt;: Abbrev Number: 7 (DW_TAG_variable)
</span><span class='line'>    &lt;d1&gt;   DW_AT_name        : b 
</span><span class='line'>    &lt;d3&gt;   DW_AT_decl_file   : 1 
</span><span class='line'>    &lt;d4&gt;   DW_AT_decl_line   : 10
</span><span class='line'>    &lt;d5&gt;   DW_AT_type        : &lt;0x4f&gt;  
</span><span class='line'>    &lt;d9&gt;   DW_AT_location    : 2 byte block: 74 18    (DW_OP_breg4 (esp): 24)
</span><span class='line'> &lt;2&gt;&lt;dc&gt;: Abbrev Number: 8 (DW_TAG_variable)
</span><span class='line'>    &lt;dd&gt;           : (indirect string, offset: 0x6a): result 
</span><span class='line'>    &lt;e1&gt;   DW_AT_decl_file   : 1 
</span><span class='line'>    &lt;e2&gt;   DW_AT_decl_line   : 11
</span><span class='line'>    &lt;e3&gt;   DW_AT_type        : &lt;0x4f&gt;  
</span><span class='line'>    &lt;e7&gt;   DW_AT_location    : 2 byte block: 74 10    (DW_OP_breg4 (esp): 16)
</span><span class='line'> &lt;2&gt;&lt;ea&gt;: Abbrev Number: 7 (DW_TAG_variable)
</span><span class='line'>    &lt;eb&gt;   DW_AT_name        : fp
</span><span class='line'>    &lt;ee&gt;   DW_AT_decl_file   : 1 
</span><span class='line'>    &lt;ef&gt;   DW_AT_decl_line   : 12
</span><span class='line'>    &lt;f0&gt;   DW_AT_type        : &lt;0x10d&gt; 
</span><span class='line'>    &lt;f4&gt;   DW_AT_location    : 2 byte block: 74 14    (DW_OP_breg4 (esp): 20)</span></code></pre></td></tr></table></div></figure>


<p>Note the first number inside the angle brackets in each entry. This is the nesting level – in this example entries with <2> are children of the entry with <1>. main function has three integer variables a,b and result each of these variables are described with DW_TAG_variable nested DIE’s (0xc4, 0xd0, 0xdc). main function also has a function pointer  fp described  in DIE 0xea . Variable DIE attributes specify variable name (DW_AT_name), declaration line no in source function (DW_AT_decl_line ), pointer to address of DIE describing variables data type (DW_AT_type) and relative location of the variable within function’s frame (DW_AT_location).</p>

<p>To locate the variable in the memory image of the executing process, the debugger will look at the DW_AT_location attribute of DIE. For a its value is    DW_OP_fbreg4 (esp):28. This means that the variable is stored at offset 28  from the top in the frame of  containing function. The DW_AT_frame_base attribute of main has the value 0×38(location list), which means that this value actually has to be looked up in the location list section. Let’s look at it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@techveda:~# objdump --dwarf=loc sample
</span><span class='line'> 
</span><span class='line'>sample:     file format elf32-i386
</span><span class='line'> 
</span><span class='line'>Contents of the .debug_loc section:
</span><span class='line'> 
</span><span class='line'>    Offset   Begin    End      Expression
</span><span class='line'>    00000000 080483c4 080483c5 (DW_OP_breg4 (esp): 4)
</span><span class='line'>    00000000 080483c5 080483c7 (DW_OP_breg4 (esp): 8)
</span><span class='line'>    00000000 080483c7 080483d1 (DW_OP_breg5 (ebp): 8)
</span><span class='line'>    00000000 080483d1 080483d2 (DW_OP_breg4 (esp): 4)
</span><span class='line'>    00000000 &lt;End of list&gt;
</span><span class='line'>    00000038 080483d2 080483d3 (DW_OP_breg4 (esp): 4)
</span><span class='line'>    00000038 080483d3 080483d5 (DW_OP_breg4 (esp): 8)
</span><span class='line'>    00000038 080483d5 08048422 (DW_OP_breg5 (ebp): 8)
</span><span class='line'>    00000038 08048422 08048423 (DW_OP_breg4 (esp): 4)
</span><span class='line'>    00000038 &lt;End of list&gt;</span></code></pre></td></tr></table></div></figure>


<p>Offset column 0×38 values are the entries for main function variables. Each entry here describes possible frame base address with respect to where debugger may be paused by break point within function instructions; it specifies the current frame base from which offsets to variables are to be computed as an offset from a register. For x86, bpreg4 refers to esp and bpreg5 refers to ebp.  Before analyzing further lets look at disassemble dump for main function</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>080483d2 &lt;main&gt;:
</span><span class='line'> 80483d2:   55                      push   %ebp
</span><span class='line'> 80483d3:   89 e5                   mov    %esp,%ebp
</span><span class='line'> 80483d5:   83 e4 f0                and    $0xfffffff0,%esp
</span><span class='line'> 80483d8:   83 ec 20                sub    $0x20,%esp
</span><span class='line'> 80483db:   c7 44 24 1c 0a 00 00    movl   $0xa,0x1c(%esp)
</span><span class='line'> 80483e2:   00
</span><span class='line'> 80483e3:   c7 44 24 18 14 00 00    movl   $0x14,0x18(%esp)
</span><span class='line'> 80483ea:   00
</span><span class='line'> 80483eb:   c7 44 24 14 c4 83 04    movl   $0x80483c4,0x14(%esp)
</span><span class='line'> 80483f2:   08
</span><span class='line'> 80483f3:   8b 44 24 18             mov    0x18(%esp),%eax
</span><span class='line'> 80483f7:   89 44 24 04             mov    %eax,0x4(%esp)
</span><span class='line'> 80483fb:   8b 44 24 1c             mov    0x1c(%esp),%eax
</span><span class='line'> 80483ff:   89 04 24                mov    %eax,(%esp)
</span><span class='line'> 8048402:   8b 44 24 14             mov    0x14(%esp),%eax
</span><span class='line'> 8048406:   ff d0                               call   *%eax
</span><span class='line'> 8048408:   89 44 24 10             mov    %eax,0x10(%esp)
</span><span class='line'> 804840c:   b8 f0 84 04 08          mov    $0x80484f0,%eax
</span><span class='line'> 8048411:   8b 54 24 10             mov    0x10(%esp),%edx
</span><span class='line'> 8048415:   89 54 24 04             mov    %edx,0x4(%esp)
</span><span class='line'> 8048419:   89 04 24                mov    %eax,(%esp)
</span><span class='line'> 804841c:   e8 d3 fe ff ff          call   80482f4 &lt;printf@plt&gt;
</span><span class='line'> 8048421:   c9                      leave 
</span><span class='line'> 8048422:   c3                      ret</span></code></pre></td></tr></table></div></figure>


<p>First two instructions deal with function’s preamble, function’s stack frame base pointer is determined after pre-amble instructions are executed.  Ebp remains constant throughout function’s execution and esp keeps changing with data being pushed and popped from the stack frame. From the above dump instructions at offset 80483db and 80483e3 are assigning values 10 and 20 to variables a, and b. These variables are being accessed their offset in stack frame relative to location of current esp( variable a: 0x1c(%esp), variable b: 0×18(%esp)). Now let’s assume that break point was set after initializing a and b variables and program paused, and we have run print command to view conents of a or b variables. Debugger would access 3rd record of the main function’s dwarf debug.loc table since our break point falls between 080483d5 – 08048422 region of the function code.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>00000038 080483d2 080483d3 (DW_OP_breg4 (esp): 4)
</span><span class='line'>00000038 080483d3 080483d5 (DW_OP_breg4 (esp): 8)
</span><span class='line'>00000038 080483d5 08048422 (DW_OP_breg5 (ebp): 8)--- 3rd record
</span><span class='line'>00000038 08048422 08048423 (DW_OP_breg4 (esp): 4)</span></code></pre></td></tr></table></div></figure>


<p>Now as per records debugger will locate a with esp + 28 , b with esp +24 and so on…</p>

<p>Looking up line number information</p>

<p>We can set breakpoints mentioning line no’s Lets now look at how debuggers resolve line no’s to machine instruction’s? DWARF encodes a full mapping between lines in the C source code and machine code addresses in the executable. This information is contained in the .debug_line section and can be extracted using objdump</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@techveda:~# objdump --dwarf=decodedline ./sample
</span><span class='line'> 
</span><span class='line'>./sample:     file format elf32-i386
</span><span class='line'> 
</span><span class='line'>Decoded dump of debug contents of section .debug_line:
</span><span class='line'> 
</span><span class='line'>CU: sample.c:
</span><span class='line'>File name                            Line number    Starting address                   
</span><span class='line'>sample.c                                       5          0x80483c4
</span><span class='line'>sample.c                                       6          0x80483c7
</span><span class='line'>sample.c                                       7          0x80483d0
</span><span class='line'>sample.c                                       9          0x80483d2
</span><span class='line'>sample.c                                      10          0x80483db
</span><span class='line'>sample.c                                      14          0x80483eb
</span><span class='line'>sample.c                                      15          0x80483f3
</span><span class='line'>sample.c                                      16          0x804840c
</span><span class='line'>sample.c                                      17          0x8048421</span></code></pre></td></tr></table></div></figure>


<p>This dump shows machine instruction line no’s for our program. It is quite obvious that line no’s for non-executable statements of the source file need not be tracked by dwarf .we can map the above dump to our source code for analysis.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1 #include &lt;stdio.h&gt;
</span><span class='line'> 2 #include &lt;stdlib.h&gt;
</span><span class='line'> 3
</span><span class='line'> 4 int add(int x, int y)
</span><span class='line'> 5 {
</span><span class='line'> 6         return x + y;
</span><span class='line'> 7 }
</span><span class='line'> 8 int main()
</span><span class='line'> 9 {
</span><span class='line'>10         int a = 10, b = 20;
</span><span class='line'>11         int result;
</span><span class='line'>12         int (*fp) (int, int);
</span><span class='line'>13
</span><span class='line'>14         fp = add;
</span><span class='line'>15         result = (*fp) (a, b);
</span><span class='line'>16         printf(" %dn", result);
</span><span class='line'>17 }</span></code></pre></td></tr></table></div></figure>


<p>From the above it should be clear of what debugger does it is instructed to set breakpoint at entry into function add, it would insert break point at line no 6 and pause after pre-amble of function add is executed.</p>

<p>What’s next?</p>

<p>if you are into implementation of debugging tools or involved in writing programs/tools  that simulate debugger facilities/ read binary files , you may be interested in specific programming libraries libbfd or libdwarf.</p>

<p>Binary File Descriptor library (BFD) or libbfd as it is called provides ready to use functions to read into ELF and other popular binary files. BFD works by presenting a common abstract view of object files. An object file has a “header” with descriptive info; a variable number of “sections” that each has a name, some attributes, and a block of data; a symbol table; relocation entries; and so forth. Gnu binutils package tools like objdump, readelf and others have been written using these libraries.</p>

<p>Libdwarf is a C library intended to simplify reading (and writing) applications built with DWARF2, DWARF3 debug information.</p>

<p>Dwarfdump is an application written using libdwarf to print dwarf information in a human readable format. It is also open sourced and is copyrighted GPL. It provides an example of using libdwarf to read DWARF2/3 information as well as providing readable text output.</p>

<p>References</p>

<p><a href="http://www.dwarfstd.org/">Dwarf Standard</a><br/>
<a href="http://wiki.dwarfstd.org/index.php?title=Libdwarf_And_Dwarfdump">Libdwarf Wiki</a><br/>
<a href="http://www.skyfree.org/linux/references/bfd.pdf">Libbfd draft</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/12/02/debug-articles/">debug articles</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-12-02T17:44:00+08:00'><span class='date'>2013-12-02</span> <span class='time'>17:44:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>debug article <a href="http://blog.csdn.net/u011279649/article/category/1491593">http://blog.csdn.net/u011279649/article/category/1491593</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/11/29/debug-dwarf-article/">BFD or dwarf? article</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-29T17:54:00+08:00'><span class='date'>2013-11-29</span> <span class='time'>17:54:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://blog.techveda.org/howsourcedebuggerswork/">http://blog.techveda.org/howsourcedebuggerswork/</a></p>

<p><a href="http://bbs.sjtu.edu.cn/bbscon,board,Security,file,M.1134227822.A.html">http://bbs.sjtu.edu.cn/bbscon,board,Security,file,M.1134227822.A.html</a></p>

<p><a href="http://blog.csdn.net/warriorpaw/article/details/8660704">http://blog.csdn.net/warriorpaw/article/details/8660704</a></p>

<p><a href="http://blog.csdn.net/rrerre/article/details/6843539">http://blog.csdn.net/rrerre/article/details/6843539</a></p>

<p><a href="http://blog.csdn.net/rrerre/article/details/6639484">http://blog.csdn.net/rrerre/article/details/6639484</a></p>

<p><a href="http://dwarfstd.org/doc/Dwarf3.pdf">http://dwarfstd.org/doc/Dwarf3.pdf</a></p>

<p>dwarf2解析 <a href="http://hi.baidu.com/tag/dwarf2%E8%A7%A3%E6%9E%90/feeds">http://hi.baidu.com/tag/dwarf2%E8%A7%A3%E6%9E%90/feeds</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/11/29/debug-gdb-mi/">GDB MI接口相关</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-29T14:04:00+08:00'><span class='date'>2013-11-29</span> <span class='time'>14:04:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><span style="color:red">所谓GDB MI就是GNU Debugger Machine-Interface,是GNU设计来给其它前端使用的交互协议.</span></p>

<p>  说实在的,这个接口设计得并不是很好,仅仅是能用而已.它的指令和GDB/CLI即GDB Command Line Interface基本是对应的.<br/>
为 了方便机器交互,它把允许所有的指令有一个前缀,比如901-stack-list-frames 0 99.这样,在GDB返回的结果前,也会有同样的前缀901,我们可以根据这个前缀进行命令/结果匹配. 同时它还保证结果格式的统一性.不会出现CLI那种百花齐放的结果.当然,如果你安了GDB的python插件来做变量格式化,就可能出现例外的情况.</p>

<p>  它的命令有同步的,也有异步的.这对于前端的设计是个很大的障碍,而且除了命令结果以外,它还会有很多异步的消息,事件&hellip;这些东西混在一起,处理起来会相当麻烦.</p>

<p>  这是 <a href="http://ftp.gnu.org/old-gnu/Manuals/gdb-5.1.1/html_node/gdb_211.html#SEC216">GDB/MI的官方文档</a> 有兴趣的话可以仔细研究一下.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/11/29/debug-debuger-3/">调试器工作原理之三——调试信息</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-11-29T09:36:00+08:00'><span class='date'>2013-11-29</span> <span class='time'>09:36:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="/blog/2013/11/29/debug-debuger-1/">调试器工作原理之一——基础篇</a><br/>
<a href="/blog/2013/11/29/debug-debuger-2/">调试器工作原理之二——实现断点</a><br/>
调试器工作原理之三——调试信息</p>

<h4>本篇主要内容</h4>

<p>在本文中我将向大家解释关于调试器是如何在机器码中寻找C函数以及变量的，以及调试器使用了何种数据能够在C源代码的行号和机器码中来回映射。</p>

<h4>调试信息</h4>

<p>  现代的编译器在转换高级语言程序代码上做得十分出色，能够将源代码中漂亮的缩进、嵌套的控制结构以及任意类型的 变量全都转化为一长串的比特流——这就是机器码。这么做的唯一目的就是希望程序能在目标CPU上尽可能快的运行。大多数的C代码都被转化为一些机器码指 令。变量散落在各处——在栈空间里、在寄存器里，甚至完全被编译器优化掉。结构体和对象甚至在生成的目标代码中根本不存在——它们只不过是对内存缓冲区中 偏移量的抽象化表示。</p>

<p>  那么当你在某些函数的入口处设置断点时，调试器如何知道该在哪里停止目标进程的运行呢？当你希望查看一个变量的值时，调试器又是如何找到它并展示给你呢？答案就是——调试信息。</p>

<p>  调试信息是在编译器生成机器码的时候一起产生的。它代表着可执行程序和源代码之间的关系。这个信息以预定义的格式进行编码，并同机器码一起存储。许 多年以来，针对不同的平台和可执行文件，人们发明了许多这样的编码格式。由于本文的主要目的不是介绍这些格式的历史渊源，而是为您展示它们的工作原理，所 以我们只介绍一种最重要的格式，这就是DWARF。作为Linux以及其他类Unix平台上的ELF可执行文件的调试信息格式，如今的DWARF可以说是 无处不在。</p>

<h4>ELF文件中的DWARF格式</h4>

<p>  根据维基百科上的词条解释，DWARF是同ELF可执行文件格式一同设计出来的，尽管在理论上DWARF也能够嵌入到其它的对象文件格式中。</p>

<p>  DWARF是一种复杂的格式，在多种体系结构和操作系统上经过多年的探索之后，人们才在之前的格式基础上创建了DWARF。它肯定是很复杂的，因为 它解决了一个非常棘手的问题——为任意类型的高级语言和调试器之间提供调试信息，支持任意一种平台和应用程序二进制接口（ABI）。要完全解释清楚这个主 题，本文就显得太微不足道了。说实话，我也不理解其中的所有角落。本文我将采取更加实践的方法，只介绍足量的DWARF相关知识，能够阐明实际工作中调试 信息是如何发挥其作用的就可以了。</p>

<h4>ELF文件中的调试段</h4>

<p>  首先，让我们看看DWARF格式信息处在ELF文件中的什么位置上。ELF可以为每个目标文件定义任意多个段（section）。而Section header表中则定义了实际存在有哪些段，以及它们的名称。不同的工具以各自特殊的方式来处理这些不同的段，比如链接器只寻找它关注的段信息，而调试器 则只关注其他的段。
我们通过下面的C代码构建一个名为traceprog2的可执行文件来做下实验。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'> 
</span><span class='line'>void do_stuff(int my_arg)
</span><span class='line'>{
</span><span class='line'>    int my_local = my_arg + 2;
</span><span class='line'>    int i;
</span><span class='line'> 
</span><span class='line'>    for (i = 0; i &lt; my_local; ++i)
</span><span class='line'>        printf("i = %d\n", i);
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>int main()
</span><span class='line'>{
</span><span class='line'>    do_stuff(2);
</span><span class='line'>    return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>通过objdump –h导出ELF可执行文件中的段头信息，我们注意到其中有几个段的名字是以.debug_打头的，这些就是DWARF格式的调试段：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>26 .debug_aranges 00000020  00000000  00000000  00001037
</span><span class='line'>                  CONTENTS, READONLY, DEBUGGING
</span><span class='line'>27 .debug_pubnames    00000028  00000000  00000000  00001057
</span><span class='line'>                  CONTENTS, READONLY, DEBUGGING
</span><span class='line'>28 .debug_info    000000cc  00000000  00000000  0000107f
</span><span class='line'>                  CONTENTS, READONLY, DEBUGGING
</span><span class='line'>29 .debug_abbrev  0000008a  00000000  00000000  0000114b
</span><span class='line'>                  CONTENTS, READONLY, DEBUGGING
</span><span class='line'>30 .debug_line    0000006b  00000000  00000000  000011d5
</span><span class='line'>                  CONTENTS, READONLY, DEBUGGING
</span><span class='line'>31 .debug_frame   00000044  00000000  00000000  00001240
</span><span class='line'>                  CONTENTS, READONLY, DEBUGGING
</span><span class='line'>32 .debug_str     000000ae  00000000  00000000  00001284
</span><span class='line'>                  CONTENTS, READONLY, DEBUGGING
</span><span class='line'>33 .debug_loc     00000058  00000000  00000000  00001332
</span><span class='line'>                  CONTENTS, READONLY, DEBUGGING</span></code></pre></td></tr></table></div></figure>


<p>  每行的第一个数字表示每个段的大小，而最后一个数字表示距离ELF文件开始处的偏移量。调试器就是利用这个信息来从可执行文件中读取相关的段信息。现在，让我们通过一些实际的例子来看看如何在DWARF中找寻有用的调试信息。</p>

<h4>定位函数</h4>

<p>  当我们在调试程序时，一个最为基本的操作就是在某些函数中设置断点，期望调试器能在函数入口处将程序断下。要完成这个功能，调试器必须具有某种能够从源代码中的函数名称到机器码中该函数的起始指令间相映射的能力。</p>

<p>  这个信息可以通过从DWARF中的.debug_info段获取到。在我们继续之前，先说点背景知识。DWARF的基本描述实体被称为调试信息表项 （Debugging Information Entry —— DIE），每个DIE有一个标签——包含它的类型，以及一组属性。各个DIE之间通过兄弟和孩子结点互相链接，属性值可以指向其他的DIE。<br/>
我们运行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>objdump –dwarf=info traceprog2</span></code></pre></td></tr></table></div></figure>


<p>得到的输出非常长，对于这个例子，我们只用关注这几行就可以了：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;1&gt;&lt;71&gt;: Abbrev Number: 5 (DW_TAG_subprogram)
</span><span class='line'>  &lt;72&gt;   DW_AT_external : 1
</span><span class='line'>  &lt;73&gt;   DW_AT_name     : (...): do_stuff
</span><span class='line'>  &lt;77&gt;   DW_AT_decl_file    : 1
</span><span class='line'>  &lt;78&gt;   DW_AT_decl_line    : 4
</span><span class='line'>  &lt;79&gt;   DW_AT_prototyped   : 1
</span><span class='line'>  &lt;7a&gt;   DW_AT_low_pc       : 0x8048604
</span><span class='line'>  &lt;7e&gt;   DW_AT_high_pc  : 0x804863e
</span><span class='line'>  &lt;82&gt;   DW_AT_frame_base   : 0x0     (location list)
</span><span class='line'>  &lt;86&gt;   DW_AT_sibling  : &lt;0xb3&gt;
</span><span class='line'> 
</span><span class='line'>&lt;1&gt;&lt;b3&gt;: Abbrev Number: 9 (DW_TAG_subprogram)
</span><span class='line'>  &lt;b4&gt;   DW_AT_external : 1
</span><span class='line'>  &lt;b5&gt;   DW_AT_name     : (...): main
</span><span class='line'>  &lt;b9&gt;   DW_AT_decl_file  : 1
</span><span class='line'>  &lt;ba&gt;   DW_AT_decl_line  : 14
</span><span class='line'>  &lt;bb&gt;   DW_AT_type     : &lt;0x4b&gt;
</span><span class='line'>  &lt;bf&gt;   DW_AT_low_pc       : 0x804863e
</span><span class='line'>  &lt;c3&gt;   DW_AT_high_pc  : 0x804865a
</span><span class='line'>&lt;c7&gt;   DW_AT_frame_base     : 0x2c   (location list)</span></code></pre></td></tr></table></div></figure>


<p>  这里有两个被标记为DW_TAG_subprogram的DIE，从DWARF的角度看这就是函数。注意，这里do_stuff和main都各有一 个表项。这里有许多有趣的属性，但我们感兴趣的是DW_AT_low_pc。这就是函数起始处的程序计数器的值（x86下的EIP）。注意，对于 do_stuff来说，这个值是0×8048604。现在让我们看看，通过objdump –d做反汇编后这个地址是什么：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>08048604 &lt;do_stuff&gt;:
</span><span class='line'> 8048604:       55           push   ebp
</span><span class='line'> 8048605:       89 e5        mov    ebp,esp
</span><span class='line'> 8048607:       83 ec 28     sub    esp,0x28
</span><span class='line'> 804860a:       8b 45 08     mov    eax,DWORD PTR [ebp+0x8]
</span><span class='line'> 804860d:       83 c0 02     add    eax,0x2
</span><span class='line'> 8048610:       89 45 f4     mov    DWORD PTR [ebp-0xc],eax
</span><span class='line'> 8048613:       c7 45 (...)  mov    DWORD PTR [ebp-0x10],0x0
</span><span class='line'> 804861a:       eb 18        jmp    8048634 &lt;do_stuff+0x30&gt;
</span><span class='line'> 804861c:       b8 20 (...)  mov    eax,0x8048720
</span><span class='line'> 8048621:       8b 55 f0     mov    edx,DWORD PTR [ebp-0x10]
</span><span class='line'> 8048624:       89 54 24 04  mov    DWORD PTR [esp+0x4],edx
</span><span class='line'> 8048628:       89 04 24     mov    DWORD PTR [esp],eax
</span><span class='line'> 804862b:       e8 04 (...)  call   8048534 &lt;printf@plt&gt;
</span><span class='line'> 8048630:       83 45 f0 01  add    DWORD PTR [ebp-0x10],0x1
</span><span class='line'> 8048634:       8b 45 f0     mov    eax,DWORD PTR [ebp-0x10]
</span><span class='line'> 8048637:       3b 45 f4     cmp    eax,DWORD PTR [ebp-0xc]
</span><span class='line'> 804863a:       7c e0        jl     804861c &lt;do_stuff+0x18&gt;
</span><span class='line'> 804863c:       c9           leave
</span><span class='line'> 804863d:       c3           ret</span></code></pre></td></tr></table></div></figure>


<p>  没错，从反汇编结果来看0×8048604确实就是函数do_stuff的起始地址。因此，这里调试器就同函数和它们在可执行文件中的位置确立了映射关系。</p>

<h4>定位变量</h4>

<p>  假设我们确实在do_stuff中的断点处停了下来。我们希望调试器能够告诉我们my_local变量的值，调试器怎么知道去哪里找到相关的信息 呢？这可比定位函数要难多了，因为变量可以在全局数据区，可以在栈上，甚至是在寄存器中。另外，具有相同名称的变量在不同的词法作用域中可能有不同的值。 调试信息必须能够反映出所有这些变化，而DWARF确实能做到这些。</p>

<p>  我不会涵盖所有的可能情况，作为例子，我将只展示调试器如何在do_stuff函数中定位到变量my_local。我们从.debug_info段开始，再次看看do_stuff这一项，这一次我们也看看其他的子项：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;1&gt;&lt;71&gt;: Abbrev Number: 5 (DW_TAG_subprogram)
</span><span class='line'>    &lt;72&gt;   DW_AT_external    : 1
</span><span class='line'>    &lt;73&gt;   DW_AT_name        : (...): do_stuff
</span><span class='line'>    &lt;77&gt;   DW_AT_decl_file   : 1
</span><span class='line'>    &lt;78&gt;   DW_AT_decl_line   : 4
</span><span class='line'>    &lt;79&gt;   DW_AT_prototyped  : 1
</span><span class='line'>    &lt;7a&gt;   DW_AT_low_pc      : 0x8048604
</span><span class='line'>    &lt;7e&gt;   DW_AT_high_pc     : 0x804863e
</span><span class='line'>    &lt;82&gt;   DW_AT_frame_base  : 0x0      (location list)
</span><span class='line'>    &lt;86&gt;   DW_AT_sibling     : &lt;0xb3&gt;
</span><span class='line'> &lt;2&gt;&lt;8a&gt;: Abbrev Number: 6 (DW_TAG_formal_parameter)
</span><span class='line'>    &lt;8b&gt;   DW_AT_name        : (...): my_arg
</span><span class='line'>    &lt;8f&gt;   DW_AT_decl_file   : 1
</span><span class='line'>    &lt;90&gt;   DW_AT_decl_line   : 4
</span><span class='line'>    &lt;91&gt;   DW_AT_type        : &lt;0x4b&gt;
</span><span class='line'>    &lt;95&gt;   DW_AT_location    : (...)       (DW_OP_fbreg: 0)
</span><span class='line'> &lt;2&gt;&lt;98&gt;: Abbrev Number: 7 (DW_TAG_variable)
</span><span class='line'>    &lt;99&gt;   DW_AT_name        : (...): my_local
</span><span class='line'>    &lt;9d&gt;   DW_AT_decl_file   : 1
</span><span class='line'>    &lt;9e&gt;   DW_AT_decl_line   : 6
</span><span class='line'>    &lt;9f&gt;   DW_AT_type        : &lt;0x4b&gt;
</span><span class='line'>    &lt;a3&gt;   DW_AT_location    : (...)      (DW_OP_fbreg: -20)
</span><span class='line'>&lt;2&gt;&lt;a6&gt;: Abbrev Number: 8 (DW_TAG_variable)
</span><span class='line'>    &lt;a7&gt;   DW_AT_name        : i
</span><span class='line'>    &lt;a9&gt;   DW_AT_decl_file   : 1
</span><span class='line'>    &lt;aa&gt;   DW_AT_decl_line   : 7
</span><span class='line'>    &lt;ab&gt;   DW_AT_type        : &lt;0x4b&gt;
</span><span class='line'>&lt;af&gt;   DW_AT_location    : (...)      (DW_OP_fbreg: -24)</span></code></pre></td></tr></table></div></figure>


<p>  注意每一个表项中第一个尖括号里的数字，这表示嵌套层次——在这个例子中带有<2>的表项都是表项<1>的子项。因此我们 知道变量my_local（以DW_TAG_variable作为标签）是函数do_stuff的一个子项。调试器同样还对变量的类型感兴趣，这样才能正 确的显示变量的值。这里my_local的类型根据DW_AT_type标签可知为<0x4b>。如果查看objdump的输出，我们会发现 这是一个有符号4字节整数。</p>

<p>  要在执行进程的内存映像中实际定位到变量，调试器需要检查DW_AT_location属性。对于my_local来说，这个属性为 DW_OP_fberg: -20。这表示变量存储在从所包含它的函数的DW_AT_frame_base属性开始偏移-20处，而DW_AT_frame_base正代表了该函数 的栈帧起始点。</p>

<p>  函数do_stuff的DW_AT_frame_base属性的值是0×0（location list），这表示该值必须要在location list段去查询。我们看看objdump的输出：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ objdump --dwarf=loc tracedprog2
</span><span class='line'> 
</span><span class='line'>tracedprog2:     file format elf32-i386
</span><span class='line'> 
</span><span class='line'>Contents of the .debug_loc section:
</span><span class='line'> 
</span><span class='line'>    Offset   Begin    End      Expression
</span><span class='line'>    00000000 08048604 08048605 (DW_OP_breg4: 4 )
</span><span class='line'>    00000000 08048605 08048607 (DW_OP_breg4: 8 )
</span><span class='line'>    00000000 08048607 0804863e (DW_OP_breg5: 8 )
</span><span class='line'>    00000000 &lt;End of list&gt;
</span><span class='line'>    0000002c 0804863e 0804863f (DW_OP_breg4: 4 )
</span><span class='line'>    0000002c 0804863f 08048641 (DW_OP_breg4: 8 )
</span><span class='line'>    0000002c 08048641 0804865a (DW_OP_breg5: 8 )
</span><span class='line'>0000002c &lt;End of list&gt;</span></code></pre></td></tr></table></div></figure>


<p>  关于位置信息，我们这里感兴趣的就是第一个。对于调试器可能定位到的每一个地址，它都会指定当前栈帧到变量间的偏移量，而这个偏移就是通过寄存器来计算的。对于x86体系结构，bpreg4代表esp寄存器，而bpreg5代表ebp寄存器。</p>

<p>让我们再看看do_stuff的开头几条指令：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>08048604 &lt;do_stuff&gt;:
</span><span class='line'> 8048604:       55          push   ebp
</span><span class='line'> 8048605:       89 e5       mov    ebp,esp
</span><span class='line'> 8048607:       83 ec 28    sub    esp,0x28
</span><span class='line'> 804860a:       8b 45 08    mov    eax,DWORD PTR [ebp+0x8]
</span><span class='line'> 804860d:       83 c0 02    add    eax,0x2
</span><span class='line'> 8048610:       89 45 f4    mov    DWORD PTR [ebp-0xc],eax</span></code></pre></td></tr></table></div></figure>


<p>  注意，ebp只有在第二条指令执行后才与我们建立起关联，对于前两个地址，基地址由前面列出的位置信息中的esp计算得出。一旦得到了ebp的有效值，就可以很方便的计算出与它之间的偏移量。因为之后ebp保持不变，而esp会随着数据压栈和出栈不断移动。</p>

<p>  那么这到底为我们定位变量my_local留下了什么线索？我们感兴趣的只是在地址0×8048610上的指令执行过后my_local的值（这里 my_local的值会通过eax寄存器计算，而后放入内存）。因此调试器需要用到DW_OP_breg5: 8 基址来定位。现在回顾一下my_local的DW_AT_location属性：DW_OP_fbreg: -20。做下算数：从基址开始偏移-20，那就是ebp – 20，再偏移+8，我们得到ebp – 12。现在再看看反汇编输出，注意到数据确实是从eax寄存器中得到的，而ebp – 12就是my_local存储的位置。</p>

<h4>定位到行号</h4>

<p>  当我说到在调试信息中寻找函数时，我撒了个小小的谎。当我们调试C源代码并在函数中放置了一个断点时，我们通常并不会对第一条机器码指令感兴趣。我们真正感兴趣的是函数中的第一行C代码。</p>

<p>这就是为什么DWARF在可执行文件中对C源码到机器码地址做了全部映射。这部分信息包含在.debug_line段中，可以按照可读的形式进行解读：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ objdump --dwarf=decodedline tracedprog2
</span><span class='line'> 
</span><span class='line'>tracedprog2:     file format elf32-i386
</span><span class='line'> 
</span><span class='line'>Decoded dump of debug contents of section .debug_line:
</span><span class='line'> 
</span><span class='line'>CU: /home/eliben/eli/eliben-code/debugger/tracedprog2.c:
</span><span class='line'>File name           Line number    Starting address
</span><span class='line'>tracedprog2.c                5           0x8048604
</span><span class='line'>tracedprog2.c                6           0x804860a
</span><span class='line'>tracedprog2.c                9           0x8048613
</span><span class='line'>tracedprog2.c               10           0x804861c
</span><span class='line'>tracedprog2.c                9           0x8048630
</span><span class='line'>tracedprog2.c               11           0x804863c
</span><span class='line'>tracedprog2.c               15           0x804863e
</span><span class='line'>tracedprog2.c               16           0x8048647
</span><span class='line'>tracedprog2.c               17           0x8048653
</span><span class='line'>tracedprog2.c               18           0x8048658</span></code></pre></td></tr></table></div></figure>


<p>  不难看出C源码同反汇编输出之间的关系。第5行源码指向函数do_stuff的入口点——地址0×8040604。接下第6行源码，当在 do_stuff上设置断点时，这里就是调试器实际应该停下的地方，它指向地址0x804860a——刚过do_stuff的开场白。这个行信息能够方便 的在C源码的行号同指令地址间建立双向的映射关系。<br/>
1. 当在某一行上设定断点时，调试器将利用行信息找到实际应该陷入的地址（还记得前一篇中的int 3指令吗？）<br/>
2. 当某个指令引起段错误时，调试器会利用行信息反过来找出源代码中的行号，并告诉用户。</p>

<h4>libdwarf —— 在程序中访问DWARF</h4>

<p>  通过命令行工具来访问DWARF信息这虽然有用但还不能完全令我们满意。作为程序员，我们希望知道应该如何写出实际的代码来解析DWARF格式并从中读取我们需要的信息。</p>

<p>  自然的，一种方法就是拿起DWARF规范开始钻研。还记得每个人都告诉你永远不要自己手动解析HTML，而应该使用函数库来做吗？没错，如果你要手 动解析DWARF的话情况会更糟糕，DWARF比HTML要复杂的多。本文展示的只是冰山一角而已。更困难的是，在实际的目标文件中，这些信息大部分都以 非常紧凑和压缩的方式进行编码处理。</p>

<p>因此我们要走另一条路，使用一个函数库来同DWARF打交道。我知道的这类函数库主要有两个：<br/>
1. BFD（libbfd），GNU binutils就是使用的它，包括本文中多次使用到的工具objdump，ld（GNU链接器），以及as（GNU汇编器）。<br/>
2. libdwarf —— 同它的老大哥libelf一样，为Solaris以及FreeBSD系统上的工具服务。<br/>
我这里选择了libdwarf，因为对我来说它看起来没那么神秘，而且license更加自由（LGPL，BFD是GPL）。<br/>
  由于libdwarf自身非常复杂，需要很多代码来操作。我这里不打算把所有代码贴出来，但你可以下载，然后自己编译运行。要编译这个文件，你需要安装libelf以及libdwarf，并在编译时为链接器提供-lelf以及-ldwarf标志。</p>

<p>这个演示程序接收一个可执行文件，并打印出程序中的函数名称同函数入口点地址。下面是本文用以演示的C程序产生的输出：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dwarf_get_func_addr tracedprog2
</span><span class='line'>DW_TAG_subprogram: 'do_stuff'
</span><span class='line'>low pc  : 0x08048604
</span><span class='line'>high pc : 0x0804863e
</span><span class='line'>DW_TAG_subprogram: 'main'
</span><span class='line'>low pc  : 0x0804863e
</span><span class='line'>high pc : 0x0804865a</span></code></pre></td></tr></table></div></figure>


<p>libdwarf的文档非常好（见本文的参考文献部分），花点时间看看，对于本文中提到的DWARF段信息你处理起来就应该没什么问题了。</p>

<h4>结论及下一步</h4>

<p>  调试信息只是一个简单的概念，具体实现细节可能相当复杂。但最终我们知道了调试器是如何从可执行文件中找出同源代码之间的关系。有了调试信息在手，调试器为用户所能识别的源代码和数据结构同可执行文件之间架起了一座桥。</p>

<p>  本文加上之前的两篇文章总结了调试器内部的工作原理。通过这一系列文章，再加上一点编程工作就应该可以在Linux下创建一个具有基本功能的调试器。</p>

<p>  至于下一步，我还不确定。也许我会就此终结这一系列文章，也许我会再写一些高级主题比如backtrace，甚至Windows系统上的调试。读者们也可以为今后这一系列文章提供意见和想法。不要客气，请随意在评论栏或通过Email给我提些建议吧。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/49">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/47">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
<h1>Categories</h1>
<head>
</head>
<body>
<div id="menu">
<ul>
<li class='catclass'><a href='/blog/cats/language/'>language</a><a href='##' onmousedown=showDiv('language') id='aexp_language'><span class='exp_style' id='exp_language'>[+]</span></a><span class='right_span'>(38)</span></li>
<div id='language' class='catsub'><li><a href='/blog/cats/language~c/?opendiv=language'>c</a><a href='##' onmousedown=showDiv('language~c') id='aexp_language~c'><span class='exp_style' id='exp_language~c'>[+]</span></a><span class='right_span'>21</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~c')) document.getElementById('aexp_language~c').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~java/?opendiv=language'>java</a><a href='##' onmousedown=showDiv('language~java') id='aexp_language~java'><span class='exp_style' id='exp_language~java'>[+]</span></a><span class='right_span'>11</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~java')) document.getElementById('aexp_language~java').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~web/?opendiv=language'>web</a><a href='##' onmousedown=showDiv('language~web') id='aexp_language~web'><span class='exp_style' id='exp_language~web'>[+]</span></a><span class='right_span'>6</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('language')) document.getElementById('aexp_language').style.visibility = 'hidden';
if (!document.getElementById('language~web')) document.getElementById('aexp_language~web').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/compiler/'>compiler</a><a href='##' onmousedown=showDiv('compiler') id='aexp_compiler'><span class='exp_style' id='exp_compiler'>[+]</span></a><span class='right_span'>(14)</span></li>
<div id='compiler' class='catsub'><li><a href='/blog/cats/compiler~base/?opendiv=compiler'>base</a><a href='##' onmousedown=showDiv('compiler~base') id='aexp_compiler~base'><span class='exp_style' id='exp_compiler~base'>[+]</span></a><span class='right_span'>10</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler~base')) document.getElementById('aexp_compiler~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/compiler~make/?opendiv=compiler'>make</a><a href='##' onmousedown=showDiv('compiler~make') id='aexp_compiler~make'><span class='exp_style' id='exp_compiler~make'>[+]</span></a><span class='right_span'>4</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler')) document.getElementById('aexp_compiler').style.visibility = 'hidden';
if (!document.getElementById('compiler~make')) document.getElementById('aexp_compiler~make').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/assembly/'>assembly</a><a href='##' onmousedown=showDiv('assembly') id='aexp_assembly'><span class='exp_style' id='exp_assembly'>[+]</span></a><span class='right_span'>(14)</span></li>
<div id='assembly' class='catsub'><li><a href='/blog/cats/assembly~arm/?opendiv=assembly'>arm</a><a href='##' onmousedown=showDiv('assembly~arm') id='aexp_assembly~arm'><span class='exp_style' id='exp_assembly~arm'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('assembly~arm')) document.getElementById('aexp_assembly~arm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/assembly~base/?opendiv=assembly'>base</a><a href='##' onmousedown=showDiv('assembly~base') id='aexp_assembly~base'><span class='exp_style' id='exp_assembly~base'>[+]</span></a><span class='right_span'>12</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('assembly')) document.getElementById('aexp_assembly').style.visibility = 'hidden';
if (!document.getElementById('assembly~base')) document.getElementById('aexp_assembly~base').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/tools/'>tools</a><a href='##' onmousedown=showDiv('tools') id='aexp_tools'><span class='exp_style' id='exp_tools'>[+]</span></a><span class='right_span'>(38)</span></li>
<div id='tools' class='catsub'><li><a href='/blog/cats/tools~base/?opendiv=tools'>base</a><a href='##' onmousedown=showDiv('tools~base') id='aexp_tools~base'><span class='exp_style' id='exp_tools~base'>[+]</span></a><span class='right_span'>13</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~base')) document.getElementById('aexp_tools~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~ci/?opendiv=tools'>ci</a><a href='##' onmousedown=showDiv('tools~ci') id='aexp_tools~ci'><span class='exp_style' id='exp_tools~ci'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~ci')) document.getElementById('aexp_tools~ci').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~command/?opendiv=tools'>command</a><a href='##' onmousedown=showDiv('tools~command') id='aexp_tools~command'><span class='exp_style' id='exp_tools~command'>[+]</span></a><span class='right_span'>7</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~command')) document.getElementById('aexp_tools~command').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~git/?opendiv=tools'>git</a><a href='##' onmousedown=showDiv('tools~git') id='aexp_tools~git'><span class='exp_style' id='exp_tools~git'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~git')) document.getElementById('aexp_tools~git').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~mysql/?opendiv=tools'>mysql</a><a href='##' onmousedown=showDiv('tools~mysql') id='aexp_tools~mysql'><span class='exp_style' id='exp_tools~mysql'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~mysql')) document.getElementById('aexp_tools~mysql').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~ssh/?opendiv=tools'>ssh</a><a href='##' onmousedown=showDiv('tools~ssh') id='aexp_tools~ssh'><span class='exp_style' id='exp_tools~ssh'>[+]</span></a><span class='right_span'>3</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('tools')) document.getElementById('aexp_tools').style.visibility = 'hidden';
if (!document.getElementById('tools~ssh')) document.getElementById('aexp_tools~ssh').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/system/'>system</a><a href='##' onmousedown=showDiv('system') id='aexp_system'><span class='exp_style' id='exp_system'>[+]</span></a><span class='right_span'>(28)</span></li>
<div id='system' class='catsub'><li><a href='/blog/cats/system~base/?opendiv=system'>base</a><a href='##' onmousedown=showDiv('system~base') id='aexp_system~base'><span class='exp_style' id='exp_system~base'>[+]</span></a><span class='right_span'>14</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~base')) document.getElementById('aexp_system~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~centos/?opendiv=system'>centos</a><a href='##' onmousedown=showDiv('system~centos') id='aexp_system~centos'><span class='exp_style' id='exp_system~centos'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~centos')) document.getElementById('aexp_system~centos').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~ubuntu/?opendiv=system'>ubuntu</a><a href='##' onmousedown=showDiv('system~ubuntu') id='aexp_system~ubuntu'><span class='exp_style' id='exp_system~ubuntu'>[+]</span></a><span class='right_span'>8</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('system')) document.getElementById('aexp_system').style.visibility = 'hidden';
if (!document.getElementById('system~ubuntu')) document.getElementById('aexp_system~ubuntu').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/kernel/'>kernel</a><a href='##' onmousedown=showDiv('kernel') id='aexp_kernel'><span class='exp_style' id='exp_kernel'>[+]</span></a><span class='right_span'>(123)</span></li>
<div id='kernel' class='catsub'><li><a href='/blog/cats/kernel~base/?opendiv=kernel'>base</a><a href='##' onmousedown=showDiv('kernel~base') id='aexp_kernel~base'><span class='exp_style' id='exp_kernel~base'>[+]</span></a><span class='right_span'>16</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~base')) document.getElementById('aexp_kernel~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~irq/?opendiv=kernel'>irq</a><a href='##' onmousedown=showDiv('kernel~irq') id='aexp_kernel~irq'><span class='exp_style' id='exp_kernel~irq'>[+]</span></a><span class='right_span'>10</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~irq')) document.getElementById('aexp_kernel~irq').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~kexec/?opendiv=kernel'>kexec</a><a href='##' onmousedown=showDiv('kernel~kexec') id='aexp_kernel~kexec'><span class='exp_style' id='exp_kernel~kexec'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~kexec')) document.getElementById('aexp_kernel~kexec').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~mm/?opendiv=kernel'>mm</a><a href='##' onmousedown=showDiv('kernel~mm') id='aexp_kernel~mm'><span class='exp_style' id='exp_kernel~mm'>[+]</span></a><span class='right_span'>21</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~mm')) document.getElementById('aexp_kernel~mm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~net/?opendiv=kernel'>net</a><a href='##' onmousedown=showDiv('kernel~net') id='aexp_kernel~net'><span class='exp_style' id='exp_kernel~net'>[+]</span></a><span class='right_span'>57</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~net')) document.getElementById('aexp_kernel~net').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~sched/?opendiv=kernel'>sched</a><a href='##' onmousedown=showDiv('kernel~sched') id='aexp_kernel~sched'><span class='exp_style' id='exp_kernel~sched'>[+]</span></a><span class='right_span'>18</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel')) document.getElementById('aexp_kernel').style.visibility = 'hidden';
if (!document.getElementById('kernel~sched')) document.getElementById('aexp_kernel~sched').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/android/'>android</a><a href='##' onmousedown=showDiv('android') id='aexp_android'><span class='exp_style' id='exp_android'>[+]</span></a><span class='right_span'>(19)</span></li>
<div id='android' class='catsub'><li><a href='/blog/cats/android~base/?opendiv=android'>base</a><a href='##' onmousedown=showDiv('android~base') id='aexp_android~base'><span class='exp_style' id='exp_android~base'>[+]</span></a><span class='right_span'>10</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~base')) document.getElementById('aexp_android~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~i9507v/?opendiv=android'>i9507v</a><a href='##' onmousedown=showDiv('android~i9507v') id='aexp_android~i9507v'><span class='exp_style' id='exp_android~i9507v'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~i9507v')) document.getElementById('aexp_android~i9507v').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~me722/?opendiv=android'>me722</a><a href='##' onmousedown=showDiv('android~me722') id='aexp_android~me722'><span class='exp_style' id='exp_android~me722'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~me722')) document.getElementById('aexp_android~me722').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~nx403a/?opendiv=android'>nx403a</a><a href='##' onmousedown=showDiv('android~nx403a') id='aexp_android~nx403a'><span class='exp_style' id='exp_android~nx403a'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~nx403a')) document.getElementById('aexp_android~nx403a').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~s5830/?opendiv=android'>s5830</a><a href='##' onmousedown=showDiv('android~s5830') id='aexp_android~s5830'><span class='exp_style' id='exp_android~s5830'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('android')) document.getElementById('aexp_android').style.visibility = 'hidden';
if (!document.getElementById('android~s5830')) document.getElementById('aexp_android~s5830').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/debug/'>debug</a><a href='##' onmousedown=showDiv('debug') id='aexp_debug'><span class='exp_style' id='exp_debug'>[+]</span></a><span class='right_span'>(60)</span></li>
<div id='debug' class='catsub'><li><a href='/blog/cats/debug~base/?opendiv=debug'>base</a><a href='##' onmousedown=showDiv('debug~base') id='aexp_debug~base'><span class='exp_style' id='exp_debug~base'>[+]</span></a><span class='right_span'>16</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~base')) document.getElementById('aexp_debug~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~dwarf/?opendiv=debug'>dwarf</a><a href='##' onmousedown=showDiv('debug~dwarf') id='aexp_debug~dwarf'><span class='exp_style' id='exp_debug~dwarf'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~dwarf')) document.getElementById('aexp_debug~dwarf').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~gdb/?opendiv=debug'>gdb</a><a href='##' onmousedown=showDiv('debug~gdb') id='aexp_debug~gdb'><span class='exp_style' id='exp_debug~gdb'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~gdb')) document.getElementById('aexp_debug~gdb').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kdump,-crash/?opendiv=debug'>kdump、crash</a><a href='##' onmousedown=showDiv('debug~kdump、crash') id='aexp_debug~kdump、crash'><span class='exp_style' id='exp_debug~kdump、crash'>[+]</span></a><span class='right_span'>9</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kdump、crash')) document.getElementById('aexp_debug~kdump、crash').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kgdb/?opendiv=debug'>kgdb</a><a href='##' onmousedown=showDiv('debug~kgdb') id='aexp_debug~kgdb'><span class='exp_style' id='exp_debug~kgdb'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kgdb')) document.getElementById('aexp_debug~kgdb').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kprobe/?opendiv=debug'>kprobe</a><a href='##' onmousedown=showDiv('debug~kprobe') id='aexp_debug~kprobe'><span class='exp_style' id='exp_debug~kprobe'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kprobe')) document.getElementById('aexp_debug~kprobe').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~mark/?opendiv=debug'>mark</a><a href='##' onmousedown=showDiv('debug~mark') id='aexp_debug~mark'><span class='exp_style' id='exp_debug~mark'>[+]</span></a><span class='right_span'>13</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~mark')) document.getElementById('aexp_debug~mark').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~systemtap/?opendiv=debug'>systemtap</a><a href='##' onmousedown=showDiv('debug~systemtap') id='aexp_debug~systemtap'><span class='exp_style' id='exp_debug~systemtap'>[+]</span></a><span class='right_span'>5</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('debug')) document.getElementById('aexp_debug').style.visibility = 'hidden';
if (!document.getElementById('debug~systemtap')) document.getElementById('aexp_debug~systemtap').style.visibility = 'hidden';
</script>
<li><div style="background:#DDD; height:0.3em;"></div></li><li class='catclass'><a href='/blog/cats/algorithm/'>algorithm</a><a href='##' onmousedown=showDiv('algorithm') id='aexp_algorithm'><span class='exp_style' id='exp_algorithm'>[+]</span></a><span class='right_span'>(26)</span></li>
<div id='algorithm' class='catsub'><li><a href='/blog/cats/algorithm~base/?opendiv=algorithm'>base</a><a href='##' onmousedown=showDiv('algorithm~base') id='aexp_algorithm~base'><span class='exp_style' id='exp_algorithm~base'>[+]</span></a><span class='right_span'>19</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~base')) document.getElementById('aexp_algorithm~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~dp/?opendiv=algorithm'>dp</a><a href='##' onmousedown=showDiv('algorithm~dp') id='aexp_algorithm~dp'><span class='exp_style' id='exp_algorithm~dp'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~dp')) document.getElementById('aexp_algorithm~dp').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~ds/?opendiv=algorithm'>ds</a><a href='##' onmousedown=showDiv('algorithm~ds') id='aexp_algorithm~ds'><span class='exp_style' id='exp_algorithm~ds'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~ds')) document.getElementById('aexp_algorithm~ds').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~tc/?opendiv=algorithm'>tc</a><a href='##' onmousedown=showDiv('algorithm~tc') id='aexp_algorithm~tc'><span class='exp_style' id='exp_algorithm~tc'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm')) document.getElementById('aexp_algorithm').style.visibility = 'hidden';
if (!document.getElementById('algorithm~tc')) document.getElementById('aexp_algorithm~tc').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/blog/'>blog</a><a href='##' onmousedown=showDiv('blog') id='aexp_blog'><span class='exp_style' id='exp_blog'>[+]</span></a><span class='right_span'>(11)</span></li>
<div id='blog' class='catsub'><li><a href='/blog/cats/blog~hello/?opendiv=blog'>hello</a><a href='##' onmousedown=showDiv('blog~hello') id='aexp_blog~hello'><span class='exp_style' id='exp_blog~hello'>[+]</span></a><span class='right_span'>1</span></li>
<div id='blog~hello' class='catsub2'><li><a href='/blog/cats/blog~hello~hi/?opendiv=blog~hello'>hi</a><span class='right_span'>1</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~hello')) document.getElementById('aexp_blog~hello').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~jekyll/?opendiv=blog'>jekyll</a><a href='##' onmousedown=showDiv('blog~jekyll') id='aexp_blog~jekyll'><span class='exp_style' id='exp_blog~jekyll'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~jekyll')) document.getElementById('aexp_blog~jekyll').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~markdown/?opendiv=blog'>markdown</a><a href='##' onmousedown=showDiv('blog~markdown') id='aexp_blog~markdown'><span class='exp_style' id='exp_blog~markdown'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~markdown')) document.getElementById('aexp_blog~markdown').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~octopress/?opendiv=blog'>octopress</a><a href='##' onmousedown=showDiv('blog~octopress') id='aexp_blog~octopress'><span class='exp_style' id='exp_blog~octopress'>[+]</span></a><span class='right_span'>5</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~octopress')) document.getElementById('aexp_blog~octopress').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~ruby/?opendiv=blog'>ruby</a><a href='##' onmousedown=showDiv('blog~ruby') id='aexp_blog~ruby'><span class='exp_style' id='exp_blog~ruby'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('blog')) document.getElementById('aexp_blog').style.visibility = 'hidden';
if (!document.getElementById('blog~ruby')) document.getElementById('aexp_blog~ruby').style.visibility = 'hidden';
</script>

</ul>
</div>
</body>
</html>
</section>

<section>
<h1>Date Categories</h1>
<head>
</head>
<body>
<div id="menu">
<ul>
<li class='catclass'><a href='/blog/cats/2015/'>2015</a><a href='##' onmousedown=showDiv('2015')><span class='exp_style' id='exp_2015'>[+]</span></a><span class='right_span'>(120)</span></li>
<div id='2015' class='catsub'><li><a href='/blog/cats/2015~07/?opendiv=2015'>2015-07</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2015~06/?opendiv=2015'>2015-06</a><span class='right_span'>24</span></li>
<li><a href='/blog/cats/2015~05/?opendiv=2015'>2015-05</a><span class='right_span'>22</span></li>
<li><a href='/blog/cats/2015~04/?opendiv=2015'>2015-04</a><span class='right_span'>23</span></li>
<li><a href='/blog/cats/2015~03/?opendiv=2015'>2015-03</a><span class='right_span'>19</span></li>
<li><a href='/blog/cats/2015~02/?opendiv=2015'>2015-02</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2015~01/?opendiv=2015'>2015-01</a><span class='right_span'>19</span></li>
</div><li class='catclass'><a href='/blog/cats/2014/'>2014</a><a href='##' onmousedown=showDiv('2014')><span class='exp_style' id='exp_2014'>[+]</span></a><span class='right_span'>(112)</span></li>
<div id='2014' class='catsub'><li><a href='/blog/cats/2014~12/?opendiv=2014'>2014-12</a><span class='right_span'>21</span></li>
<li><a href='/blog/cats/2014~11/?opendiv=2014'>2014-11</a><span class='right_span'>19</span></li>
<li><a href='/blog/cats/2014~10/?opendiv=2014'>2014-10</a><span class='right_span'>13</span></li>
<li><a href='/blog/cats/2014~09/?opendiv=2014'>2014-09</a><span class='right_span'>7</span></li>
<li><a href='/blog/cats/2014~08/?opendiv=2014'>2014-08</a><span class='right_span'>15</span></li>
<li><a href='/blog/cats/2014~07/?opendiv=2014'>2014-07</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2014~06/?opendiv=2014'>2014-06</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2014~05/?opendiv=2014'>2014-05</a><span class='right_span'>7</span></li>
<li><a href='/blog/cats/2014~04/?opendiv=2014'>2014-04</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2014~03/?opendiv=2014'>2014-03</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2014~02/?opendiv=2014'>2014-02</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2014~01/?opendiv=2014'>2014-01</a><span class='right_span'>2</span></li>
</div><li class='catclass'><a href='/blog/cats/2013/'>2013</a><a href='##' onmousedown=showDiv('2013')><span class='exp_style' id='exp_2013'>[+]</span></a><span class='right_span'>(60)</span></li>
<div id='2013' class='catsub'><li><a href='/blog/cats/2013~12/?opendiv=2013'>2013-12</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~11/?opendiv=2013'>2013-11</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~10/?opendiv=2013'>2013-10</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~09/?opendiv=2013'>2013-09</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~08/?opendiv=2013'>2013-08</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~07/?opendiv=2013'>2013-07</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2013~06/?opendiv=2013'>2013-06</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2013~05/?opendiv=2013'>2013-05</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~03/?opendiv=2013'>2013-03</a><span class='right_span'>6</span></li>
<li><a href='/blog/cats/2013~02/?opendiv=2013'>2013-02</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2013~01/?opendiv=2013'>2013-01</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2012/'>2012</a><a href='##' onmousedown=showDiv('2012')><span class='exp_style' id='exp_2012'>[+]</span></a><span class='right_span'>(35)</span></li>
<div id='2012' class='catsub'><li><a href='/blog/cats/2012~12/?opendiv=2012'>2012-12</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2012~11/?opendiv=2012'>2012-11</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2012~10/?opendiv=2012'>2012-10</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2012~08/?opendiv=2012'>2012-08</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2012~05/?opendiv=2012'>2012-05</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2012~04/?opendiv=2012'>2012-04</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2012~03/?opendiv=2012'>2012-03</a><span class='right_span'>6</span></li>
<li><a href='/blog/cats/2012~02/?opendiv=2012'>2012-02</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2012~01/?opendiv=2012'>2012-01</a><span class='right_span'>2</span></li>
</div><li class='catclass'><a href='/blog/cats/2011/'>2011</a><a href='##' onmousedown=showDiv('2011')><span class='exp_style' id='exp_2011'>[+]</span></a><span class='right_span'>(35)</span></li>
<div id='2011' class='catsub'><li><a href='/blog/cats/2011~12/?opendiv=2011'>2011-12</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2011~11/?opendiv=2011'>2011-11</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2011~08/?opendiv=2011'>2011-08</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2011~07/?opendiv=2011'>2011-07</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2011~06/?opendiv=2011'>2011-06</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~05/?opendiv=2011'>2011-05</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~04/?opendiv=2011'>2011-04</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~03/?opendiv=2011'>2011-03</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2011~02/?opendiv=2011'>2011-02</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2011~01/?opendiv=2011'>2011-01</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2010/'>2010</a><a href='##' onmousedown=showDiv('2010')><span class='exp_style' id='exp_2010'>[+]</span></a><span class='right_span'>(1)</span></li>
<div id='2010' class='catsub'><li><a href='/blog/cats/2010~07/?opendiv=2010'>2010-07</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2009/'>2009</a><a href='##' onmousedown=showDiv('2009')><span class='exp_style' id='exp_2009'>[+]</span></a><span class='right_span'>(8)</span></li>
<div id='2009' class='catsub'><li><a href='/blog/cats/2009~12/?opendiv=2009'>2009-12</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2009~10/?opendiv=2009'>2009-10</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2009~09/?opendiv=2009'>2009-09</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2009~07/?opendiv=2009'>2009-07</a><span class='right_span'>1</span></li>
</div>
</ul>
</div>
</body>
</html>
</section>

<section>
<h1>Tags</h1>
<ul class="tag-cloud">
<a style="font-size: 131%" href="/tags/gdb/">gdb(6)</a>
<a style="font-size: 100%" href="/tags/hello/">hello(1)</a>
<a style="font-size: 150%" href="/tags/koj/">koj(18)</a>
<a style="font-size: 112%" href="/tags/nvidia/">nvidia(2)</a>
<a style="font-size: 100%" href="/tags/patch/">patch(1)</a>
<a style="font-size: 100%" href="/tags/reg-exp/">reg_exp(1)</a>

</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/02/debug-crash-kmem/">crash kmem</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/02/kernel-net-info/">查看所有tcp连接</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/18/android-bootloader/">Android系统典型bootloader分析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/18/kernel-net-ipv6-code/">IPV6 实现</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/12/kernel-net-tcp-close/">linux内核中tcp连接的断开处理</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub</h1>
  
  <a href="https://github.com/abcdxyzk">abcdxyzk on GitHub</a>
  
</section>

<section>
<h1>Links</h1>
<ul>
	<li>
		<a href=http://hi.baidu.com/abcdxyzk target=_blank>My blog</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/zhangskd target=_blank>zhangsk</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/justlinux2010 target=_blank>justlinux2010</a>
	</li>
	<li>
		<a href=http://simohayha.iteye.com/ target=_blank>simohayha</a>
	</li>
	<li>
		<a href=http://linux.chinaunix.net/techdoc/net/ target=_blank>技术文档</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/cybertan target=_blank>cybertan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/newnewman80 target=_blank>newnewman80</a>
	</li>
	<li>
		<a href=http://www.cppblog.com/fwxjj/ target=_blank>fwxjj</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/ustc_dylan target=_blank>ustc_dylan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/nkguohao target=_blank>nkguohao</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/yusiguyuan target=_blank>yusiguyuan</a>
	</li>
	<li>
		<a href=http://www.oenhan.com/ target=_blank>oenhan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/bullbat target=_blank>bullbat</a>
	</li>
	<li>
		<a href=http://www.wowotech.net/ target=_blank>wowotech</a>
	</li>
	<li>
		<a href=http://www.lenky.info/ target=_blank>lenky</a>
	</li>
</ul>
</section>

  
<section id="comment_sidebar">
<h1>Recent Comments</h1>

<script type="text/javascript" src="http://abcdxyzk.disqus.com/recent_comments_widget.js?num_items=5&hide_avatars=0&avatar_size=32&excerpt_length=20"></script><a href="http://disqus.com/">Powered by Disqus</a>

</section>


</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - kk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <a title="Top" href="#" id="scroll2top" style="position: fixed; height: 50px; bottom: 30px; right: 25px; cursor: pointer; z-index: 9999; display: block; opacity: 1;"><img src="/images/scrollup.png"></a>
  <script src="/javascripts/scroll2top.js"></script>
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253604690'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1253604690' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'abcdxyzk';
      
</script>





</body>
</html>
