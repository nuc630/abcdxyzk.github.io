
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>kk Blog —— 通用基础</title>

  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="kk Blog —— 通用基础" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script src="/javascripts/category.js" type="text/javascript"></script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">kk Blog —— 通用基础</a></h1>
  
    <h2>cp -rf * .</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
<li>
<form action="/search" method="get">
    <input class="search" name="query" id="query" type="text" placeholder="search...">
    <input id="btnSubmit" value="search" type="submit">
</form>
<script type="text/javascript">
var query = GetRequest("query");
if (query != null) {
	document.getElementById("query").value = query;
}
</script>
</li>
  <li><a href="/atom.xml" rel="subscribe-rss">RSS</a></li>
  
</ul>
  
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/download">Download</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/07/08/kernel-net-hook/">Netfilter HOOK</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-07-08T11:26:00+08:00'><span class='date'>2013-07-08</span> <span class='time'>11:26:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>下图是Netfilter的IPV4下的结构</p>

<p><img src="/images/kernel/2013-07-08.jpg" alt="" /></p>

<p>可以看到这是基于早期版本内核的，如今内核挂载点的宏定义发生了变化，从NF_IP_XXX => NF_INET_XXX</p>

<p>每个注册的钩子函数经过处理后都将返回下列值之一，告知Netfilter核心代码处理结果，以便对报文采取相应的动作：<br/>
NF_ACCEPT：继续正常的报文处理；<br/>
NF_DROP：将报文丢弃；<br/>
NF_STOLEN：由钩子函数处理了该报文，不要再继续传送；<br/>
NF_QUEUE：将报文入队，通常交由用户程序处理；<br/>
NF_REPEAT：再次调用该钩子函数。</p>

<p>// code</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;linux/module.h&gt;
</span><span class='line'>#include &lt;linux/init.h&gt;
</span><span class='line'>#include &lt;linux/kernel.h&gt;
</span><span class='line'>#include &lt;linux/net.h&gt;
</span><span class='line'>#include &lt;net/tcp.h&gt;
</span><span class='line'>#include &lt;linux/skbuff.h&gt;
</span><span class='line'>#include &lt;linux/netfilter.h&gt;
</span><span class='line'>#include &lt;linux/netfilter_ipv4.h&gt;
</span><span class='line'>#include &lt;net/ip_vs.h&gt;
</span><span class='line'>#include &lt;net/sock.h&gt;
</span><span class='line'>#include &lt;linux/gfp.h&gt;
</span><span class='line'>#include &lt;linux/kallsyms.h&gt;
</span><span class='line'>#include &lt;linux/version.h&gt;
</span><span class='line'>
</span><span class='line'>static unsigned int test_runit(unsigned int hooknum,
</span><span class='line'>#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 6, 32)
</span><span class='line'>&#9;&#9;truct sk_buff **skb,
</span><span class='line'>#else
</span><span class='line'>&#9;&#9;struct sk_buff *skb,
</span><span class='line'>#endif
</span><span class='line'>&#9;&#9;const struct net_device *in,
</span><span class='line'>&#9;&#9;const struct net_device *out,
</span><span class='line'>&#9;&#9;int (*okfn)(struct sk_buff *))
</span><span class='line'>{
</span><span class='line'>&#9;...
</span><span class='line'>&#9;return NF_ACCEPT;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>static struct nf_hook_ops hook_test = {
</span><span class='line'>&#9;.hook    = test_runit,
</span><span class='line'>&#9;.owner    = THIS_MODULE,
</span><span class='line'>&#9;.pf    = PF_INET,
</span><span class='line'>#if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 6, 32)
</span><span class='line'>&#9;.hooknum        = NF_IP_LOCAL_OUT,
</span><span class='line'>#else
</span><span class='line'>&#9;.hooknum        = NF_INET_LOCAL_OUT,
</span><span class='line'>#endif
</span><span class='line'>&#9;.priority       = 100,
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>static int  __init test_start_init(void)
</span><span class='line'>{
</span><span class='line'>&#9;printk("Hi test pre\n");
</span><span class='line'>&#9;nf_register_hook(&hook_test);
</span><span class='line'>&#9;return 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>static void __exit test_start_exit(void)
</span><span class='line'>{
</span><span class='line'>&#9;nf_unregister_hook(&hook_test);
</span><span class='line'>&#9;printk("Bye test pre\n");
</span><span class='line'>}
</span><span class='line'>module_init(test_start_init);
</span><span class='line'>module_exit(test_start_exit);
</span><span class='line'>MODULE_LICENSE("GPL");</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/07/05/kernel-sample/">数据交换sysctl + 定时器（code）</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-07-05T15:35:00+08:00'><span class='date'>2013-07-05</span> <span class='time'>15:35:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;linux/module.h&gt;
</span><span class='line'>#include &lt;linux/kernel.h&gt;
</span><span class='line'>#include &lt;linux/init.h&gt;
</span><span class='line'>#include &lt;linux/types.h&gt;
</span><span class='line'>
</span><span class='line'>#include &lt;linux/sysctl.h&gt;
</span><span class='line'>#include &lt;linux/timer.h&gt;
</span><span class='line'>
</span><span class='line'>int value;
</span><span class='line'>
</span><span class='line'>static struct ctl_table debug_table[] = {
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;.ctl_name       = CTL_UNNUMBERED,
</span><span class='line'>&#9;&#9;.procname       = "value",
</span><span class='line'>&#9;&#9;.data           = &value,
</span><span class='line'>&#9;&#9;.maxlen         = sizeof(value),
</span><span class='line'>&#9;&#9;.mode           = 0644,
</span><span class='line'>&#9;&#9;.proc_handler   = &proc_dointvec, },
</span><span class='line'>&#9;{ },
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>static struct ctl_table ws_dir_table[] = {
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;.ctl_name       = CTL_UNNUMBERED,
</span><span class='line'>&#9;&#9;.procname        = "debug",
</span><span class='line'>&#9;&#9;.mode            = 0555,
</span><span class='line'>&#9;&#9;.child           = debug_table, },
</span><span class='line'>&#9;{ },
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>static struct ctl_table ipv4_dir_table[] = {
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;.ctl_name       = NET_IPV4,
</span><span class='line'>&#9;&#9;.procname    = "ipv4",
</span><span class='line'>&#9;&#9;.mode        = 0555,
</span><span class='line'>&#9;&#9;.child       = ws_dir_table, },
</span><span class='line'>&#9;{ },
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>static ctl_table net_dir_table[] = {
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;.ctl_name       = CTL_NET,
</span><span class='line'>&#9;&#9;.procname    = "net",
</span><span class='line'>&#9;&#9;.mode        = 0555,
</span><span class='line'>&#9;&#9;.child           = ipv4_dir_table, },
</span><span class='line'>&#9;{ },
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>struct timer_list timer_last_stat;
</span><span class='line'>static void output_value(unsigned long data)
</span><span class='line'>{
</span><span class='line'>&#9;printk("value = %d\n", value);
</span><span class='line'>&#9;mod_timer(&timer_last_stat, jiffies+HZ*5);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>struct ctl_table_header *ctl_header = NULL;
</span><span class='line'>static int __init file_test_init(void)
</span><span class='line'>{
</span><span class='line'>&#9;printk("sysctl test init\n");
</span><span class='line'>&#9;value = 111;
</span><span class='line'>&#9;ctl_header= register_sysctl_table (net_dir_table, 0);
</span><span class='line'>&#9;if(!ctl_header){
</span><span class='line'>&#9;&#9;printk(KERN_ERR"SYNPROXY: sp_sysctl_init() calls failed.");
</span><span class='line'>&#9;&#9;return -1;
</span><span class='line'>&#9;}
</span><span class='line'>&#9;setup_timer(&timer_last_stat, output_value, 0);
</span><span class='line'>&#9;mod_timer(&timer_last_stat, jiffies+HZ*5);
</span><span class='line'>&#9;return 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>static void __exit file_test_exit(void)
</span><span class='line'>{
</span><span class='line'>&#9;if (ctl_header)
</span><span class='line'>&#9;&#9;unregister_sysctl_table(ctl_header);
</span><span class='line'>&#9;del_timer(&timer_last_stat);
</span><span class='line'>&#9;printk("sysctl test exit\n");
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>module_init(file_test_init);
</span><span class='line'>module_exit(file_test_exit);
</span><span class='line'>
</span><span class='line'>MODULE_LICENSE("GPL");</span></code></pre></td></tr></table></div></figure>


<hr />

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ dmesg
</span><span class='line'>...
</span><span class='line'>value = 111
</span><span class='line'>$ echo 123 &gt; /proc/sys/net/ipv4/debug/value
</span><span class='line'>$ dmesg
</span><span class='line'>...
</span><span class='line'>value = 111
</span><span class='line'>value = 123</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/07/01/kernel-timer/">内核定时器的使用</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-07-01T09:46:00+08:00'><span class='date'>2013-07-01</span> <span class='time'>09:46:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>LINUX内核定时器是内核用来控制在未来某个时间点（基于jiffies）调度执行某个函数的一种机制，其实现位于 &lt;linux/timer.h> 和 kernel/timer.c 文件中。</p>

<p>被调度的函数肯定是异步执行的，它类似于一种“软件中断”，而且是处于非进程的上下文中，所以调度函数必须遵守以下规则：<br/>
1. 没有 current 指针、不允许访问用户空间。因为没有进程上下文，相关代码和被中断的进程没有任何联系。<br/>
2. 不能执行休眠（或可能引起休眠的函数）和调度。<br/>
3. 任何被访问的数据结构都应该针对并发访问进行保护，以防止竞争条件。</p>

<p>内核定时器的调度函数运行过一次后就不会再被运行了（相当于自动注销），但可以通过在被调度的函数中重新调度自己来周期运行。</p>

<p>在SMP系统中，调度函数总是在注册它的同一CPU上运行，以尽可能获得缓存的局域性。</p>

<h4>定时器API</h4>

<p>内核定时器的数据结构</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>struct timer_list {
</span><span class='line'>  struct list_head entry;
</span><span class='line'> 
</span><span class='line'>  unsigned long expires;
</span><span class='line'>  void (*function)(unsigned long);
</span><span class='line'>  unsigned long data;
</span><span class='line'> 
</span><span class='line'>  struct tvec_base *base;
</span><span class='line'>  /* ... */
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure>


<p>其中 expires 字段表示期望定时器执行的 jiffies 值，到达该 jiffies 值时，将调用 function 函数，并传递  data 作为参数。当一个定时器被注册到内核之后，entry 字段用来连接该定时器到一个内核链表中。base 字段是内核内部实现所用的。
需要注意的是 expires 的值是32位的，因为内核定时器并不适用于长的未来时间点。</p>

<h5>初始化</h5>

<p>在使用 struct timer_list 之前，需要初始化该数据结构，确保所有的字段都被正确地设置。初始化有两种方法。</p>

<h5>方法一：</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DEFINE_TIMER(timer_name, function_name, expires_value, data);</span></code></pre></td></tr></table></div></figure>


<p>该宏会静态创建一个名叫 timer_name 内核定时器，并初始化其 function, expires, name 和 base 字段。</p>

<h5>方法二：</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>struct timer_list mytimer;
</span><span class='line'>setup_timer(&mytimer, (*function)(unsigned long), unsigned long data);
</span><span class='line'>mytimer.expires = jiffies + 5*HZ;</span></code></pre></td></tr></table></div></figure>


<h5>方法三：</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>struct timer_list mytimer;
</span><span class='line'>init_timer(&mytimer);
</span><span class='line'>  mytimer -&gt;timer.expires = jiffies + 5*HZ;
</span><span class='line'>  mytimer -&gt;timer.data = (unsigned long) dev;
</span><span class='line'>  mytimer -&gt;timer.function = &corkscrew_timer; /* timer handler */</span></code></pre></td></tr></table></div></figure>


<p>通过init_timer()动态地定义一个定时器，此后，将处理函数的地址和参数绑定给一个timer_list，<br/>
注意，无论用哪种方法初始化，其本质都只是给字段赋值，所以只要在运行 add_timer() 之前，expires, function 和 data 字段都可以直接再修改。<br/>
关于上面这些宏和函数的定义，参见 include/linux/timer.h。</p>

<h5>注册</h5>

<p>定时器要生效，还必须被连接到内核专门的链表中，这可以通过 add_timer(struct timer_list *timer) 来实现。</p>

<h5>重新注册</h5>

<p>要修改一个定时器的调度时间，可以通过调用 mod_timer(struct timer_list *timer, unsigned long expires)。mod_timer() 会重新注册定时器到内核，而不管定时器函数是否被运行过。</p>

<h5>注销</h5>

<p>注销一个定时器，可以通过 del_timer(struct timer_list <em>timer) 或  del_timer_sync(struct timer_list </em>timer)。其中 del_timer_sync 是用在 SMP  系统上的（在非SMP系统上，它等于del_timer），当要被注销的定时器函数正在另一个 cpu 上运行时，del_timer_sync()  会等待其运行完，所以这个函数会休眠。另外还应避免它和被调度的函数争用同一个锁。对于一个已经被运行过且没有重新注册自己的定时器而言，注销函数其实也 没什么事可做。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>int timer_pending(const struct timer_list *timer)</span></code></pre></td></tr></table></div></figure>


<p>这个函数用来判断一个定时器是否被添加到了内核链表中以等待被调度运行。注意，当一个定时器函数即将要被运行前，内核会把相应的定时器从内核链表中删除（相当于注销）</p>

<h5>例子1：</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;linux/module.h&gt;
</span><span class='line'>#include &lt;linux/timer.h&gt;
</span><span class='line'>#include &lt;linux/jiffies.h&gt;
</span><span class='line'> 
</span><span class='line'>struct timer_list mytimer;
</span><span class='line'>static void myfunc(unsigned long data)
</span><span class='line'>{
</span><span class='line'>&#9;printk("%s/n", (char *)data);
</span><span class='line'>&#9;mod_timer(&mytimer, jiffies + 2*HZ);
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>static int __init mytimer_init(void)
</span><span class='line'>{
</span><span class='line'>&#9;setup_timer(&mytimer, myfunc, (unsigned long)"Hello, world!");
</span><span class='line'>&#9;mytimer.expires = jiffies + HZ;
</span><span class='line'>&#9;add_timer(&mytimer);
</span><span class='line'>&#9;return 0;
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>static void __exit mytimer_exit(void)
</span><span class='line'>{
</span><span class='line'>&#9;del_timer(&mytimer);
</span><span class='line'>}
</span><span class='line'>module_init(mytimer_init);
</span><span class='line'>module_exit(mytimer_exit);</span></code></pre></td></tr></table></div></figure>


<h5>例子2：</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>static struct timer_list power_button_poll_timer;
</span><span class='line'>static void power_button_poll(unsigned long dummy)
</span><span class='line'>{
</span><span class='line'>&#9;if (gpio_line_get(N2100_POWER_BUTTON) == 0) {
</span><span class='line'>&#9;&#9;ctrl_alt_del();
</span><span class='line'>&#9;&#9;return;
</span><span class='line'>&#9;}
</span><span class='line'>&#9;power_button_poll_timer.expires = jiffies + (HZ / 10);
</span><span class='line'>&#9;add_timer(&power_button_poll_timer);
</span><span class='line'>}
</span><span class='line'>static void __init n2100_init_machine(void)
</span><span class='line'>{
</span><span class='line'>...
</span><span class='line'>&#9;init_timer(&power_button_poll_timer);
</span><span class='line'>&#9;power_button_poll_timer.function = power_button_poll;
</span><span class='line'>&#9;power_button_poll_timer.expires = jiffies + (HZ / 10);
</span><span class='line'>&#9;add_timer(&power_button_poll_timer);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h5>例子3：</h5>

<p>设备open时初始化和注册定时器</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>static int corkscrew_open(struct net_device *dev)
</span><span class='line'>{
</span><span class='line'>...
</span><span class='line'>&#9;  init_timer(&vp-&gt;timer);    
</span><span class='line'>&#9;  vp-&gt;timer.expires = jiffies + media_tbl[dev-&gt;if_port].wait;
</span><span class='line'>&#9;  vp-&gt;timer.data = (unsigned long) dev;
</span><span class='line'>&#9;  vp-&gt;timer.function = &corkscrew_timer; /* timer handler */
</span><span class='line'>&#9;  add_timer(&vp-&gt;timer);
</span><span class='line'>...
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>定时器超时处理函数，对定时器的超时时间重新赋值</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>static void corkscrew_timer(unsigned long data)
</span><span class='line'>{
</span><span class='line'>...
</span><span class='line'>&#9;vp-&gt;timer.expires = jiffies + media_tbl[dev-&gt;if_port].wait;
</span><span class='line'>&#9;add_timer(&vp-&gt;timer);
</span><span class='line'>...
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>设备close时删除定时器
</span><span class='line'>static int corkscrew_close(struct net_device *dev)
</span><span class='line'>{
</span><span class='line'>...
</span><span class='line'>&#9;del_timer(&vp-&gt;timer);
</span><span class='line'>...
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h5>例子4：</h5>

<p>本例子用DEFINE_TIMER静态创建定时器</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#include &lt;linux/module.h&gt;
</span><span class='line'>#include &lt;linux/jiffies.h&gt;
</span><span class='line'>#include &lt;linux/kernel.h&gt;
</span><span class='line'>#include &lt;linux/init.h&gt;
</span><span class='line'>#include &lt;linux/timer.h&gt;
</span><span class='line'>#include &lt;linux/leds.h&gt;
</span><span class='line'>static void ledtrig_ide_timerfunc(unsigned long data);
</span><span class='line'>DEFINE_LED_TRIGGER(ledtrig_ide);
</span><span class='line'>static DEFINE_TIMER(ledtrig_ide_timer, ledtrig_ide_timerfunc, 0, 0);
</span><span class='line'>static int ide_activity;
</span><span class='line'>static int ide_lastactivity;
</span><span class='line'>void ledtrig_ide_activity(void)
</span><span class='line'>{
</span><span class='line'>&#9;ide_activity++;
</span><span class='line'>&#9;if (!timer_pending(&ledtrig_ide_timer))
</span><span class='line'>&#9;&#9;mod_timer(&ledtrig_ide_timer, jiffies + msecs_to_jiffies(10));
</span><span class='line'>}
</span><span class='line'>EXPORT_SYMBOL(ledtrig_ide_activity);
</span><span class='line'>static void ledtrig_ide_timerfunc(unsigned long data)
</span><span class='line'>{
</span><span class='line'>&#9;if (ide_lastactivity != ide_activity) {
</span><span class='line'>&#9;&#9;ide_lastactivity = ide_activity;
</span><span class='line'>&#9;&#9;led_trigger_event(ledtrig_ide, LED_FULL);
</span><span class='line'>&#9;&#9;mod_timer(&ledtrig_ide_timer, jiffies + msecs_to_jiffies(10));
</span><span class='line'>&#9;} else {
</span><span class='line'>&#9;&#9;led_trigger_event(ledtrig_ide, LED_OFF);
</span><span class='line'>&#9;}
</span><span class='line'>}
</span><span class='line'>static int __init ledtrig_ide_init(void)
</span><span class='line'>{
</span><span class='line'>&#9;led_trigger_register_simple("ide-disk", &ledtrig_ide);
</span><span class='line'>&#9;return 0;
</span><span class='line'>}
</span><span class='line'>static void __exit ledtrig_ide_exit(void)
</span><span class='line'>{
</span><span class='line'>&#9;led_trigger_unregister_simple(ledtrig_ide);
</span><span class='line'>}
</span><span class='line'>module_init(ledtrig_ide_init);
</span><span class='line'>module_exit(ledtrig_ide_exit);</span></code></pre></td></tr></table></div></figure>


<hr />

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>add_timer() -- 将定时器添加到定时器等待队列中
</span><span class='line'>用add_timer()函数来看timer_base的作用
</span><span class='line'>static inline void add_timer(struct timer_list *timer)
</span><span class='line'>{
</span><span class='line'>&#9;BUG_ON(timer_pending(timer));
</span><span class='line'>&#9;__mod_timer(timer, timer-&gt;expires);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>int __mod_timer(struct timer_list *timer, unsigned long expires)
</span><span class='line'>{
</span><span class='line'>&#9;tvec_base_t *base, *new_base;
</span><span class='line'>&#9;unsigned long flags;
</span><span class='line'>&#9;int ret = 0;
</span><span class='line'>&#9;timer_stats_timer_set_start_info(timer);
</span><span class='line'>&#9;BUG_ON(!timer-&gt;function);
</span><span class='line'>&#9;base = lock_timer_base(timer, &flags);
</span><span class='line'>如果timer已经放到定时链表中,则释放开
</span><span class='line'>|--------------------------------|
</span><span class='line'>|   if (timer_pending(timer)) { -|
</span><span class='line'>|       detach_timer(timer, 0); -|
</span><span class='line'>|       ret = 1;                 |
</span><span class='line'>|   }                            |
</span><span class='line'>|--------------------------------|
</span><span class='line'>获取当前CPU的timer base
</span><span class='line'>|-----------------------------------------|
</span><span class='line'>|   new_base = __get_cpu_var(tvec_bases); |
</span><span class='line'>|-----------------------------------------|
</span><span class='line'>如果当前CPU的timer base不是当前timer中的base, 更新timer的base
</span><span class='line'>|----------------------------------------------------|
</span><span class='line'>|   if (base != new_base) {                          |
</span><span class='line'>|       if (likely(base-&gt;running_timer != timer)) { -|
</span><span class='line'>|           timer-&gt;base = NULL;                      |
</span><span class='line'>|           spin_unlock(&base-&gt;lock);                |
</span><span class='line'>|           base = new_base;                         |
</span><span class='line'>|           spin_lock(&base-&gt;lock);                  |
</span><span class='line'>|           timer-&gt;base = base;                      |
</span><span class='line'>|       }                                            |
</span><span class='line'>|   }                                                |
</span><span class='line'>|----------------------------------------------------|
</span><span class='line'>给定时器timer设置超时时间；并添加该时钟
</span><span class='line'>|-------------------------------------|
</span><span class='line'>|   timer-&gt;expires = expires;         |
</span><span class='line'>|   internal_add_timer(base, timer); -|
</span><span class='line'>|-------------------------------------|
</span><span class='line'>&#9;spin_unlock_irqrestore(&base-&gt;lock, flags);
</span><span class='line'>&#9;return ret;
</span><span class='line'>}
</span><span class='line'>MODULE_LICENSE("GPL");</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/06/27/kernel-sysctl/">用户空间和内核空间数据交换方式-sysctl</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-06-27T17:20:00+08:00'><span class='date'>2013-06-27</span> <span class='time'>17:20:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>  sysctl是一种用户应用来设置和获得运行时内核的配置参数的一种有效方式，通过这种 方式，用户应用可以在内核运行的任何时刻来改变内核的配置参数，也可以在任何时候获得内核的配置参数，通常，内核的这些配置参数也出现在proc文件系统 的/proc/sys目录下，用户应用可以直接通过这个目录下的文件来实现内核配置的读写操作，例如，用户可以通过</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cat /proc/sys/net/ipv4/ip_forward </span></code></pre></td></tr></table></div></figure>


<p>来得知内核IP层是否允许转发IP包，用户可以通过</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo 1 &gt; /proc/sys/net/ipv4/ip_forward </span></code></pre></td></tr></table></div></figure>


<p>  把内核 IP 层设置为允许转发 IP 包，即把该机器配置成一个路由器或网关。 一般地，所有的 Linux 发布也提供了一个系统工具  sysctl，它可以设置和读取内核的配置参数，但是该工具依赖于 proc 文件系统，为了使用该工具，内核必须支持 proc 文件系统。下面是使用  sysctl 工具来获取和设置内核配置参数的例子：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># sysctl net.ipv4.ip_forward
</span><span class='line'>net.ipv4.ip_forward = 0
</span><span class='line'># sysctl -w net.ipv4.ip_forward=1
</span><span class='line'>net.ipv4.ip_forward = 1
</span><span class='line'># sysctl net.ipv4.ip_forward
</span><span class='line'>net.ipv4.ip_forward = 1 </span></code></pre></td></tr></table></div></figure>


<p>  注意，参数 net.ipv4.ip_forward 实际被转换到对应的 proc  文件/proc/sys/net/ipv4/ip_forward，选项 -w 表示设置该内核配置参数，没有选项表示读内核配置参数，用户可以使用  sysctl -a 来读取所有的内核配置参数，对应更多的 sysctl 工具的信息，请参考手册页 sysctl(8)。</p>

<p>  但是 proc 文件系统对 sysctl 不是必须的，在没有 proc 文件系统的情况下，仍然可以，这时需要使用内核提供的系统调用 sysctl 来实现对内核配置参数的设置和读取。</p>

<p>  在源代码中给出了一个实际例子程序，它说明了如何在内核和用户态使用sysctl。头文件 sysctl-exam.h 定义了 sysctl  条目 ID，用户态应用和内核模块需要这些 ID 来操作和注册 sysctl 条目。内核模块在文件 sysctl-exam-kern.c  中实现，在该内核模块中，每一个 sysctl 条目对应一个 struct ctl_table 结构，该结构定义了要注册的 sysctl 条目的  ID(字段 ctl_name)，在 proc  下的名称（字段procname），对应的内核变量（字段data，注意该该字段的赋值必须是指针），条目允许的最大长度（字段maxlen，它主要用于 字符串内核变量，以便在对该条目设置时，对超过该最大长度的字符串截掉后面超长的部分），条目在proc文件系统下的访问权限（字段mode），在通过  proc设置时的处理函数（字段proc_handler，对于整型内核变量，应当设置为&amp;proc_dointvec，而对于字符串内核变量， 则设置为 &amp;proc_dostring），字符串处理策略（字段strategy，一般这是为&amp;sysctl_string）。</p>

<p>  sysctl 条目可以是目录，此时 mode 字段应当设置为 0555，否则通过 sysctl 系统调用将无法访问它下面的 sysctl  条目，child 则指向该目录条目下面的所有条目，对于在同一目录下的多个条目，不必一一注册，用户可以把它们组织成一个 struct  ctl_table 类型的数组，然后一次注册就可以，但此时必须把数组的最后一个结构设置为NULL，即</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>&#9;.ctl_name = 0
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>  注册sysctl条目使用函数register_sysctl_table(struct ctl_table *,  int)，第一个参数为定义的struct  ctl_table结构的sysctl条目或条目数组指针，第二个参数为插入到sysctl条目表中的位置，如果插入到末尾，应当为0，如果插入到开头， 则为非0。内核把所有的sysctl条目都组织成sysctl表。</p>

<p>  当模块卸载时，需要使用函数unregister_sysctl_table(struct ctl_table_header  *)解注册通过函数register_sysctl_table注册的sysctl条目，函数register_sysctl_table在调用成功时返  回结构struct ctl_table_header，它就是sysctl表的表头，解注册函数使用它来卸载相应的sysctl条目。  用户态应用sysctl-exam-user.c通过sysctl系统调用来查看和设置前面内核模块注册的sysctl条目（当然如果用户的系统内核已经 支持proc文件系统，可以直接使用文件操作应用如cat, echo等直接查看和设置这些sysctl条目）。</p>

<h5>下面是运行该模块与应用的输出结果示例：</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># insmod ./sysctl-exam-kern.ko
</span><span class='line'># cat /proc/sys/mysysctl/myint
</span><span class='line'>0
</span><span class='line'># cat /proc/sys/mysysctl/mystring
</span><span class='line'># ./sysctl-exam-user
</span><span class='line'>mysysctl.myint =0
</span><span class='line'>mysysctl.mystring =""
</span><span class='line'># ./sysctl-exam-user 100"Hello, World"
</span><span class='line'>old value: mysysctl.myint =0
</span><span class='line'>newvalue: mysysctl.myint =100
</span><span class='line'>old vale: mysysctl.mystring =""
</span><span class='line'>newvalue: mysysctl.mystring ="Hello, World"
</span><span class='line'># cat /proc/sys/mysysctl/myint
</span><span class='line'>100
</span><span class='line'># cat /proc/sys/mysysctl/mystring
</span><span class='line'>Hello, World
</span><span class='line'>#</span></code></pre></td></tr></table></div></figure>


<hr />

<p>struct ctl_table是相关的主要的数据结构。定义如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>struct ctl_table
</span><span class='line'>{
</span><span class='line'>&#9;int ctl_name;            /* Binary ID */
</span><span class='line'>&#9;const char *procname;        /* Text ID for /proc/sys, or zero */
</span><span class='line'>&#9;void *data;
</span><span class='line'>&#9;int maxlen;
</span><span class='line'>&#9;mode_t mode;
</span><span class='line'>&#9;struct ctl_table *child;
</span><span class='line'>&#9;struct ctl_table *parent;    /* Automatically set */
</span><span class='line'>&#9;proc_handler *proc_handler;    /* Callback for text formatting */
</span><span class='line'>&#9;ctl_handler *strategy;        /* Callback function for all r/w */
</span><span class='line'>&#9;void *extra1;
</span><span class='line'>&#9;void *extra2;
</span><span class='line'>};</span></code></pre></td></tr></table></div></figure>


<p>每个这样的数据结构，都对应了/proc/sys目录下的一项内核参数。</p>

<p>其中各字段的意义如下：<br/>
  ctl_name: 唯一标识此表项的一个整数。<br/>
  proc_name: 相对于/proc/sys目录下对应的参数名称。<br/>
  data: 一个void *指针，指向与这个表项相关联的数据的指针。<br/>
  maxlen: 可以读取或者写入data的最大字节数。eg：data指向的是一个int型参数，则maxlen一般为sizeof(int)。<br/>
  mode: 文件的权限。<br/>
  child: 如果此数据结构对应的表项为一目录，则chind是指向其子表项的指针。<br/>
  parent: 同child，指向其所在目录对应的ctl_table。<br/>
  proc_handler: 如果是通过/proc/sys文件读写内核运行时的参数，则执行此操作。<br/>
  strategy: 如果是通过系统调用sysctl对内核参数进行读写，则调用此函数。<br/>
  extra1和extra2可以指向处理这个表项时的任何补充数据。</p>

<p>下面分别简单说下这两个函数大概的执行流程：<br/>
proc_handler:<br/>
一般情况下，proc_handler指向proc_dostring（操作数为string）或者proc_dointvec（操作数为int）。</p>

<p>strategy:<br/>
sysctl ==> sys_sysctl ==> do_sysctl ==> parse_table ==> do_sysctl_strategy ==> ctl_table中strategy对应的操作。</p>

<hr />

<h5>示例：</h5>

<p>头文件：sysctl-exam.h：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//header: sysctl-exam.h
</span><span class='line'>#ifndef _SYSCTL_EXAM_H
</span><span class='line'>#define _SYSCTL_EXAM_H
</span><span class='line'>#include &lt;linux/sysctl.h&gt;
</span><span class='line'>#define MY_ROOT (CTL_CPU + 10)
</span><span class='line'>#define MY_MAX_SIZE 256
</span><span class='line'>enum {
</span><span class='line'>&#9;MY_INT_EXAM = 1,
</span><span class='line'>&#9;MY_STRING_EXAM = 2,
</span><span class='line'>};
</span><span class='line'>#endif</span></code></pre></td></tr></table></div></figure>


<p>内核模块代码  sysctl-exam-kern.c：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//kernel module: sysctl-exam-kern.c
</span><span class='line'>#include &lt;linux/kernel.h&gt;
</span><span class='line'>#include &lt;linux/module.h&gt;
</span><span class='line'>#include &lt;linux/sysctl.h&gt;
</span><span class='line'>#include "sysctl-exam.h"
</span><span class='line'>
</span><span class='line'>static char mystring[256];
</span><span class='line'>static int myint;
</span><span class='line'>
</span><span class='line'>static struct ctl_table my_sysctl_exam[] = {
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;.ctl_name       = MY_INT_EXAM,
</span><span class='line'>&#9;&#9;.procname       = "myint",
</span><span class='line'>&#9;&#9;.data           = &myint,
</span><span class='line'>&#9;&#9;.maxlen         = sizeof(int),
</span><span class='line'>&#9;&#9;.mode           = 0666,
</span><span class='line'>&#9;&#9;.proc_handler   = &proc_dointvec,
</span><span class='line'>&#9;},
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;.ctl_name       = MY_STRING_EXAM,
</span><span class='line'>&#9;&#9;.procname       = "mystring",
</span><span class='line'>&#9;&#9;.data           = mystring,
</span><span class='line'>&#9;&#9;.maxlen         = MY_MAX_SIZE,
</span><span class='line'>&#9;&#9;.mode           = 0666,
</span><span class='line'>&#9;&#9;.proc_handler   = &proc_dostring,
</span><span class='line'>&#9;&#9;.strategy       = &sysctl_string,
</span><span class='line'>&#9;}，
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;.ctl_name = 0
</span><span class='line'>&#9;}
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>static struct ctl_table my_root = {
</span><span class='line'>&#9;.ctl_name       = MY_ROOT,
</span><span class='line'>&#9;.procname       = "mysysctl",
</span><span class='line'>&#9;.mode           = 0555,
</span><span class='line'>&#9;.child          = my_sysctl_exam,
</span><span class='line'>};
</span><span class='line'>
</span><span class='line'>static struct ctl_table_header * my_ctl_header;
</span><span class='line'>
</span><span class='line'>static int __init sysctl_exam_init(void)
</span><span class='line'>{
</span><span class='line'>&#9;my_ctl_header = register_sysctl_table(&my_root, 0);
</span><span class='line'>
</span><span class='line'>&#9;return 0;
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>static void __exit sysctl_exam_exit(void)
</span><span class='line'>{
</span><span class='line'>&#9;unregister_sysctl_table(my_ctl_header);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>module_init(sysctl_exam_init);
</span><span class='line'>module_exit(sysctl_exam_exit);
</span><span class='line'>MODULE_LICENSE("GPL");</span></code></pre></td></tr></table></div></figure>


<p>用户程序 sysctl-exam-user.c：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//application: sysctl-exam-user.c
</span><span class='line'>#include &lt;linux/unistd.h&gt;
</span><span class='line'>#include &lt;linux/types.h&gt;
</span><span class='line'>#include &lt;linux/sysctl.h&gt;
</span><span class='line'>#include "sysctl-exam.h"
</span><span class='line'>#include &lt;stdio.h&gt;
</span><span class='line'>#include &lt;errno.h&gt;
</span><span class='line'>
</span><span class='line'>_syscall1(int, _sysctl, struct __sysctl_args *, args);
</span><span class='line'>
</span><span class='line'>int sysctl(int *name, int nlen, void *oldval, size_t *oldlenp, void *newval, size_t newlen)
</span><span class='line'>{
</span><span class='line'>&#9;struct __sysctl_args args={name,nlen,oldval,oldlenp,newval,newlen};
</span><span class='line'>&#9;return _sysctl(&args);
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>#define SIZE(x) sizeof(x)/sizeof(x[0])
</span><span class='line'>#define OSNAMESZ 100
</span><span class='line'>
</span><span class='line'>int oldmyint;
</span><span class='line'>int oldmyintlen;
</span><span class='line'>
</span><span class='line'>int newmyint;
</span><span class='line'>int newmyintlen;
</span><span class='line'>
</span><span class='line'>char oldmystring[MY_MAX_SIZE];
</span><span class='line'>int oldmystringlen;
</span><span class='line'>
</span><span class='line'>char newmystring[MY_MAX_SIZE];
</span><span class='line'>int newmystringlen;
</span><span class='line'>
</span><span class='line'>int myintctl[] = {MY_ROOT, MY_INT_EXAM};
</span><span class='line'>int mystringctl[] = {MY_ROOT, MY_STRING_EXAM};
</span><span class='line'>
</span><span class='line'>int main(int argc, char ** argv)
</span><span class='line'>{
</span><span class='line'>&#9;if (argc &lt; 2) 
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;oldmyintlen = sizeof(int);
</span><span class='line'>&#9;&#9;if (sysctl(myintctl, SIZE(myintctl), &oldmyint, &oldmyintlen, 0, 0)) {
</span><span class='line'>&#9;&#9;&#9;perror("sysctl");
</span><span class='line'>&#9;&#9;&#9;exit(-1);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;&#9;else {
</span><span class='line'>&#9;&#9;&#9;printf("mysysctl.myint = %d\n", oldmyint);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>
</span><span class='line'>&#9;&#9;oldmystringlen = MY_MAX_SIZE;
</span><span class='line'>&#9;&#9;if (sysctl(mystringctl, SIZE(mystringctl), oldmystring, &oldmystringlen, 0, 0)) {
</span><span class='line'>&#9;&#9;&#9;perror("sysctl");
</span><span class='line'>&#9;&#9;&#9;exit(-1);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;&#9;else {
</span><span class='line'>&#9;&#9;&#9;printf("mysysctl.mystring = \"%s\"\n", oldmystring);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;}
</span><span class='line'>&#9;else if (argc != 3) 
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;printf("Usage:\n");
</span><span class='line'>&#9;&#9;printf("\tsysctl-exam-user\n");
</span><span class='line'>&#9;&#9;printf("Or\n");
</span><span class='line'>&#9;&#9;printf("\tsysctl-exam-user aint astring\n");
</span><span class='line'>&#9;}
</span><span class='line'>&#9;else 
</span><span class='line'>&#9;{
</span><span class='line'>&#9;&#9;newmyint = atoi(argv[1]);
</span><span class='line'>&#9;&#9;newmyintlen = sizeof(int);
</span><span class='line'>&#9;&#9;oldmyintlen = sizeof(int);
</span><span class='line'>
</span><span class='line'>&#9;&#9;strcpy(newmystring, argv[2]);
</span><span class='line'>&#9;&#9;newmystringlen = strlen(newmystring);
</span><span class='line'>&#9;&#9;oldmystringlen = MY_MAX_SIZE;
</span><span class='line'>
</span><span class='line'>&#9;&#9;if (sysctl(myintctl, SIZE(myintctl), &oldmyint, &oldmyintlen, &newmyint, newmyintlen)) {
</span><span class='line'>&#9;&#9;&#9;perror("sysctl");
</span><span class='line'>&#9;&#9;&#9;exit(-1);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;&#9;else {
</span><span class='line'>&#9;&#9;&#9;printf("old value: mysysctl.myint = %d\n", oldmyint);
</span><span class='line'>&#9;&#9;&#9;printf("new value: mysysctl.myint = %d\n", newmyint);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&#9;&#9;if (sysctl(mystringctl, SIZE(mystringctl), oldmystring, &oldmystringlen, newmystring, newmystringlen)) {
</span><span class='line'>&#9;&#9;&#9;perror("sysctl");
</span><span class='line'>&#9;&#9;&#9;exit(-1);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;&#9;else {
</span><span class='line'>&#9;&#9;&#9;printf("old vale: mysysctl.mystring = \"%s\"\n", oldmystring);
</span><span class='line'>&#9;&#9;&#9;printf("new value: mysysctl.mystring = \"%s\"\n", newmystring);
</span><span class='line'>&#9;&#9;}
</span><span class='line'>&#9;}
</span><span class='line'>&#9;exit(0);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h2 class="entry-title"><a href="/blog/2013/06/21/compiler-makefile-shell/">Makefile与Shell的问题</a></h2>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2013-06-21T18:28:00+08:00'><span class='date'>2013-06-21</span> <span class='time'>18:28:00</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>  大概只要知 道Makefile的人，都知道Makefile可以调用Shell脚本。但是在实际使用时，并不那么简单，一些模棱两可的地方可能会让你抓狂。你若不信，可以先看几个例子，想象一下这些这些例子会打印什么内容，记下你想象的结果，然后在计算机上运行这些例子，对照看一下。</p>

<p>示例一：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if [ "$(BUILD)" = "debug" ]; then
</span><span class='line'>&#9;echo "build debug"; 
</span><span class='line'>else
</span><span class='line'>&#9;echo "build release";
</span><span class='line'>fi
</span><span class='line'>all:
</span><span class='line'>&#9;echo "done"</span></code></pre></td></tr></table></div></figure>


<p>示例二：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>all:
</span><span class='line'>&#9;@CC=arm-linux-gcc
</span><span class='line'>&#9;@echo $(CC)</span></code></pre></td></tr></table></div></figure>


<p>示例三：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CC=arm-linux-gcc
</span><span class='line'>all:
</span><span class='line'>&#9;@echo $(CC)</span></code></pre></td></tr></table></div></figure>


<p>示例四：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SUBDIR=src example
</span><span class='line'>all:
</span><span class='line'>&#9;@for subdir in $(SUBDIR);
</span><span class='line'>&#9;do
</span><span class='line'>&#9;&#9;echo "building " $(subdir);
</span><span class='line'>&#9;done</span></code></pre></td></tr></table></div></figure>


<h4>说明：</h4>

<p>1.Shell脚本在target里才有效，其它地方都被忽略掉了。所以示例一中，”build debug”之类的字符串根本打印不出来。示例一的正确写法是：
示例一：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>all:
</span><span class='line'>&#9;if [ "$(BUILD)" = "debug" ]; then
</span><span class='line'>&#9;&#9;echo "build debug";
</span><span class='line'>&#9;else
</span><span class='line'>&#9;&#9;echo "build release";
</span><span class='line'>&#9;fi
</span><span class='line'>&#9;echo "done"</span></code></pre></td></tr></table></div></figure>


<p>2.make把每一行Shell脚本当作一个独立的单元，它们在单独的进程中运行。示例二中，两行Shell脚本在两个莫不相干的进程里运行，第一个进程把 CC设置为arm-linux-gcc，第二个进程是不知道的，所以打印的结果自然不是arm-linux-gcc了。示例二的正确写法是：<br/>
示例二：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>all:
</span><span class='line'>&#9;@CC=arm-linux-gcc; echo $(CC)
</span><span class='line'>或者：
</span><span class='line'>all:
</span><span class='line'>&#9;@CC=arm-linux-gcc;
</span><span class='line'>&#9;echo $(CC)</span></code></pre></td></tr></table></div></figure>


<p>3.make在调用Shell之前先进行预处理，即展开所有Makefile的变量和函数。这些变量和函数都以$开头。示例三中，Shell拿的脚本实际上是echo arm-linux-gcc，所以打印结果正确。</p>

<p>4.make预处理时，所有以$开头的，它都不会放过。要想引用Shell自己的变量，应该以$$开头。另外要注意，Shell自己的变量是不需要括号的。示例四的正确写法是：<br/>
示例四：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SUBDIR=src example
</span><span class='line'>all:
</span><span class='line'>&#9;@for subdir in $(SUBDIR);
</span><span class='line'>&#9;do
</span><span class='line'>&#9;&#9;echo "building " $$subdir;
</span><span class='line'>&#9;done</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/69">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/67">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
<h1>Categories</h1>
<head>
</head>
<body>
<div id="menu">
<ul>
<li class='catclass'><a href='/blog/cats/language/'>language</a><a href='##' onmousedown=showDiv('language') id='aexp_language'><span class='exp_style' id='exp_language'>[+]</span></a><span class='right_span'>(39)</span></li>
<div id='language' class='catsub'><li><a href='/blog/cats/language~c/?opendiv=language'>c</a><a href='##' onmousedown=showDiv('language~c') id='aexp_language~c'><span class='exp_style' id='exp_language~c'>[+]</span></a><span class='right_span'>22</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~c')) document.getElementById('aexp_language~c').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~java/?opendiv=language'>java</a><a href='##' onmousedown=showDiv('language~java') id='aexp_language~java'><span class='exp_style' id='exp_language~java'>[+]</span></a><span class='right_span'>11</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('language~java')) document.getElementById('aexp_language~java').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/language~web/?opendiv=language'>web</a><a href='##' onmousedown=showDiv('language~web') id='aexp_language~web'><span class='exp_style' id='exp_language~web'>[+]</span></a><span class='right_span'>6</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('language')) document.getElementById('aexp_language').style.visibility = 'hidden';
if (!document.getElementById('language~web')) document.getElementById('aexp_language~web').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/compiler/'>compiler</a><a href='##' onmousedown=showDiv('compiler') id='aexp_compiler'><span class='exp_style' id='exp_compiler'>[+]</span></a><span class='right_span'>(14)</span></li>
<div id='compiler' class='catsub'><li><a href='/blog/cats/compiler~base/?opendiv=compiler'>base</a><a href='##' onmousedown=showDiv('compiler~base') id='aexp_compiler~base'><span class='exp_style' id='exp_compiler~base'>[+]</span></a><span class='right_span'>10</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler~base')) document.getElementById('aexp_compiler~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/compiler~make/?opendiv=compiler'>make</a><a href='##' onmousedown=showDiv('compiler~make') id='aexp_compiler~make'><span class='exp_style' id='exp_compiler~make'>[+]</span></a><span class='right_span'>4</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('compiler')) document.getElementById('aexp_compiler').style.visibility = 'hidden';
if (!document.getElementById('compiler~make')) document.getElementById('aexp_compiler~make').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/assembly/'>assembly</a><a href='##' onmousedown=showDiv('assembly') id='aexp_assembly'><span class='exp_style' id='exp_assembly'>[+]</span></a><span class='right_span'>(15)</span></li>
<div id='assembly' class='catsub'><li><a href='/blog/cats/assembly~arm/?opendiv=assembly'>arm</a><a href='##' onmousedown=showDiv('assembly~arm') id='aexp_assembly~arm'><span class='exp_style' id='exp_assembly~arm'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('assembly~arm')) document.getElementById('aexp_assembly~arm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/assembly~base/?opendiv=assembly'>base</a><a href='##' onmousedown=showDiv('assembly~base') id='aexp_assembly~base'><span class='exp_style' id='exp_assembly~base'>[+]</span></a><span class='right_span'>13</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('assembly')) document.getElementById('aexp_assembly').style.visibility = 'hidden';
if (!document.getElementById('assembly~base')) document.getElementById('aexp_assembly~base').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/tools/'>tools</a><a href='##' onmousedown=showDiv('tools') id='aexp_tools'><span class='exp_style' id='exp_tools'>[+]</span></a><span class='right_span'>(50)</span></li>
<div id='tools' class='catsub'><li><a href='/blog/cats/tools~base/?opendiv=tools'>base</a><a href='##' onmousedown=showDiv('tools~base') id='aexp_tools~base'><span class='exp_style' id='exp_tools~base'>[+]</span></a><span class='right_span'>14</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~base')) document.getElementById('aexp_tools~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~ci/?opendiv=tools'>ci</a><a href='##' onmousedown=showDiv('tools~ci') id='aexp_tools~ci'><span class='exp_style' id='exp_tools~ci'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~ci')) document.getElementById('aexp_tools~ci').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~command/?opendiv=tools'>command</a><a href='##' onmousedown=showDiv('tools~command') id='aexp_tools~command'><span class='exp_style' id='exp_tools~command'>[+]</span></a><span class='right_span'>9</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~command')) document.getElementById('aexp_tools~command').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~git/?opendiv=tools'>git</a><a href='##' onmousedown=showDiv('tools~git') id='aexp_tools~git'><span class='exp_style' id='exp_tools~git'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~git')) document.getElementById('aexp_tools~git').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~haproxy/?opendiv=tools'>haproxy</a><a href='##' onmousedown=showDiv('tools~haproxy') id='aexp_tools~haproxy'><span class='exp_style' id='exp_tools~haproxy'>[+]</span></a><span class='right_span'>9</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~haproxy')) document.getElementById('aexp_tools~haproxy').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~mysql/?opendiv=tools'>mysql</a><a href='##' onmousedown=showDiv('tools~mysql') id='aexp_tools~mysql'><span class='exp_style' id='exp_tools~mysql'>[+]</span></a><span class='right_span'>6</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('tools~mysql')) document.getElementById('aexp_tools~mysql').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/tools~ssh/?opendiv=tools'>ssh</a><a href='##' onmousedown=showDiv('tools~ssh') id='aexp_tools~ssh'><span class='exp_style' id='exp_tools~ssh'>[+]</span></a><span class='right_span'>3</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('tools')) document.getElementById('aexp_tools').style.visibility = 'hidden';
if (!document.getElementById('tools~ssh')) document.getElementById('aexp_tools~ssh').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/system/'>system</a><a href='##' onmousedown=showDiv('system') id='aexp_system'><span class='exp_style' id='exp_system'>[+]</span></a><span class='right_span'>(51)</span></li>
<div id='system' class='catsub'><li><a href='/blog/cats/system~base/?opendiv=system'>base</a><a href='##' onmousedown=showDiv('system~base') id='aexp_system~base'><span class='exp_style' id='exp_system~base'>[+]</span></a><span class='right_span'>14</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~base')) document.getElementById('aexp_system~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~centos/?opendiv=system'>centos</a><a href='##' onmousedown=showDiv('system~centos') id='aexp_system~centos'><span class='exp_style' id='exp_system~centos'>[+]</span></a><span class='right_span'>8</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~centos')) document.getElementById('aexp_system~centos').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~cgroup/?opendiv=system'>cgroup</a><a href='##' onmousedown=showDiv('system~cgroup') id='aexp_system~cgroup'><span class='exp_style' id='exp_system~cgroup'>[+]</span></a><span class='right_span'>11</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~cgroup')) document.getElementById('aexp_system~cgroup').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~kvm/?opendiv=system'>kvm</a><a href='##' onmousedown=showDiv('system~kvm') id='aexp_system~kvm'><span class='exp_style' id='exp_system~kvm'>[+]</span></a><span class='right_span'>7</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~kvm')) document.getElementById('aexp_system~kvm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~namespace/?opendiv=system'>namespace</a><a href='##' onmousedown=showDiv('system~namespace') id='aexp_system~namespace'><span class='exp_style' id='exp_system~namespace'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('system~namespace')) document.getElementById('aexp_system~namespace').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/system~ubuntu/?opendiv=system'>ubuntu</a><a href='##' onmousedown=showDiv('system~ubuntu') id='aexp_system~ubuntu'><span class='exp_style' id='exp_system~ubuntu'>[+]</span></a><span class='right_span'>9</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('system')) document.getElementById('aexp_system').style.visibility = 'hidden';
if (!document.getElementById('system~ubuntu')) document.getElementById('aexp_system~ubuntu').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/kernel/'>kernel</a><a href='##' onmousedown=showDiv('kernel') id='aexp_kernel'><span class='exp_style' id='exp_kernel'>[+]</span></a><span class='right_span'>(151)</span></li>
<div id='kernel' class='catsub'><li><a href='/blog/cats/kernel~base/?opendiv=kernel'>base</a><a href='##' onmousedown=showDiv('kernel~base') id='aexp_kernel~base'><span class='exp_style' id='exp_kernel~base'>[+]</span></a><span class='right_span'>18</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~base')) document.getElementById('aexp_kernel~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~fs/?opendiv=kernel'>fs</a><a href='##' onmousedown=showDiv('kernel~fs') id='aexp_kernel~fs'><span class='exp_style' id='exp_kernel~fs'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~fs')) document.getElementById('aexp_kernel~fs').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~irq/?opendiv=kernel'>irq</a><a href='##' onmousedown=showDiv('kernel~irq') id='aexp_kernel~irq'><span class='exp_style' id='exp_kernel~irq'>[+]</span></a><span class='right_span'>10</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~irq')) document.getElementById('aexp_kernel~irq').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~kexec/?opendiv=kernel'>kexec</a><a href='##' onmousedown=showDiv('kernel~kexec') id='aexp_kernel~kexec'><span class='exp_style' id='exp_kernel~kexec'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~kexec')) document.getElementById('aexp_kernel~kexec').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~mm/?opendiv=kernel'>mm</a><a href='##' onmousedown=showDiv('kernel~mm') id='aexp_kernel~mm'><span class='exp_style' id='exp_kernel~mm'>[+]</span></a><span class='right_span'>33</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~mm')) document.getElementById('aexp_kernel~mm').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~net/?opendiv=kernel'>net</a><a href='##' onmousedown=showDiv('kernel~net') id='aexp_kernel~net'><span class='exp_style' id='exp_kernel~net'>[+]</span></a><span class='right_span'>69</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel~net')) document.getElementById('aexp_kernel~net').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/kernel~sched/?opendiv=kernel'>sched</a><a href='##' onmousedown=showDiv('kernel~sched') id='aexp_kernel~sched'><span class='exp_style' id='exp_kernel~sched'>[+]</span></a><span class='right_span'>19</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('kernel')) document.getElementById('aexp_kernel').style.visibility = 'hidden';
if (!document.getElementById('kernel~sched')) document.getElementById('aexp_kernel~sched').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/android/'>android</a><a href='##' onmousedown=showDiv('android') id='aexp_android'><span class='exp_style' id='exp_android'>[+]</span></a><span class='right_span'>(20)</span></li>
<div id='android' class='catsub'><li><a href='/blog/cats/android~base/?opendiv=android'>base</a><a href='##' onmousedown=showDiv('android~base') id='aexp_android~base'><span class='exp_style' id='exp_android~base'>[+]</span></a><span class='right_span'>11</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~base')) document.getElementById('aexp_android~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~i9507v/?opendiv=android'>i9507v</a><a href='##' onmousedown=showDiv('android~i9507v') id='aexp_android~i9507v'><span class='exp_style' id='exp_android~i9507v'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~i9507v')) document.getElementById('aexp_android~i9507v').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~me722/?opendiv=android'>me722</a><a href='##' onmousedown=showDiv('android~me722') id='aexp_android~me722'><span class='exp_style' id='exp_android~me722'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~me722')) document.getElementById('aexp_android~me722').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~nx403a/?opendiv=android'>nx403a</a><a href='##' onmousedown=showDiv('android~nx403a') id='aexp_android~nx403a'><span class='exp_style' id='exp_android~nx403a'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('android~nx403a')) document.getElementById('aexp_android~nx403a').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/android~s5830/?opendiv=android'>s5830</a><a href='##' onmousedown=showDiv('android~s5830') id='aexp_android~s5830'><span class='exp_style' id='exp_android~s5830'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('android')) document.getElementById('aexp_android').style.visibility = 'hidden';
if (!document.getElementById('android~s5830')) document.getElementById('aexp_android~s5830').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/debug/'>debug</a><a href='##' onmousedown=showDiv('debug') id='aexp_debug'><span class='exp_style' id='exp_debug'>[+]</span></a><span class='right_span'>(66)</span></li>
<div id='debug' class='catsub'><li><a href='/blog/cats/debug~base/?opendiv=debug'>base</a><a href='##' onmousedown=showDiv('debug~base') id='aexp_debug~base'><span class='exp_style' id='exp_debug~base'>[+]</span></a><span class='right_span'>16</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~base')) document.getElementById('aexp_debug~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~dwarf/?opendiv=debug'>dwarf</a><a href='##' onmousedown=showDiv('debug~dwarf') id='aexp_debug~dwarf'><span class='exp_style' id='exp_debug~dwarf'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~dwarf')) document.getElementById('aexp_debug~dwarf').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~gdb/?opendiv=debug'>gdb</a><a href='##' onmousedown=showDiv('debug~gdb') id='aexp_debug~gdb'><span class='exp_style' id='exp_debug~gdb'>[+]</span></a><span class='right_span'>8</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~gdb')) document.getElementById('aexp_debug~gdb').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kdump,-crash/?opendiv=debug'>kdump、crash</a><a href='##' onmousedown=showDiv('debug~kdump、crash') id='aexp_debug~kdump、crash'><span class='exp_style' id='exp_debug~kdump、crash'>[+]</span></a><span class='right_span'>9</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kdump、crash')) document.getElementById('aexp_debug~kdump、crash').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kgdb/?opendiv=debug'>kgdb</a><a href='##' onmousedown=showDiv('debug~kgdb') id='aexp_debug~kgdb'><span class='exp_style' id='exp_debug~kgdb'>[+]</span></a><span class='right_span'>3</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kgdb')) document.getElementById('aexp_debug~kgdb').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~kprobe/?opendiv=debug'>kprobe</a><a href='##' onmousedown=showDiv('debug~kprobe') id='aexp_debug~kprobe'><span class='exp_style' id='exp_debug~kprobe'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~kprobe')) document.getElementById('aexp_debug~kprobe').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~mark/?opendiv=debug'>mark</a><a href='##' onmousedown=showDiv('debug~mark') id='aexp_debug~mark'><span class='exp_style' id='exp_debug~mark'>[+]</span></a><span class='right_span'>16</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~mark')) document.getElementById('aexp_debug~mark').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~perf/?opendiv=debug'>perf</a><a href='##' onmousedown=showDiv('debug~perf') id='aexp_debug~perf'><span class='exp_style' id='exp_debug~perf'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('debug~perf')) document.getElementById('aexp_debug~perf').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/debug~systemtap/?opendiv=debug'>systemtap</a><a href='##' onmousedown=showDiv('debug~systemtap') id='aexp_debug~systemtap'><span class='exp_style' id='exp_debug~systemtap'>[+]</span></a><span class='right_span'>5</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('debug')) document.getElementById('aexp_debug').style.visibility = 'hidden';
if (!document.getElementById('debug~systemtap')) document.getElementById('aexp_debug~systemtap').style.visibility = 'hidden';
</script>
<li><div style="background:#DDD; height:0.3em;"></div></li><li class='catclass'><a href='/blog/cats/algorithm/'>algorithm</a><a href='##' onmousedown=showDiv('algorithm') id='aexp_algorithm'><span class='exp_style' id='exp_algorithm'>[+]</span></a><span class='right_span'>(26)</span></li>
<div id='algorithm' class='catsub'><li><a href='/blog/cats/algorithm~base/?opendiv=algorithm'>base</a><a href='##' onmousedown=showDiv('algorithm~base') id='aexp_algorithm~base'><span class='exp_style' id='exp_algorithm~base'>[+]</span></a><span class='right_span'>19</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~base')) document.getElementById('aexp_algorithm~base').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~dp/?opendiv=algorithm'>dp</a><a href='##' onmousedown=showDiv('algorithm~dp') id='aexp_algorithm~dp'><span class='exp_style' id='exp_algorithm~dp'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~dp')) document.getElementById('aexp_algorithm~dp').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~ds/?opendiv=algorithm'>ds</a><a href='##' onmousedown=showDiv('algorithm~ds') id='aexp_algorithm~ds'><span class='exp_style' id='exp_algorithm~ds'>[+]</span></a><span class='right_span'>4</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm~ds')) document.getElementById('aexp_algorithm~ds').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/algorithm~tc/?opendiv=algorithm'>tc</a><a href='##' onmousedown=showDiv('algorithm~tc') id='aexp_algorithm~tc'><span class='exp_style' id='exp_algorithm~tc'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('algorithm')) document.getElementById('aexp_algorithm').style.visibility = 'hidden';
if (!document.getElementById('algorithm~tc')) document.getElementById('aexp_algorithm~tc').style.visibility = 'hidden';
</script>
<li class='catclass'><a href='/blog/cats/blog/'>blog</a><a href='##' onmousedown=showDiv('blog') id='aexp_blog'><span class='exp_style' id='exp_blog'>[+]</span></a><span class='right_span'>(11)</span></li>
<div id='blog' class='catsub'><li><a href='/blog/cats/blog~hello/?opendiv=blog'>hello</a><a href='##' onmousedown=showDiv('blog~hello') id='aexp_blog~hello'><span class='exp_style' id='exp_blog~hello'>[+]</span></a><span class='right_span'>1</span></li>
<div id='blog~hello' class='catsub2'><li><a href='/blog/cats/blog~hello~hi/?opendiv=blog~hello'>hi</a><span class='right_span'>1</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~hello')) document.getElementById('aexp_blog~hello').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~jekyll/?opendiv=blog'>jekyll</a><a href='##' onmousedown=showDiv('blog~jekyll') id='aexp_blog~jekyll'><span class='exp_style' id='exp_blog~jekyll'>[+]</span></a><span class='right_span'>2</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~jekyll')) document.getElementById('aexp_blog~jekyll').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~markdown/?opendiv=blog'>markdown</a><a href='##' onmousedown=showDiv('blog~markdown') id='aexp_blog~markdown'><span class='exp_style' id='exp_blog~markdown'>[+]</span></a><span class='right_span'>1</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~markdown')) document.getElementById('aexp_blog~markdown').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~octopress/?opendiv=blog'>octopress</a><a href='##' onmousedown=showDiv('blog~octopress') id='aexp_blog~octopress'><span class='exp_style' id='exp_blog~octopress'>[+]</span></a><span class='right_span'>5</span></li>
<script language='javascript' type='text/javascript'>
if (!document.getElementById('blog~octopress')) document.getElementById('aexp_blog~octopress').style.visibility = 'hidden';
</script>
<li><a href='/blog/cats/blog~ruby/?opendiv=blog'>ruby</a><a href='##' onmousedown=showDiv('blog~ruby') id='aexp_blog~ruby'><span class='exp_style' id='exp_blog~ruby'>[+]</span></a><span class='right_span'>2</span></li>
</div><script language='javascript' type='text/javascript'>
if (!document.getElementById('blog')) document.getElementById('aexp_blog').style.visibility = 'hidden';
if (!document.getElementById('blog~ruby')) document.getElementById('aexp_blog~ruby').style.visibility = 'hidden';
</script>

</ul>
</div>
</body>
</html>
</section>

<section>
<h1>Date Categories</h1>
<head>
</head>
<body>
<div id="menu">
<ul>
<li class='catclass'><a href='/blog/cats/2015/'>2015</a><a href='##' onmousedown=showDiv('2015')><span class='exp_style' id='exp_2015'>[+]</span></a><span class='right_span'>(192)</span></li>
<div id='2015' class='catsub'><li><a href='/blog/cats/2015~09/?opendiv=2015'>2015-09</a><span class='right_span'>18</span></li>
<li><a href='/blog/cats/2015~08/?opendiv=2015'>2015-08</a><span class='right_span'>25</span></li>
<li><a href='/blog/cats/2015~07/?opendiv=2015'>2015-07</a><span class='right_span'>31</span></li>
<li><a href='/blog/cats/2015~06/?opendiv=2015'>2015-06</a><span class='right_span'>24</span></li>
<li><a href='/blog/cats/2015~05/?opendiv=2015'>2015-05</a><span class='right_span'>22</span></li>
<li><a href='/blog/cats/2015~04/?opendiv=2015'>2015-04</a><span class='right_span'>23</span></li>
<li><a href='/blog/cats/2015~03/?opendiv=2015'>2015-03</a><span class='right_span'>19</span></li>
<li><a href='/blog/cats/2015~02/?opendiv=2015'>2015-02</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2015~01/?opendiv=2015'>2015-01</a><span class='right_span'>19</span></li>
</div><li class='catclass'><a href='/blog/cats/2014/'>2014</a><a href='##' onmousedown=showDiv('2014')><span class='exp_style' id='exp_2014'>[+]</span></a><span class='right_span'>(112)</span></li>
<div id='2014' class='catsub'><li><a href='/blog/cats/2014~12/?opendiv=2014'>2014-12</a><span class='right_span'>21</span></li>
<li><a href='/blog/cats/2014~11/?opendiv=2014'>2014-11</a><span class='right_span'>19</span></li>
<li><a href='/blog/cats/2014~10/?opendiv=2014'>2014-10</a><span class='right_span'>13</span></li>
<li><a href='/blog/cats/2014~09/?opendiv=2014'>2014-09</a><span class='right_span'>7</span></li>
<li><a href='/blog/cats/2014~08/?opendiv=2014'>2014-08</a><span class='right_span'>15</span></li>
<li><a href='/blog/cats/2014~07/?opendiv=2014'>2014-07</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2014~06/?opendiv=2014'>2014-06</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2014~05/?opendiv=2014'>2014-05</a><span class='right_span'>7</span></li>
<li><a href='/blog/cats/2014~04/?opendiv=2014'>2014-04</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2014~03/?opendiv=2014'>2014-03</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2014~02/?opendiv=2014'>2014-02</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2014~01/?opendiv=2014'>2014-01</a><span class='right_span'>2</span></li>
</div><li class='catclass'><a href='/blog/cats/2013/'>2013</a><a href='##' onmousedown=showDiv('2013')><span class='exp_style' id='exp_2013'>[+]</span></a><span class='right_span'>(60)</span></li>
<div id='2013' class='catsub'><li><a href='/blog/cats/2013~12/?opendiv=2013'>2013-12</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~11/?opendiv=2013'>2013-11</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~10/?opendiv=2013'>2013-10</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~09/?opendiv=2013'>2013-09</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~08/?opendiv=2013'>2013-08</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2013~07/?opendiv=2013'>2013-07</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2013~06/?opendiv=2013'>2013-06</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2013~05/?opendiv=2013'>2013-05</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2013~03/?opendiv=2013'>2013-03</a><span class='right_span'>6</span></li>
<li><a href='/blog/cats/2013~02/?opendiv=2013'>2013-02</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2013~01/?opendiv=2013'>2013-01</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2012/'>2012</a><a href='##' onmousedown=showDiv('2012')><span class='exp_style' id='exp_2012'>[+]</span></a><span class='right_span'>(35)</span></li>
<div id='2012' class='catsub'><li><a href='/blog/cats/2012~12/?opendiv=2012'>2012-12</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2012~11/?opendiv=2012'>2012-11</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2012~10/?opendiv=2012'>2012-10</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2012~08/?opendiv=2012'>2012-08</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2012~05/?opendiv=2012'>2012-05</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2012~04/?opendiv=2012'>2012-04</a><span class='right_span'>9</span></li>
<li><a href='/blog/cats/2012~03/?opendiv=2012'>2012-03</a><span class='right_span'>6</span></li>
<li><a href='/blog/cats/2012~02/?opendiv=2012'>2012-02</a><span class='right_span'>5</span></li>
<li><a href='/blog/cats/2012~01/?opendiv=2012'>2012-01</a><span class='right_span'>2</span></li>
</div><li class='catclass'><a href='/blog/cats/2011/'>2011</a><a href='##' onmousedown=showDiv('2011')><span class='exp_style' id='exp_2011'>[+]</span></a><span class='right_span'>(35)</span></li>
<div id='2011' class='catsub'><li><a href='/blog/cats/2011~12/?opendiv=2011'>2011-12</a><span class='right_span'>8</span></li>
<li><a href='/blog/cats/2011~11/?opendiv=2011'>2011-11</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2011~08/?opendiv=2011'>2011-08</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2011~07/?opendiv=2011'>2011-07</a><span class='right_span'>3</span></li>
<li><a href='/blog/cats/2011~06/?opendiv=2011'>2011-06</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~05/?opendiv=2011'>2011-05</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~04/?opendiv=2011'>2011-04</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2011~03/?opendiv=2011'>2011-03</a><span class='right_span'>11</span></li>
<li><a href='/blog/cats/2011~02/?opendiv=2011'>2011-02</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2011~01/?opendiv=2011'>2011-01</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2010/'>2010</a><a href='##' onmousedown=showDiv('2010')><span class='exp_style' id='exp_2010'>[+]</span></a><span class='right_span'>(1)</span></li>
<div id='2010' class='catsub'><li><a href='/blog/cats/2010~07/?opendiv=2010'>2010-07</a><span class='right_span'>1</span></li>
</div><li class='catclass'><a href='/blog/cats/2009/'>2009</a><a href='##' onmousedown=showDiv('2009')><span class='exp_style' id='exp_2009'>[+]</span></a><span class='right_span'>(8)</span></li>
<div id='2009' class='catsub'><li><a href='/blog/cats/2009~12/?opendiv=2009'>2009-12</a><span class='right_span'>1</span></li>
<li><a href='/blog/cats/2009~10/?opendiv=2009'>2009-10</a><span class='right_span'>4</span></li>
<li><a href='/blog/cats/2009~09/?opendiv=2009'>2009-09</a><span class='right_span'>2</span></li>
<li><a href='/blog/cats/2009~07/?opendiv=2009'>2009-07</a><span class='right_span'>1</span></li>
</div>
</ul>
</div>
</body>
</html>
</section>

<section>
<h1>Tags</h1>
<ul class="tag-cloud">
<a style="font-size: 131%" href="/tags/gdb/">gdb(6)</a>
<a style="font-size: 100%" href="/tags/hello/">hello(1)</a>
<a style="font-size: 150%" href="/tags/koj/">koj(18)</a>
<a style="font-size: 112%" href="/tags/nvidia/">nvidia(2)</a>
<a style="font-size: 100%" href="/tags/patch/">patch(1)</a>
<a style="font-size: 100%" href="/tags/reg-exp/">reg_exp(1)</a>

</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/30/kernel-mm-oom/">kernel 3.10内核源码分析--Out of Memory(OOM)处理流程</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/30/kernel-mm-init/">kernel 3.10内核源码分析--内核页表创建</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/30/kernel-net-keepalive/">TCP的定时器系列 — 保活定时器</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/30/debug-loop_ack/">ack loop</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/30/lang-c-libcurl/">linux c libcurl的简单使用</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub</h1>
  
  <a href="https://github.com/abcdxyzk">abcdxyzk on GitHub</a>
  
</section>

<section>
<h1>Links</h1>
<ul>
	<li>
		<a href=http://hi.baidu.com/abcdxyzk target=_blank>My blog</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/zhangskd target=_blank>zhangsk</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/justlinux2010 target=_blank>justlinux2010</a>
	</li>
	<li>
		<a href=http://simohayha.iteye.com/ target=_blank>simohayha</a>
	</li>
	<li>
		<a href=http://linux.chinaunix.net/techdoc/net/ target=_blank>技术文档</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/cybertan target=_blank>cybertan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/newnewman80 target=_blank>newnewman80</a>
	</li>
	<li>
		<a href=http://www.cppblog.com/fwxjj/ target=_blank>fwxjj</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/ustc_dylan target=_blank>ustc_dylan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/nkguohao target=_blank>nkguohao</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/yusiguyuan target=_blank>yusiguyuan</a>
	</li>
	<li>
		<a href=http://www.oenhan.com/ target=_blank>oenhan</a>
	</li>
	<li>
		<a href=http://blog.csdn.net/bullbat target=_blank>bullbat</a>
	</li>
	<li>
		<a href=http://www.wowotech.net/ target=_blank>wowotech</a>
	</li>
	<li>
		<a href=http://www.lenky.info/ target=_blank>lenky</a>
	</li>
	<li>
		<a href=http://smilejay.com/ target=_blank>smilejay</a>
	</li>
	<li>
		<a href=http://blog.chinaunix.net/uid/10167808.html target=_blank>godbach</a>
	</li>
</ul>
</section>

  
<section id="comment_sidebar">
<h1>Recent Comments</h1>

<script type="text/javascript" src="http://abcdxyzk.disqus.com/recent_comments_widget.js?num_items=5&hide_avatars=0&avatar_size=32&excerpt_length=20"></script><a href="http://disqus.com/">Powered by Disqus</a>

</section>


</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - kk -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <a title="Top" href="#" id="scroll2top" style="position: fixed; height: 50px; bottom: 30px; right: 25px; cursor: pointer; z-index: 9999; display: block; opacity: 1;"><img src="/images/scrollup.png"></a>
  <script src="/javascripts/scroll2top.js"></script>
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253604690'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1253604690' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'abcdxyzk';
      
</script>





</body>
</html>
